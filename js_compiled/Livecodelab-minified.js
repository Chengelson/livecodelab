'use strict';var createLiveCodeLabCore=function(a,b,c,d,e){var f={};b||(b=document.createElement("canvas"));f.canvasForBackground=b;b=1/15;f.canvasForBackground.width=Math.floor(window.innerWidth*b);f.canvasForBackground.height=Math.floor(window.innerHeight*b);f.backgroundSceneContext=f.canvasForBackground.getContext("2d");f.THREE=THREE;f.TimeKeeper=createTimeKeeper();f.BlendControls=createBlendControls(f);f.ColourFunctions=createColourFunctions();f.Renderer=createRenderer(f);f.SoundSystem=createSoundSystem(d,
buzz,createBowser(),createSampleBank(buzz));f.BackgroundPainter=createBackgroundPainter(d,f);f.DrawFunctionRunner=createDrawFunctionRunner(d,f);f.CodeTransformer=createCodeTransformer(d,CoffeeScript,f);f.AnimationLoop=createAnimationLoop(d,e,f);f.ThreeJsSystem=createThreeJsSystem(Detector,THREEx,a,c,f.THREE);f.MatrixCommands=createMatrixCommands(f.THREE,f);f.GraphicsCommands=createGraphicsCommands(f.THREE,f);f.LightSystem=createLightSystem(f.GraphicsCommands,f);f.paintARandomBackground=function(){f.BackgroundPainter.paintARandomBackground()};
f.startAnimationLoop=function(){f.AnimationLoop.animate()};f.runLastWorkingDrawFunction=function(){f.DrawFunctionRunner.reinstateLastWorkingDrawFunction()};f.loadAndTestAllTheSounds=function(){f.SoundSystem.loadAndTestAllTheSounds()};f.playStartupSound=function(){f.SoundSystem.playStartupSound()};f.isAudioSupported=function(){f.SoundSystem.isAudioSupported()};f.updateCode=function(a){f.CodeTransformer.updateCode(a);""!==a&&f.dozingOff&&(f.dozingOff=!1,f.AnimationLoop.animate(),d.trigger("livecodelab-waking-up"))};
return f},createEventRouter=function(){var a={},b={};a.bind=function(a,d,e){d={callback:d,context:e};b[a]||(b[a]=[]);b[a].push(d)};a.trigger=function(a){var d,e,f,h;d=Array.prototype.slice.call(arguments);if(b[a]){d=d.slice(1);e=b[a];for(f=0;f<e.length;f+=1)h=e[f],h.callback.apply(h.context,d)}};return a},createParsingFunctions=function(){var a={},b,c,d;a.finished=!0;a.setString=function(e){d=0;b=e;c=b.length;a.finished=""!==e?!1:!0};a.pop=function(){if(!(d>=c)){var e=b.charAt(d);d+=1;d>=c&&(a.finished=
!0);return e}};a.peek=function(){if(d<c)return b.charAt(d)};return a},createCodeChecker=function(){var a=createParsingFunctions(),b={},c,d,e;d=function(){return{err:!1,bracketStack:[],doubleQ:0,singleQ:0,inSingleString:!1,inDoubleString:!1,inComment:!1,message:""}};c=function(a){if(0<a.bracketStack.length){var c=a.bracketStack.pop();b.message=e(c);a.err=!0}else a.inSingleString?(b.message=e("'"),a.err=!0):a.inDoubleString&&(b.message=e('"'),a.err=!0);return a};e=function(a){switch(a){case "{":a="Unbalanced {}";
break;case "(":a="Unbalanced ()";break;case "[":a="Unbalanced []";break;case "'":a="Missing '";break;case '"':a='Missing "';break;default:a="Unexpected "+a}return a};a.charHandlers={"[":function(){!b.inSingleString&&!b.inDoubleString&&!b.inComment&&b.bracketStack.push("[")},"]":function(){if(!b.inSingleString&&!b.inDoubleString&&!b.inComment){var a=b.bracketStack.pop();"["!==a&&(b.err=!0,b.message=e(a))}},"(":function(){!b.inSingleString&&!b.inDoubleString&&!b.inComment&&b.bracketStack.push("(")},
")":function(){if(!b.inSingleString&&!b.inDoubleString&&!b.inComment){var a=b.bracketStack.pop();"("!==a&&(b.err=!0,b.message=e(a))}},"{":function(){!b.inSingleString&&!b.inDoubleString&&!b.inComment&&b.bracketStack.push("{")},"}":function(){if(!b.inSingleString&&!b.inDoubleString&&!b.inComment){var a=b.bracketStack.pop();"{"!==a&&(b.err=!0,b.message=e(a))}},"'":function(){b.inComment||(b.inSingleString?(b.inSingleString=!1,b.singleQ-=1):b.inDoubleString||(b.inSingleString=!0,b.singleQ+=1))},'"':function(){b.inComment||
(b.inDoubleString?(b.inDoubleString=!1,b.doubleQ-=1):b.inSingleString||(b.inDoubleString=!0,b.doubleQ+=1))},"/":function(){!b.inSingleString&&!b.inDoubleString&&!b.inComment&&"/"===a.peek()&&(a.pop(),b.inComment=!0)},"\\":function(){a.pop()},"\n":function(){b.inSingleString?(b.message=e("'"),b.err=!0):b.inDoubleString?(b.message=e('"'),b.err=!0):b.inComment&&(b.inComment=!1)}};a.parseChar=function(b){if(a.charHandlers[b])a.charHandlers[b]()};a.parse=function(e){b=d();for(a.setString(e);!a.finished&&
!b.err;)e=a.pop(),a.parseChar(e);return c(b)};return a};"undefined"!==typeof exports&&(exports.simple_checker={createChecker:createCodeChecker,createParsingFunctions:createParsingFunctions});
var createUrlRouter=function(a){var b={getHash:function(){var a=window.location.href.match(/#(.*)$/);return a?a[1]:""},setHash:function(a){window.location.hash=a},urlPointsToDemoOrTutorial:function(){var c,d=false;if(c=b.getHash()){a.trigger("url-hash",c);d=true}return d}};a.bind("set-url-hash",b.setHash,b);return b},createBigCursor=function(a){var b={},c,d,e,f;b.isShowing=true;c=function(){$("#fakeStartingBlinkingCursor").animate({opacity:0.2},"fast","swing").animate({opacity:1},"fast","swing")};
b.toggleBlink=function(a){if(a)d||(d=setInterval(c,800));else{clearTimeout(d);d=null}};e=function(){var a;if(b.isShowing){a=$("#caption").html();a=a.substring(0,a.length-1);$("#caption").html(a+"|");$("#fakeStartingBlinkingCursor").html("");$("#toMove").animate({opacity:0,margin:-100,fontSize:300,left:0},"fast");setTimeout('$("#formCode").animate({opacity: 1}, "fast");',120);setTimeout('$("#justForFakeCursor").hide();',200);setTimeout('$("#toMove").hide();',200);b.isShowing=false;b.toggleBlink(false)}};
f=function(){if(!b.isShowing){$("#formCode").animate({opacity:0},"fast");$("#justForFakeCursor").show();$("#toMove").show();$("#caption").html("|");$("#toMove").animate({opacity:1,margin:0,fontSize:350,left:0},"fast",function(){$("#caption").html("");$("#fakeStartingBlinkingCursor").html("|")});b.isShowing=true;b.toggleBlink(true)}};a.bind("big-cursor-show",function(){f()});a.bind("big-cursor-hide",function(){e()});return b};
function McState(){var a=[],b=function(b){return function(d){a.push(new McRule(b,d))}};b.rules=a;b.lex=function(a){for(a=b.run(a);typeof a=="function";)a=a();return a};b.run=McRunMethod;b.continuation=function(a){return function(){return b.run(a)}};return b}function McRule(a,b){this.regex=RegExp("^("+a.source+")");this.regex.compile&&this.regex.compile(this.regex);this.action=b}McRule.prototype.matches=function(a){(a=a.match(this.regex))&&a.shift();return a};
function McRunMethod(a){for(var b=null,c=null,d=-1,e=this.rules.length-1;e>=0;--e){var f=this.rules[e],h=f.matches(a);if(h&&h[0].length>=d){b=f;c=h;d=h[0].length}}if(b)return b.action(c,a.substring(d),this);throw"Lexing error; no match found for: '"+a+"'";}function McCONTINUE(a){return function(b,c){return a.run(c)}}
var McLexer={State:McState},createSampleBank=function(a){if(a.isMP3Supported())a="mp3";else if(a.isOGGSupported())a="ogg";else return;a={sounds:[],soundsByName:{},fileType:a,load:function(a,c){var d=this.sounds.length;this.sounds.push({name:a,path:c+"."+this.fileType});return this.soundsByName[a]=d},getByName:function(a){return this.sounds[this.soundsByName[a]]},getByNumber:function(a){return this.sounds[a]}};a.load("bing","./sound/audioFiles/start_bing");a.load("highHatClosed","./sound/audioFiles/AMB_HHCL");
a.load("highHatOpen","./sound/audioFiles/AMB_HHOP");a.load("toc3","./sound/audioFiles/AMB_LTM2");a.load("toc4","./sound/audioFiles/AMB_RIM1");a.load("snare","./sound/audioFiles/AMB_SN13");a.load("snare2","./sound/audioFiles/AMB_SN_5");a.load("crash","./sound/audioFiles/CRASH_1");a.load("crash2","./sound/audioFiles/CRASH_5");a.load("crash3","./sound/audioFiles/CRASH_6");a.load("ride","./sound/audioFiles/RIDE_1");a.load("glass","./sound/audioFiles/glass2");a.load("thump","./sound/audioFiles/8938__patchen__piano-hits-hand-03v2");
a.load("lowFlash","./sound/audioFiles/9569__thanvannispen__industrial-low-flash04");a.load("lowFlash2","./sound/audioFiles/9570__thanvannispen__industrial-low-flash07");a.load("tranceKick2","./sound/audioFiles/24004__laya__dance-kick3");a.load("tranceKick","./sound/audioFiles/33325__laya__trance-kick01");a.load("voltage","./sound/audioFiles/49255__keinzweiter__bonobob-funk");a.load("beepA","./sound/audioFiles/100708__steveygos93__bleep_a");a.load("beepB","./sound/audioFiles/100708__steveygos93__bleep_b");
a.load("beepC","./sound/audioFiles/100708__steveygos93__bleep_c");a.load("beepD","./sound/audioFiles/100708__steveygos93__bleep_d");a.load("alienBeep","./sound/audioFiles/132389__blackie666__alienbleep");a.load("penta1","./sound/audioFiles/toneMatrix-1");a.load("penta2","./sound/audioFiles/toneMatrix-2");a.load("penta3","./sound/audioFiles/toneMatrix-3");a.load("penta4","./sound/audioFiles/toneMatrix-4");a.load("penta5","./sound/audioFiles/toneMatrix-5");a.load("penta6","./sound/audioFiles/toneMatrix-6");
a.load("penta7","./sound/audioFiles/toneMatrix-7");a.load("penta8","./sound/audioFiles/toneMatrix-8");a.load("penta9","./sound/audioFiles/toneMatrix-9");a.load("penta10","./sound/audioFiles/toneMatrix-10");a.load("penta11","./sound/audioFiles/toneMatrix-11");a.load("penta12","./sound/audioFiles/toneMatrix-12");a.load("penta13","./sound/audioFiles/toneMatrix-13");a.load("penta14","./sound/audioFiles/toneMatrix-14");a.load("penta15","./sound/audioFiles/toneMatrix-15");a.load("penta16","./sound/audioFiles/toneMatrix-16");
a.load("ciack","./sound/audioFiles/ciack");a.load("snap","./sound/audioFiles/snap");a.load("thump2","./sound/audioFiles/thump2");a.load("dish","./sound/audioFiles/dish");return a},createSoundSystem=function(a,b,c,d){var e={},f=0,h,g=0,i=0,j=false,k=0,o=[],p={},m=[],q,n,s,r;m.soundIDs=[];m.beatStrings=[];e.resetLoops=0;e.resetLoops=function(){m.soundIDs=[];m.beatStrings=[]};e.playStartupSound=function(){(new b.sound(d.getByName("bing").path)).play()};e.SetUpdatesPerMinute=function(a){s=a};e.anyCodeReactingTobpm=
false;window.bpm=e.bpm=function(a){if(a!==void 0){a>125&&(a=125);a<0&&(a=0);s=a*4}};window.play=e.play=function(a,b){e.anyCodeReactingTobpm=true;b=b.replace(/\s*/g,"");m.soundIDs.push(a);m.beatStrings.push(b)};if(c.firefox)r=function(a,b){var c,d,g;g=a[b];c=document.createElement("audio");c.setAttribute("preload","auto");c.autobuffer=true;d=document.createElement("source");d.type="audio/ogg";d.src=g;c.appendChild(d);c.addEventListener("load",function(){c.play();$(".filename span").html(c.src)},true);
c.play()};else if(c.safari||c.ie||c.chrome)r=function(a,c,d){var g,e=d[c],f,o;for(f=0;f<e.length;f=f+1){o=e[f];if(o.isEnded()){g=o;break}}if(g===void 0){if(i>31){j=true;$("#soundSystemIsMangledMessage").modal();$("#simplemodal-container").height(250);return}g=new b.sound(a[c]);d[c].push(g);i=i+1}g.play()};q=function(){var a,b,c;if(!j){g=g+1;g=g%16;for(a=0;a<m.soundIDs.length;a=a+1){b=m.soundIDs[a];if(p[b]){c=m.beatStrings[a];c=c.charAt(g%c.length);c==="x"&&r(p,b,o)}}}};e.changeUpdatesPerMinuteIfNeeded=
function(){if(f!==s){clearTimeout(h);s!==0&&(h=setInterval(q,6E4/s));f=s}};e.isAudioSupported=function(){setTimeout(function(){if(!b.isSupported()){$("#noAudioMessage").modal();$("#simplemodal-container").height(200)}},500)};n=function(c,d){var g=new b.sound(d.path);g.mute();g.load();g.bind("ended",function(){g.unbind("ended");g.unmute();k=k+1;k===c.sounds.length*6&&a.trigger("all-sounds-loaded-and tested")});g.play();o[d.name].push(g)};e.loadAndTestAllTheSounds=function(){var b,g,e;for(g=0;g<d.sounds.length;g=
g+1){b=d.getByNumber(g);o[b.name]=[];p[b.name]=b.path;if(c.safari)for(e=0;e<6;e=e+1)setTimeout(n,200*g,d,b)}c.safari||a.trigger("all-sounds-loaded-and tested")};return e},buzz={defaults:{autoplay:!1,duration:5E3,formats:[],loop:!1,placerunner:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(a,b){function c(a){for(var b=[],c=a.length-1,d=0;d<=c;d++)b.push({start:a.start(c),
end:a.end(c)});return b}function d(a,b){var c=document.createElement("source");c.src=b;if(buzz.types[b.split(".").pop()])c.type=buzz.types[b.split(".").pop()];a.appendChild(c)}var b=b||{},e=0,f=[],h={},g=buzz.isSupported();this.load=function(){if(!g)return this;this.sound.load();return this};this.play=function(){if(!g)return this;this.sound.play();return this};this.togglePlay=function(){if(!g)return this;this.sound.paused?this.sound.play():this.sound.pause();return this};this.pause=function(){if(!g)return this;
this.sound.pause();return this};this.isPaused=function(){return!g?null:this.sound.paused};this.stop=function(){if(!g)return this;this.setTime(0);this.sound.pause();return this};this.isEnded=function(){return!g?null:this.sound.ended};this.loop=function(){if(!g)return this;this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!g)return this;this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=
function(){if(!g)return this;this.sound.muted=true;return this};this.unmute=function(){if(!g)return this;this.sound.muted=false;return this};this.toggleMute=function(){if(!g)return this;this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){return!g?null:this.sound.muted};this.setVolume=function(a){if(!g)return this;a<0&&(a=0);a>100&&(a=100);this.volume=a;this.sound.volume=a/100;return this};this.getVolume=function(){return!g?this:this.volume};this.increaseVolume=function(a){return this.setVolume(this.volume+
(a||1))};this.decreaseVolume=function(a){return this.setVolume(this.volume-(a||1))};this.setTime=function(a){if(!g)return this;this.whenReady(function(){this.sound.currentTime=a});return this};this.getTime=function(){if(!g)return null;var a=Math.round(this.sound.currentTime*100)/100;return isNaN(a)?buzz.defaults.placerunner:a};this.setPercent=function(a){return!g?this:this.setTime(buzz.fromPercent(a,this.sound.duration))};this.getPercent=function(){if(!g)return null;var a=Math.round(buzz.toPercent(this.sound.currentTime,
this.sound.duration));return isNaN(a)?buzz.defaults.placerunner:a};this.setSpeed=function(a){if(!g)return this;this.sound.playbackRate=a};this.getSpeed=function(){return!g?null:this.sound.playbackRate};this.getDuration=function(){if(!g)return null;var a=Math.round(this.sound.duration*100)/100;return isNaN(a)?buzz.defaults.placerunner:a};this.getPlayed=function(){return!g?null:c(this.sound.played)};this.getBuffered=function(){return!g?null:c(this.sound.buffered)};this.getSeekable=function(){return!g?
null:c(this.sound.seekable)};this.getErrorCode=function(){return g&&this.sound.error?this.sound.error.code:0};this.getErrorMessage=function(){if(!g)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){return!g?null:this.sound.readyState};this.getStateMessage=function(){if(!g)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";
case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){return!g?null:this.sound.networkState};this.getNetworkStateMessage=function(){if(!g)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(a,b){if(!g)return this;this.sound[a]=
b;return this};this.get=function(a){return!g?null:a?this.sound[a]:this.sound};this.bind=function(a,b){if(!g)return this;for(var a=a.split(" "),c=this,d=function(a){b.call(c,a)},e=0;e<a.length;e++){var j=a[e],h=j,j=h.split(".")[0];f.push({idx:h,func:d});this.sound.addEventListener(j,d,true)}return this};this.unbind=function(a){if(!g)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],d=c.split(".")[0],e=0;e<f.length;e++){var j=f[e].idx.split(".");if(f[e].idx==c||j[1]&&j[1]==c.replace(".",
"")){this.sound.removeEventListener(d,f[e].func,true);f.splice(e,1)}}return this};this.bindOnce=function(a,b){if(!g)return this;var c=this;h[e++]=false;this.bind(a+"."+e,function(){if(!h[e]){h[e]=true;b.call(c)}c.unbind(a+"."+e)})};this.trigger=function(a){if(!g)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],d=0;d<f.length;d++){var e=f[d].idx.split(".");if(f[d].idx==c||e[0]&&e[0]==c.replace(".","")){var j=document.createEvent("HTMLEvents");j.initEvent(e[0],false,true);this.sound.dispatchEvent(j)}}return this};
this.fadeTo=function(a,b,c){function d(){setTimeout(function(){if(e<a&&j.volume<a){j.setVolume(j.volume=j.volume+1);d()}else if(e>a&&j.volume>a){j.setVolume(j.volume=j.volume-1);d()}else c instanceof Function&&c.apply(j)},f)}if(!g)return this;if(b instanceof Function){c=b;b=buzz.defaults.duration}else b=b||buzz.defaults.duration;var e=this.volume,f=b/Math.abs(e-a),j=this;this.play();this.whenReady(function(){d()});return this};this.fadeIn=function(a,b){return!g?this:this.setVolume(0).fadeTo(100,a,
b)};this.fadeOut=function(a,b){return!g?this:this.fadeTo(0,a,b)};this.fadeWith=function(a,b){if(!g)return this;this.fadeOut(b,function(){this.stop()});a.play().fadeIn(b);return this};this.whenReady=function(a){if(!g)return null;var b=this;this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){a.call(b)}):a.call(b)};if(g&&a){for(var i in buzz.defaults)buzz.defaults.hasOwnProperty(i)&&(b[i]=b[i]||buzz.defaults[i]);this.sound=document.createElement("audio");if(a instanceof Array)for(var j in a)a.hasOwnProperty(j)&&
d(this.sound,a[j]);else if(b.formats.length)for(var k in b.formats)b.formats.hasOwnProperty(k)&&d(this.sound,a+"."+b.formats[k]);else d(this.sound,a);b.loop&&this.loop();if(b.autoplay)this.sound.autoplay="autoplay";this.sound.preload=b.preload===true?"auto":b.preload===false?"none":b.preload;this.setVolume(b.volume);buzz.sounds.push(this)}},group:function(a){function b(){for(var b=c(null,arguments),e=b.shift(),f=0;f<a.length;f++)a[f][e].apply(a[f],b)}function c(a,b){return a instanceof Array?a:Array.prototype.slice.call(b)}
a=c(a,arguments);this.getSounds=function(){return a};this.add=function(b){for(var b=c(b,arguments),e=0;e<b.length;e++)a.push(b[e])};this.remove=function(b){for(var b=c(b,arguments),e=0;e<b.length;e++)for(var f=0;f<a.length;f++)if(a[f]==b[e]){a.splice(f,1);break}};this.load=function(){b("load");return this};this.play=function(){b("play");return this};this.togglePlay=function(){b("togglePlay");return this};this.pause=function(a){b("pause",a);return this};this.stop=function(){b("stop");return this};
this.mute=function(){b("mute");return this};this.unmute=function(){b("unmute");return this};this.toggleMute=function(){b("toggleMute");return this};this.setVolume=function(a){b("setVolume",a);return this};this.increaseVolume=function(a){b("increaseVolume",a);return this};this.decreaseVolume=function(a){b("decreaseVolume",a);return this};this.loop=function(){b("loop");return this};this.unloop=function(){b("unloop");return this};this.setTime=function(a){b("setTime",a);return this};this.set=function(a,
c){b("set",a,c);return this};this.bind=function(a,c){b("bind",a,c);return this};this.unbind=function(a){b("unbind",a);return this};this.bindOnce=function(a,c){b("bindOnce",a,c);return this};this.trigger=function(a){b("trigger",a);return this};this.fade=function(a,c,f,h){b("fade",a,c,f,h);return this};this.fadeIn=function(a,c){b("fadeIn",a,c);return this};this.fadeOut=function(a,c){b("fadeOut",a,c);return this}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return!!buzz.el.canPlayType},
isOGGSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(a,b){var c,d,e;c=Math.floor(a/3600);c=isNaN(c)?"--":c>=10?
c:"0"+c;d=b?Math.floor(a/60%60):Math.floor(a/60);d=isNaN(d)?"--":d>=10?d:"0"+d;e=Math.floor(a%60);e=isNaN(e)?"--":e>=10?e:"0"+e;return b?c+":"+d+":"+e:d+":"+e},fromTimer:function(a){var b=a.toString().split(":");b&&b.length==3&&(a=parseInt(b[0],10)*3600+parseInt(b[1],10)*60+parseInt(b[2],10));b&&b.length==2&&(a=parseInt(b[0],10)*60+parseInt(b[1],10));return a},toPercent:function(a,b,c){c=Math.pow(10,c||0);return Math.round(a*100/b*c)/c},fromPercent:function(a,b,c){c=Math.pow(10,c||0);return Math.round(b/
100*a*c)/c}},frame=0,createAnimationLoop=function(a,b,c){var d={},e;d.wantedFramesPerSecond=-1;d.useRequestAnimationFrame=true;var f=function(){d.useRequestAnimationFrame?d.wantedFramesPerSecond===-1?window.requestAnimationFrame(function(){d.animate()}):e===void 0&&(e=setInterval(function(){window.requestAnimationFrame(function(){d.animate()})},1E3/d.wantedFramesPerSecond)):d.wantedFramesPerSecond===-1?setTimeout(function(){d.animate()},1E3/60):setTimeout(function(){d.animate()},1E3/d.wantedFramesPerSecond)};
d.animate=function(){c.MatrixCommands.resetMatrixStack();c.SoundSystem.resetLoops();frame===0?c.TimeKeeper.resetTime():c.TimeKeeper.updateTime();c.DrawFunctionRunner.resetTrackingOfDoOnceOccurrences();c.SoundSystem.anyCodeReactingTobpm=false;c.SoundSystem.SetUpdatesPerMinute(240);c.LightSystem.noLights();c.GraphicsCommands.reset();c.BlendControls.animationStyle(c.BlendControls.animationStyles.normal);c.BackgroundPainter.resetGradientStack();if(c.DrawFunctionRunner.drawFunction){f();try{c.DrawFunctionRunner.runDrawFunction()}catch(d){a.trigger("runtime-error-thrown",
d);return}c.DrawFunctionRunner.putTicksNextToDoOnceBlocksThatHaveBeenRun(c.CodeTransformer)}else c.dozingOff=true;frame===0&&c.TimeKeeper.resetTime();c.BlendControls.animationStyleUpdateIfChanged();c.BackgroundPainter.simpleGradientUpdateIfChanged();c.SoundSystem.changeUpdatesPerMinuteIfNeeded();frame++;c.Renderer.render(c.GraphicsCommands);b.update()};return d},createThreeJsSystem=function(a,b,c,d,e){var f={isWebGLUsed:false,composer:{}};f.blendedThreeJsSceneCanvas;f.forceCanvasRenderer=d;if(!f.forceCanvasRenderer&&
a.webgl){f.ballDefaultDetLevel=16;c||(c=document.createElement("canvas"));f.blendedThreeJsSceneCanvas=c;f.renderer=new e.WebGLRenderer({canvas:f.blendedThreeJsSceneCanvas,preserveDrawingBuffer:false,antialias:false,premultipliedAlpha:false});f.isWebGLUsed=true}else{f.ballDefaultDetLevel=6;if(!f.currentFrameThreeJsSceneCanvas)f.currentFrameThreeJsSceneCanvas=document.createElement("canvas");f.currentFrameThreeJsSceneCanvasContext=f.currentFrameThreeJsSceneCanvas.getContext("2d");f.renderer=new e.CanvasRenderer({canvas:f.currentFrameThreeJsSceneCanvas,
antialias:true,preserveDrawingBuffer:false});f.previousFrameThreeJSSceneRenderForBlendingCanvas=document.createElement("canvas");f.previousFrameThreeJSSceneRenderForBlendingCanvas.width=window.innerWidth;f.previousFrameThreeJSSceneRenderForBlendingCanvas.height=window.innerHeight;f.previousFrameThreeJSSceneRenderForBlendingCanvasContext=f.previousFrameThreeJSSceneRenderForBlendingCanvas.getContext("2d");f.blendedThreeJsSceneCanvas=document.getElementById("blendedThreeJsSceneCanvas");f.blendedThreeJsSceneCanvas.width=
window.innerWidth;f.blendedThreeJsSceneCanvas.height=window.innerWidth;f.blendedThreeJsSceneCanvasContext=f.blendedThreeJsSceneCanvas.getContext("2d")}f.renderer.setSize(window.innerWidth,window.innerHeight);f.scene=new e.Scene;f.scene.matrixAutoUpdate=false;f.camera=new e.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,1E4);f.camera.position.set(0,0,5);f.scene.add(f.camera);b.WindowResize.bind(f.renderer,f.camera);f.buildPostprocessingChain=function(){var a,b,c,d;a={format:e.RGBAFormat,
stencilBuffer:true};b=new e.WebGLRenderTarget(window.innerWidth,window.innerHeight,a);a=new e.SavePass(new e.WebGLRenderTarget(window.innerWidth,window.innerHeight,a));a.clear=false;f.effectBlend=new e.ShaderPass(e.ShaderExtras.blend,"tDiffuse1");c=new e.ShaderPass(e.ShaderExtras.screen);f.effectBlend.uniforms.tDiffuse2.value=a.renderTarget;f.effectBlend.uniforms.mixRatio.value=0;d=new e.RenderPass(f.scene,f.camera);f.composer=new e.EffectComposer(f.renderer,b);f.composer.addPass(d);f.composer.addPass(f.effectBlend);
f.composer.addPass(a);f.composer.addPass(c);c.renderToScreen=true};f.isWebGLUsed&&f.buildPostprocessingChain();return f},createRenderer=function(a){return{render:function(b){var c,d;for(c=0;c<a.ThreeJsSystem.scene.children.length;c=c+1){d=a.ThreeJsSystem.scene.children[c];if(b.objectsUsedInFrameCounts[d.primitiveType+d.detailLevel]>0){d.visible=true;b.objectsUsedInFrameCounts[d.primitiveType+d.detailLevel]=b.objectsUsedInFrameCounts[d.primitiveType+d.detailLevel]-1}else d.visible=false}if(a.ThreeJsSystem.isWebGLUsed)a.ThreeJsSystem.composer.render();
else{a.ThreeJsSystem.renderer.render(a.ThreeJsSystem.scene,a.ThreeJsSystem.camera);a.ThreeJsSystem.blendedThreeJsSceneCanvasContext.globalAlpha=1;a.ThreeJsSystem.blendedThreeJsSceneCanvasContext.clearRect(0,0,window.innerWidth,window.innerHeight);a.ThreeJsSystem.blendedThreeJsSceneCanvasContext.globalAlpha=a.BlendControls.blendAmount;a.ThreeJsSystem.blendedThreeJsSceneCanvasContext.drawImage(a.ThreeJsSystem.previousFrameThreeJSSceneRenderForBlendingCanvas,0,0);a.ThreeJsSystem.blendedThreeJsSceneCanvasContext.globalAlpha=
1;a.ThreeJsSystem.blendedThreeJsSceneCanvasContext.drawImage(a.ThreeJsSystem.currentFrameThreeJsSceneCanvas,0,0);a.ThreeJsSystem.previousFrameThreeJSSceneRenderForBlendingCanvasContext.globalCompositeOperation="copy";a.ThreeJsSystem.previousFrameThreeJSSceneRenderForBlendingCanvasContext.drawImage(a.ThreeJsSystem.blendedThreeJsSceneCanvas,0,0);a.ThreeJsSystem.currentFrameThreeJsSceneCanvasContext.clearRect(0,0,window.innerWidth,window.innerHeight)}}}},createColours=function(){var a,b,c;a=["aliceblue",
"0xfff0f8ff","antiquewhite","0xfffaebd7","aqua","0xff00ffff","aquamarine","0xff7fffd4","azure","0xfff0ffff","beige","0xfff5f5dc","bisque","0xffffe4c4","black","0xff000000","blanchedalmond","0xffffebcd","blue","0xff0000ff","blueviolet","0xff8a2be2","brown","0xffa52a2a","burlywood","0xffdeb887","cadetblue","0xff5f9ea0","chartreuse","0xff7fff00","chocolate","0xffd2691e","coral","0xffff7f50","cornflowerblue","0xff6495ed","cornsilk","0xfffff8dc","crimson","0xffdc143c","cyan","0xff00ffff","darkblue","0xff00008b",
"darkcyan","0xff008b8b","darkgoldenrod","0xffb8860b","darkgray","0xffa9a9a9","darkgrey","0xffa9a9a9","darkgreen","0xff006400","darkkhaki","0xffbdb76b","darkmagenta","0xff8b008b","darkolivegreen","0xff556b2f","darkorange","0xffff8c00","darkorchid","0xff9932cc","darkred","0xff8b0000","darksalmon","0xffe9967a","darkseagreen","0xff8fbc8f","darkslateblue","0xff483d8b","darkslategray","0xff2f4f4f","darkslategrey","0xff2f4f4f","darkturquoise","0xff00ced1","darkviolet","0xff9400d3","deeppink","0xffff1493",
"deepskyblue","0xff00bfff","dimgray","0xff696969","dimgrey","0xff696969","dodgerblue","0xff1e90ff","firebrick","0xffb22222","floralwhite","0xfffffaf0","forestgreen","0xff228b22","fuchsia","0xffff00ff","gainsboro","0xffdcdcdc","ghostwhite","0xfff8f8ff","gold","0xffffd700","goldenrod","0xffdaa520","gray","0xff808080","grey","0xff808080","green","0xff008000","greenyellow","0xffadff2f","honeydew","0xfff0fff0","hotpink","0xffff69b4","indianred","0xffcd5c5c","indigo","0xff4b0082","ivory","0xfffffff0","khaki",
"0xfff0e68c","lavender","0xffe6e6fa","lavenderblush","0xfffff0f5","lawngreen","0xff7cfc00","lemonchiffon","0xfffffacd","lightblue","0xffadd8e6","lightcoral","0xfff08080","lightcyan","0xffe0ffff","lightgoldenrodyellow","0xfffafad2","lightgrey","0xffd3d3d3","lightgray","0xffd3d3d3","lightgreen","0xff90ee90","lightpink","0xffffb6c1","lightsalmon","0xffffa07a","lightseagreen","0xff20b2aa","lightskyblue","0xff87cefa","lightslategray","0xff778899","lightslategrey","0xff778899","lightsteelblue","0xffb0c4de",
"lightyellow","0xffffffe0","lime","0xff00ff00","limegreen","0xff32cd32","linen","0xfffaf0e6","magenta","0xffff00ff","maroon","0xff800000","mediumaquamarine","0xff66cdaa","mediumblue","0xff0000cd","mediumorchid","0xffba55d3","mediumpurple","0xff9370d8","mediumseagreen","0xff3cb371","mediumslateblue","0xff7b68ee","mediumspringgreen","0xff00fa9a","mediumturquoise","0xff48d1cc","mediumvioletred","0xffc71585","midnightblue","0xff191970","mintcream","0xfff5fffa","mistyrose","0xffffe4e1","moccasin","0xffffe4b5",
"navajowhite","0xffffdead","navy","0xff000080","oldlace","0xfffdf5e6","olive","0xff808000","olivedrab","0xff6b8e23","orange","0xffffa500","orangered","0xffff4500","orchid","0xffda70d6","palegoldenrod","0xffeee8aa","palegreen","0xff98fb98","paleturquoise","0xffafeeee","palevioletred","0xffd87093","papayawhip","0xffffefd5","peachpuff","0xffffdab9","peru","0xffcd853f","pink","0xffffc0cb","plum","0xffdda0dd","powderblue","0xffb0e0e6","purple","0xff800080","red","0xffff0000","rosybrown","0xffbc8f8f","royalblue",
"0xff4169e1","saddlebrown","0xff8b4513","salmon","0xfffa8072","sandybrown","0xfff4a460","seagreen","0xff2e8b57","seashell","0xfffff5ee","sienna","0xffa0522d","silver","0xffc0c0c0","skyblue","0xff87ceeb","slateblue","0xff6a5acd","slategray","0xff708090","slategrey","0xff708090","snow","0xfffffafa","springgreen","0xff00ff7f","steelblue","0xff4682b4","tan","0xffd2b48c","teal","0xff008080","thistle","0xffd8bfd8","tomato","0xffff6347","turquoise","0xff40e0d0","violet","0xffee82ee","wheat","0xfff5deb3",
"white","0xffffffff","whitesmoke","0xfff5f5f5","yellow","0xffffff00","yellowgreen","0xff9acd32","angleColor","-16777217"];b=[];for(c=0;c<a.length;c=c+2){window[a[c]]=parseInt(a[c+1],16);b.push(a[c])}return b},Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,
getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";if(!this.webgl)a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':
'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.';return a},addGetWebGLMessage:function(a){var b,c,a=a||{};b=a.parent!==void 0?a.parent:document.body;a=a.id!==void 0?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}},badgeHeight=16,Stats=function(){var a,b,c=1,d=0,e=Date.now(),f=e,h=e,g=0,i=1E3,j=
0,k,o,p,m=[[0,0,0],[255,255,255]],q=0,n=1E3,s=0,r,v,x,w=[[0,0,0],[255,255,255]];a=document.createElement("div");a.setAttribute("id","statsWidget");a.style.display="none";a.style.cursor="pointer";a.style.cursor="pointer";a.style.width="74px";a.style.zIndex="6";a.addEventListener("mousedown",function(a){a.preventDefault();c=(c+1)%2;if(c==0){k.style.display="block";r.style.display="none"}else{k.style.display="none";r.style.display="block"}},false);k=document.createElement("div");k.style.textAlign="right";
k.style.lineHeight="1.2em";k.style.backgroundColor="rgb(0,0,0)";k.style.padding="0 0 0px 0px";k.style.display="none";a.appendChild(k);o=document.createElement("div");o.style.fontFamily="Helvetica, Arial, sans-serif";o.style.fontSize="9px";o.style.color="rgb("+m[1][0]+","+m[1][1]+","+m[1][2]+")";o.style.fontWeight="bold";o.innerHTML="FPS";k.appendChild(o);p=document.createElement("div");p.style.position="relative";p.style.width="74px";p.style.height=badgeHeight+"px";p.style.backgroundColor="rgb("+
m[1][0]+","+m[1][1]+","+m[1][2]+")";for(k.appendChild(p);p.children.length<74;){b=document.createElement("span");b.style.width="1px";b.style.height=badgeHeight+"px";b.style.cssFloat="left";b.style.backgroundColor="rgb("+m[0][0]+","+m[0][1]+","+m[0][2]+")";p.appendChild(b)}r=document.createElement("div");r.style.textAlign="right";r.style.lineHeight="1.2em";r.style.backgroundColor="rgb(0,0,0)";r.style.padding="0 0 0px 0px";r.style.display="block";a.appendChild(r);v=document.createElement("div");v.style.fontFamily=
"Helvetica, Arial, sans-serif";v.style.fontSize="9px";v.style.color="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")";v.style.fontWeight="bold";v.innerHTML="MS";r.appendChild(v);x=document.createElement("div");x.style.position="relative";x.style.width="74px";x.style.height=badgeHeight+"px";x.style.backgroundColor="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")";for(r.appendChild(x);x.children.length<74;){b=document.createElement("span");b.style.width="1px";b.style.height=Math.random()*badgeHeight+"px";b.style.cssFloat=
"left";b.style.backgroundColor="rgb("+w[0][0]+","+w[0][1]+","+w[0][2]+")";x.appendChild(b)}return{getDomElement:function(){return a},getFps:function(){return g},getFpsMin:function(){return i},getFpsMax:function(){return j},getMs:function(){return q},getMsMin:function(){return n},getMsMax:function(){return s},update:function(){e=Date.now();q=e-f;n=Math.min(n,q);s=Math.max(s,q);v.textContent=q+" MS ";var a=Math.min(badgeHeight,badgeHeight-q/200*badgeHeight);x.appendChild(x.firstChild).style.height=
a+"px";f=e;d++;if(e>h+1E3){g=Math.round(d*1E3/(e-h));i=Math.min(i,g);j=Math.max(j,g);o.textContent=g+" FPS ("+i+"-"+j+")";a=Math.min(badgeHeight,badgeHeight-g/100*badgeHeight);p.appendChild(p.firstChild).style.height=a+"px";h=e;d=0}}}},THREEx=THREEx||{};
THREEx.WindowResize=function(a,b){var c=function(){a.setSize(window.innerWidth,window.innerHeight);b.aspect=window.innerWidth/window.innerHeight;b.updateProjectionMatrix()};window.addEventListener("resize",c,false);return{stop:function(){window.removeEventListener("resize",c)}}};THREEx.WindowResize.bind=function(a,b){return THREEx.WindowResize(a,b)};
THREE.ShaderExtras={screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},convolution:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},
uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"uniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvUv = uv - ( ( KERNEL_SIZE - 1.0 ) / 2.0 ) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cKernel[ KERNEL_SIZE ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i = 0; i < KERNEL_SIZE; i ++ ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
bokeh:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:0.025},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"},
dofmipmap:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float focus;\nuniform float maxblur;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\nvoid main() {\nvec4 depth = texture2D( tDepth, vUv );\nfloat factor = depth.x - focus;\nvec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );\ngl_FragColor = col;\ngl_FragColor.a = 1.0;\n}"},
sepia:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},amount:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"},
dotscreen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(0.5,0.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"},
vignette:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"},
bleachbypass:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"},
focus:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:0.94},waveFactor:{type:"f",value:0.00125}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float sampleDistance;\nuniform float waveFactor;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( tDiffuse, uv );\nvin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );\nsample_dist = dot( vin, vin ) * 2.0;\nf = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\ncolor = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );\ncolor = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );\ngl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );\n}"},
triangleBlur:{uniforms:{texture:{type:"t",value:0,texture:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define ITERATIONS 10.0\nuniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 vUv;\nfloat random( vec3 scale, float seed ) {\nreturn fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );\n}\nvoid main() {\nvec4 color = vec4( 0.0 );\nfloat total = 0.0;\nfloat offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );\nfor ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {\nfloat percent = ( t + offset - 0.5 ) / ITERATIONS;\nfloat weight = 1.0 - abs( percent );\ncolor += texture2D( texture, vUv + delta * percent ) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}"},
basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"},horizontalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \tvUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t  ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\ngl_FragColor = sum;\n}"},
horizontalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \t vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat vv = v * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t   ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;\ngl_FragColor = sum;\n}"},
blend:{uniforms:{tDiffuse1:{type:"t",value:0,texture:null},tDiffuse2:{type:"t",value:1,texture:null},mixRatio:{type:"f",value:0.5},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform float mixRatio;\nuniform sampler2D tDiffuse1;\nuniform sampler2D tDiffuse2;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel1 = texture2D( tDiffuse1, vUv );\nvec4 texel2 = texture2D( tDiffuse2, vUv );\nvec3 ca = vec3(texel1.x,texel1.y,texel1.z);\nvec3 cb = vec3(texel2.x,texel2.y,texel2.z);\nfloat alphaa = texel1.w ;\nfloat alphab = texel2.w*mixRatio;\nfloat alphao = (alphaa + alphab * (1.0-alphaa));\nvec3 co = (1.0/alphao) * (ca * alphaa + cb*alphab*(1.0-alphaa));\nvec4 mixxx = vec4(co, alphao );\ngl_FragColor =  mixxx;\n}"},
fxaa:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nfloat opacity  = rgbaM.w;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec3 rgbA = 0.5 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );\nfloat lumaB = dot( rgbB, luma );\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\ngl_FragColor = vec4( rgbA, opacity );\n} else {\ngl_FragColor = vec4( rgbB, opacity );\n}\n}"},
luminosity:{uniforms:{tDiffuse:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"},colorCorrection:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},powRGB:{type:"v3",value:new THREE.Vector3(2,2,2)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 powRGB;\nuniform vec3 mulRGB;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );\n}"},
normalmap:{uniforms:{heightMap:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(512,512)},scale:{type:"v2",value:new THREE.Vector2(1,1)},height:{type:"f",value:0.05}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"},
ssao:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},aoClamp:{type:"f",value:0.3}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform vec2 size;\nuniform float aoClamp;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 8;\nconst float radius = 5.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0002;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst bool onlyAO = false;\nconst float lumInfluence = 0.3;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"},
colorify:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"},
unpackDepthRGBA:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvoid main() {\nfloat depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );\ngl_FragColor = opacity * vec4( vec3( depth ), 1.0 );\n}"},
buildKernel:function(a){var b,c,d,e,f=2*Math.ceil(a*3)+1;f>25&&(f=25);e=(f-1)*0.5;c=Array(f);for(b=d=0;b<f;++b){c[b]=Math.exp(-((b-e)*(b-e))/(2*a*a));d=d+c[b]}for(b=0;b<f;++b)c[b]=c[b]/d;return c}};
THREE.EffectComposer=function(a,b){this.renderer=a;this.renderTarget1=b;if(this.renderTarget1===void 0){var c=window.innerWidth||1,d=window.innerHeight||1;this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};this.renderTarget1=new THREE.WebGLRenderTarget(c,d,this.renderTargetParameters)}this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=
new THREE.ShaderPass(THREE.ShaderExtras.screen)};
THREE.EffectComposer.prototype={swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=a},addPass:function(a){this.passes.push(a)},render:function(a){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var b=false,c,d,e=this.passes.length;for(d=0;d<e;d++){c=this.passes[d];if(c.enabled){c.render(this.renderer,this.writeBuffer,this.readBuffer,a,b);if(c.needsSwap){if(b){var f=this.renderer.context;f.stencilFunc(f.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,
this.writeBuffer,this.readBuffer,a);f.stencilFunc(f.EQUAL,1,4294967295)}this.swapBuffers()}c instanceof THREE.MaskPass?b=true:c instanceof THREE.ClearMaskPass&&(b=false)}}},reset:function(a){this.renderTarget1=a;if(this.renderTarget1===void 0)this.renderTarget1=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters);this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2}};
THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null);THREE.EffectComposer.scene=new THREE.Scene;THREE.EffectComposer.scene.add(THREE.EffectComposer.quad);THREE.RenderPass=function(a,b,c,d,e){this.scene=a;this.camera=b;this.overrideMaterial=c;this.clearColor=d;this.clearAlpha=e!==void 0?e:1;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.clear=this.enabled=true;this.needsSwap=false};
THREE.RenderPass.prototype={render:function(a,b,c){this.scene.overrideMaterial=this.overrideMaterial;if(this.clearColor){this.oldClearColor.copy(a.getClearColor());this.oldClearAlpha=a.getClearAlpha();a.setClearColor(this.clearColor,this.clearAlpha)}a.render(this.scene,this.camera,c,this.clear);this.clearColor&&a.setClearColor(this.oldClearColor,this.oldClearAlpha);this.scene.overrideMaterial=null}};
THREE.ShaderPass=function(a,b){this.textureID=b!==void 0?b:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader});this.renderToScreen=false;this.needsSwap=this.enabled=true;this.clear=false};
THREE.ShaderPass.prototype={render:function(a,b,c){if(this.uniforms[this.textureID])this.uniforms[this.textureID].value=c;THREE.EffectComposer.quad.material=this.material;this.renderToScreen?a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,b,this.clear)}};THREE.MaskPass=function(a,b){this.scene=a;this.camera=b;this.clear=this.enabled=true;this.inverse=this.needsSwap=false};
THREE.MaskPass.prototype={render:function(a,b,c){var d=a.context;d.colorMask(false,false,false,false);d.depthMask(false);var e,f;if(this.inverse){e=0;f=1}else{e=1;f=0}d.enable(d.STENCIL_TEST);d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE);d.stencilFunc(d.ALWAYS,e,4294967295);d.clearStencil(f);a.render(this.scene,this.camera,c,this.clear);a.render(this.scene,this.camera,b,this.clear);d.colorMask(true,true,true,true);d.depthMask(true);d.stencilFunc(d.EQUAL,1,4294967295);d.stencilOp(d.KEEP,d.KEEP,d.KEEP)}};
THREE.ClearMaskPass=function(){this.enabled=true};THREE.ClearMaskPass.prototype={render:function(a){a=a.context;a.disable(a.STENCIL_TEST)}};
THREE.SavePass=function(a){var b=THREE.ShaderExtras.screen;this.textureID="tDiffuse";this.uniforms=THREE.UniformsUtils.clone(b.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader});this.renderTarget=a;if(this.renderTarget===void 0){this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};this.renderTarget=new THREE.WebGLRenderTarget(window.innerWidth,
window.innerHeight,this.renderTargetParameters)}this.enabled=true;this.clear=this.needsSwap=false};THREE.SavePass.prototype={render:function(a,b,c){if(this.uniforms[this.textureID])this.uniforms[this.textureID].value=c;THREE.EffectComposer.quad.material=this.material;a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTarget,this.clear)}};
CodeMirror.defineMode("livecodelab",function(a){function b(a){return RegExp("^(("+a.join(")|(")+"))\\b")}function c(a,b){if(a.sol()){var c=b.scopes[0].offset;if(a.eatSpace()){var e=a.indentation();return e>c?"indent":e<c?"dedent":null}c>0&&f(a,b)}if(a.eatSpace())return null;c=a.peek();if(c==="#"){a.skipToEnd();return"comment"}if(c==="/"&&a.match(/\/\//i)){a.skipToEnd();return"comment"}if(a.match(/^-?[0-9\.]/,false)){c=false;a.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)&&(c=true);a.match(/^-?\d+\.\d*/)&&(c=
true);a.match(/^-?\.\d+/)&&(c=true);if(c)return"number";c=false;a.match(/^-?0x[0-9a-f]+/i)&&(c=true);a.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)&&(c=true);a.match(/^-?0(?![\dx])/i)&&(c=true);if(c)return"number"}if(a.match(r)){b.tokenize=d(a.current(),"string");return b.tokenize(a,b)}if(a.match(v)){if(a.current()!="/"||a.match(/^.*\//,false)){b.tokenize=d(a.current(),"string-2");return b.tokenize(a,b)}a.backUp(1)}if(a.match(p)||a.match(o))return"punctuation";if(a.match(k)||a.match(i)||a.match(q))return"operator";
if(a.match(j))return"punctuation";if(a.match(x))return"atom";if(a.match(s))return"keyword";if(a.match(m))return"variable";a.next();return g}function d(b,d){var e=RegExp(b),f=b.length==1;return function(b,j){for(;!b.eol();){b.eatWhile(/[^'"\/\\]/);if(b.eat("\\")){b.next();if(f&&b.eol())return d}else{if(b.match(e)){j.tokenize=c;return d}b.eat(/['"\/]/)}}if(f)a.mode.singleLineStringErrors?d=g:j.tokenize=c;return d}}function e(b,c,g){var g=g||"coffee",d=0;if(g==="coffee")for(b=0;b<c.scopes.length;b++){if(c.scopes[b].type===
"coffee"){d=c.scopes[b].offset+a.indentUnit;break}}else d=b.column()+b.current().length;c.scopes.unshift({offset:d,type:g})}function f(a,b){if(b.scopes.length!=1){if(b.scopes[0].type==="coffee"){for(var c=a.indentation(),g=-1,d=0;d<b.scopes.length;++d)if(c===b.scopes[d].offset){g=d;break}if(g===-1)return true;for(;b.scopes[0].offset!==c;)b.scopes.shift()}else b.scopes.shift();return false}}function h(a,b){var c=b.tokenize(a,b),d=a.current();if(d==="."){c=b.tokenize(a,b);a.current();return c==="variable"?
"variable":g}if(d==="@"){c=b.tokenize(a,b);a.current();return c==="variable"?"variable-2":g}if(d==="return")b.dedent=b.dedent+1;((d==="->"||d==="=>")&&!b.lambda&&b.scopes[0].type=="coffee"&&a.peek()===""||c==="indent")&&e(a,b);var j="[({".indexOf(d);j!==-1&&e(a,b,"])}".slice(j,j+1));n.exec(d)&&e(a,b);d=="then"&&f(a,b);if(c==="dedent"&&f(a,b))return g;j="])}".indexOf(d);if(j!==-1&&f(a,b))return g;if(b.dedent>0&&a.eol()&&b.scopes[0].type=="coffee"){b.scopes.length>1&&b.scopes.shift();b.dedent=b.dedent-
1}return c}var g="error",i=/^[\+\-\*/%&|\^~<>!?]/,j=/^[\(\)\[\]\{\}@,:`=;\.]/,k=RegExp("^((->)|(=>)|(\\+\\+)|(\\+\\=)|(\\-\\-)|(\\-\\=)|(\\*\\*)|(\\*\\=)|(\\/\\/)|(\\/\\=)|(==)|(!=)|(<=)|(>=)|(<>)|(<<)|(>>)|(//))"),o=/^((\.\.)|(\+=)|(\-=)|(\*=)|(%=)|(\/=)|(&=)|(\|=)|(\^=))/,p=/^((\.\.\.)|(\/\/=)|(>>=)|(<<=)|(\*\*=))/,m=/^[_A-Za-z][_A-Za-z0-9]*/,q=b(["and","or","not","is","isnt","in","instanceof","typeof"]),n=["draw","for","while","loop","if","unless","else","switch","try","catch","finally","class"],
s=b(n.concat(["break","by","continue","debugger","delete","do","in","of","new","return","then","this","throw","when","until"])),n=b(n),r=/^('{3}|"{3}|['"])/,v=/^(\/{3}|\/)/,x=b(["Infinity","NaN","undefined","null","true","false","on","off","yes","no"]);return{startState:function(a){return{tokenize:c,scopes:[{offset:a||0,type:"coffee"}],lastToken:null,lambda:false,dedent:0}},token:function(a,b){if(a.match(/\/\/\s*(next-tutorial:([^\s]+))\b/))return"link";var c=h(a,b);b.lastToken={style:c,content:a.current()};
if(a.eol()&&a.lambda)b.lambda=false;return c},indent:function(a){return a.tokenize!=c?0:a.scopes[0].offset}}});CodeMirror.defineMIME("text/x-coffeescript","coffeescript");Number.prototype.times=function(a,b){for(var c=this.valueOf(),d=0;d<c;d++)a.call(b||window,d)};window.back=function(){};window.forward=function(){};window.close=function(){};
var createBackgroundPainter=function(a,b){var c=[],d=orange,e=red,f=black,h,g="",i=0,j={simpleGradient:function(a,d,e,f){g=g+" "+a+""+d+""+e+""+f+"null ";c.push({gradStacka:b.ColourFunctions.color(a),gradStackb:b.ColourFunctions.color(d),gradStackc:b.ColourFunctions.color(e),gradStackd:b.ColourFunctions.color(f),solid:null})},background:function(a,d,e,f){a=b.ColourFunctions.color(a,d,e,f);g=g+" null null null null "+a+" ";c.push({gradStacka:void 0,gradStackb:void 0,gradStackc:void 0,gradStackd:void 0,
solid:a})},paintARandomBackground:function(){h=h===void 0?Math.floor(Math.random()*5):(h+1)%5;switch(h){case 0:d=orange;e=red;f=black;$("#fakeStartingBlinkingCursor").css("color","white");break;case 1:d=white;e=khaki;f=peachpuff;$("#fakeStartingBlinkingCursor").css("color","LightPink");break;case 2:d=lightsteelblue;e=lightcyan;f=paleturquoise;$("#fakeStartingBlinkingCursor").css("color","CadetBlue");break;case 3:d=silver;e=lightgrey;f=gainsboro;$("#fakeStartingBlinkingCursor").css("color","white");
break;case 4:d=b.ColourFunctions.color(155,255,155);e=b.ColourFunctions.color(155,255,155);f=b.ColourFunctions.color(155,255,155);$("#fakeStartingBlinkingCursor").css("color","DarkOliveGreen")}j.resetGradientStack();j.simpleGradientUpdateIfChanged()},resetGradientStack:function(){g="";c=[];j.simpleGradient(d,e,f)},simpleGradientUpdateIfChanged:function(){var a,d;if(g!==i){i=g;Math.sqrt(Math.pow(b.canvasForBackground.width/2,2)+Math.pow(b.canvasForBackground.height/2,2));for(d=0;d<c.length;d++){if(c[d].gradStacka!==
void 0){a=b.backgroundSceneContext.createLinearGradient(b.canvasForBackground.width/2,0,b.canvasForBackground.width/2,b.canvasForBackground.height);a.addColorStop(0,b.ColourFunctions.color.toString(c[d].gradStacka));a.addColorStop(0.5,b.ColourFunctions.color.toString(c[d].gradStackb));a.addColorStop(1,b.ColourFunctions.color.toString(c[d].gradStackc));b.backgroundSceneContext.globalAlpha=1;b.backgroundSceneContext.fillStyle=a}else{b.backgroundSceneContext.globalAlpha=1;b.backgroundSceneContext.fillStyle=
b.ColourFunctions.color.toString(c[d].solid)}b.backgroundSceneContext.fillRect(0,0,b.canvasForBackground.width,b.canvasForBackground.height)}}}};window.simpleGradient=j.simpleGradient;window.background=j.background;return j},createEditor=function(a,b){var c;c=b.fromTextArea(document.getElementById("code"),{mode:"livecodelab",theme:"night",lineNumbers:false,indentWithTabs:true,tabSize:1,indentUnit:1,lineWrapping:true,onBlur:function(){setTimeout(c.focus,30)},onChange:function(b){a.trigger("code_changed",
b.getValue())},onCursorActivity:function(b){var c,f;c=b.getCursor(true);if(c.ch>2){c=b.getLine(c.line);if(c.indexOf("// next-tutorial:")===0){c=c.substring(17);c=c.replace("_","");f=c+"Tutorial";setTimeout(function(){a.trigger("load-program",f)},200)}}b.getValue()!==""&&a.trigger("editor-undim")}});a.bind("reset",function(){c.setValue("")});a.bind("code-updated-by-livecodelab",function(a){var b=c.getCursor();b.ch=b.ch+1;c.setValue(a);c.setCursor(b)});return c},createColourFunctions=function(){var a=
{},b=255,c=255,d=255,e,f,h,g,i;a.colorModeA=255;e=1;f=function(g,f,h,p){if(e===3){h=a.color.toRGB(g,f,h);g=h[0];f=h[1];h=h[2]}else{g=Math.round(255*(g/b));f=Math.round(255*(f/c));h=Math.round(255*(h/d))}p=Math.round(255*(p/a.colorModeA));g=g<0?0:g;f=f<0?0:f;h=h<0?0:h;p=p<0?0:p;return(p>255?255:p)<<24&4278190080|(g>255?255:g)<<16&16711680|(f>255?255:f)<<8&65280|(h>255?255:h)&255};h=function(c,g){var h;if(c===-16777217)return-16777217;if(c&4278190080){h=Math.round(255*(g/a.colorModeA));h=h>255?255:
h;return c-(c&4278190080)+((h<0?0:h)<<24&4278190080)}if(e===1)return f(c,c,c,g);if(e===3)return f(0,0,c/b*d,g)};g=function(c){if(c<=b&&c>=0){if(e===1)return f(c,c,c,a.colorModeA);if(e===3)return f(0,0,c/b*d,a.colorModeA)}if(c){c>2147483647&&(c=c-4294967296);return c}};a.color=function(e,k,i,p){return e!==void 0&&k!==void 0&&i!==void 0&&p!==void 0?f(e,k,i,p):e!==void 0&&k!==void 0&&i!==void 0?f(e,k,i,a.colorModeA):e!==void 0&&k!==void 0?h(e,k):typeof e==="number"?g(e):f(b,c,d,a.colorModeA)};a.color.toString=
function(a){return"rgba("+((a&16711680)>>>16)+","+((a&65280)>>>8)+","+(a&255)+","+((a&4278190080)>>>24)/255+")"};a.color.toInt=function(a,b,c,g){return g<<24&4278190080|a<<16&16711680|b<<8&65280|c&255};a.color.toArray=function(a){return[(a&16711680)>>>16,(a&65280)>>>8,a&255,(a&4278190080)>>>24]};a.color.toGLArray=function(a){return[((a&16711680)>>>16)/255,((a&65280)>>>8)/255,(a&255)/255,((a&4278190080)>>>24)/255]};a.color.toRGB=function(a,g,e){var f,h,i,n,a=a>b?b:a,g=g>c?c:g,e=e>d?d:e,a=a/b*360,g=
g/c*100,e=e/d*100;f=Math.round(e/100*255);if(g===0)return[f,f,f];a=a%360;h=a%60;i=Math.round(e*(100-g)/1E4*255);n=Math.round(e*(6E3-g*h)/6E5*255);g=Math.round(e*(6E3-g*(60-h))/6E5*255);switch(Math.floor(a/60)){case 0:return[f,g,i];case 1:return[n,f,i];case 2:return[i,f,g];case 3:return[i,n,f];case 4:return[g,i,f];case 5:return[f,i,n]}};window.color=a.color;window.colorToHSB=a.colorToHSB=function(a){var g,e,f,h;g=((a&16711680)>>>16)/255;e=((a&65280)>>>8)/255;f=(a&255)/255;h=max(max(g,e),f);a=min(min(g,
e),f);if(a===h)return[0,0,h*d];g=(g===h?(e-f)/(h-a):e===h?2+(f-g)/(h-a):4+(g-e)/(h-a))/6;g<0?g=g+1:g>1&&(g=g-1);return[g*b,(h-a)/h*c,h*d]};window.brightness=a.brightness=function(b){return a.colorToHSB(b)[2]};window.saturation=a.saturation=function(b){return a.colorToHSB(b)[1]};window.hue=a.hue=function(b){return a.colorToHSB(b)[0]};window.redF=a.redF=function(a){return((a&16711680)>>>16)/255*b};window.greenF=a.greenF=function(a){return((a&65280)>>>8)/255*c};window.blueF=a.blueF=function(a){return(a&
255)/255*d};window.alpha=a.alpha=function(b){return((b&4278190080)>>>24)/255*a.colorModeA};window.alphaZeroToOne=a.alphaZeroToOne=function(a){return((a&4278190080)>>>24)/255};window.lerp=a.lerp=function(a,b,c){return(b-a)*c+a};window.lerpColor=a.lerpColor=function(b,c,g){var d,f,h,i,s,r;d=a.color(b);f=a.color(c);if(e===3){h=a.colorToHSB(d);c=((d&4278190080)>>>24)/a.colorModeA;d=a.colorToHSB(f);b=((f&4278190080)>>>24)/a.colorModeA;r=a.lerp(h[0],d[0],g);f=a.lerp(h[1],d[1],g);h=a.lerp(h[2],d[2],g);d=
a.color.toRGB(r,f,h);g=a.lerp(c,b,g)*a.colorModeA;return g<<24&4278190080|d[0]<<16&16711680|d[1]<<8&65280|d[2]&255}i=(d&65280)>>>8;h=d&255;c=((d&4278190080)>>>24)/a.colorModeA;s=(f&65280)>>>8;r=f&255;b=((f&4278190080)>>>24)/a.colorModeA;d=a.lerp((d&16711680)>>>16,(f&16711680)>>>16,g)|0;f=a.lerp(i,s,g)|0;h=a.lerp(h,r,g)|0;g=a.lerp(c,b,g)*a.colorModeA;return g<<24&4278190080|d<<16&16711680|f<<8&65280|h&255};window.colorMode=a.colorMode=function(g,f,h,i,m){e=g;if(arguments.length>1){b=f;c=h||f;d=i||
f;a.colorModeA=m||f}};i=function(){var a=Math.min,b=Math.max,c;c=function(b,c,g,d,e,f,h,i,k,o,t){b=a(((b&4278190080)>>>24)+c,255)<<24;g=g+((k-g)*c>>8);d=d+((o-d)*c>>8);c=e+((t-e)*c>>8);return b|(g<0?0:g>255?255:g)<<16|(d<0?0:d>255?255:d)<<8|(c<0?0:c>255?255:c)};return{replace:function(a,b){return b},blend:function(b,c){var g=(c&4278190080)>>>24,d=b&16711680,e=b&65280,f=b&255,h=c&16711680,i=c&65280,k=c&255;return a(((b&4278190080)>>>24)+g,255)<<24|d+((h-d)*g>>8)&16711680|e+((i-e)*g>>8)&65280|f+((k-
f)*g>>8)&255},add:function(b,c){var g=(c&4278190080)>>>24;return a(((b&4278190080)>>>24)+g,255)<<24|a((b&16711680)+((c&16711680)>>8)*g,16711680)&16711680|a((b&65280)+((c&65280)>>8)*g,65280)&65280|a((b&255)+((c&255)*g>>8),255)},subtract:function(c,g){var d=(g&4278190080)>>>24;return a(((c&4278190080)>>>24)+d,255)<<24|b((c&16711680)-((g&16711680)>>8)*d,65280)&16711680|b((c&65280)-((g&65280)>>8)*d,255)&65280|b((c&255)-((g&255)*d>>8),0)},lightest:function(c,g){var d=(g&4278190080)>>>24;return a(((c&4278190080)>>>
24)+d,255)<<24|b(c&16711680,((g&16711680)>>8)*d)&16711680|b(c&65280,((g&65280)>>8)*d)&65280|b(c&255,(g&255)*d>>8)},darkest:function(b,c){var g=(c&4278190080)>>>24,d=b&16711680,e=b&65280,f=b&255,h=a(b&16711680,((c&16711680)>>8)*g),i=a(b&65280,((c&65280)>>8)*g),k=a(b&255,(c&255)*g>>8);return a(((b&4278190080)>>>24)+g,255)<<24|d+((h-d)*g>>8)&16711680|e+((i-e)*g>>8)&65280|f+((k-f)*g>>8)&255},difference:function(a,b){var g=(a&16711680)>>16,d=(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255;
return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,g>f?g-f:f-g,d>h?d-h:h-d,e>i?e-i:i-e)},exclusion:function(a,b){var g=(a&16711680)>>16,d=(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255;return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,g+f-(g*f>>7),d+h-(d*h>>7),e+i-(e*i>>7))},multiply:function(a,b){var g=(a&16711680)>>16,d=(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255;return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,g*f>>8,d*h>>8,e*i>>8)},screen:function(a,b){var g=(a&16711680)>>16,d=(a&
65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255;return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,255-((255-g)*(255-f)>>8),255-((255-d)*(255-h)>>8),255-((255-e)*(255-i)>>8))},hard_light:function(a,b){var g=(a&16711680)>>16,d=(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255;return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,f<128?g*f>>7:255-((255-g)*(255-f)>>7),h<128?d*h>>7:255-((255-d)*(255-h)>>7),i<128?e*i>>7:255-((255-e)*(255-i)>>7))},soft_light:function(a,b){var g=(a&16711680)>>16,d=
(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255;return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,(g*f>>7)+(g*g>>8)-(g*g*f>>15),(d*h>>7)+(d*d>>8)-(d*d*h>>15),(e*i>>7)+(e*e>>8)-(e*e*i>>15))},overlay:function(a,b){var g=(a&16711680)>>16,d=(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255;return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,g<128?g*f>>7:255-((255-g)*(255-f)>>7),d<128?d*h>>7:255-((255-d)*(255-h)>>7),e<128?e*i>>7:255-((255-e)*(255-i)>>7))},dodge:function(a,b){var g=(a&16711680)>>
16,d=(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255,j,k,t;j=255;if(f!==255){j=(g<<8)/(255-f);j=j<0?0:j>255?255:j}k=255;if(h!==255){k=(d<<8)/(255-h);k=k<0?0:k>255?255:k}t=255;if(i!==255){t=(e<<8)/(255-i);t=t<0?0:t>255?255:t}return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,j,k,t)},burn:function(a,b){var g=(a&16711680)>>16,d=(a&65280)>>8,e=a&255,f=(b&16711680)>>16,h=(b&65280)>>8,i=b&255,j,k,t;j=0;if(f!==0){j=(255-g<<8)/f;j=255-(j<0?0:j>255?255:j)}k=0;if(h!==0){k=(255-d<<8)/h;k=255-(k<0?0:k>
255?255:k)}t=0;if(i!==0){t=(255-e<<8)/i;t=255-(t<0?0:t>255?255:t)}return c(a,(b&4278190080)>>>24,g,d,e,f,h,i,j,k,t)}}}();window.blendColor=a.blendColor=function(a,b,c){if(c===0)return i.replace(a,b);if(c===1)return i.blend(a,b);if(c===2)return i.add(a,b);if(c===4)return i.subtract(a,b);if(c===8)return i.lightest(a,b);if(c===16)return i.darkest(a,b);if(c===32)return i.difference(a,b);if(c===64)return i.exclusion(a,b);if(c===128)return i.multiply(a,b);if(c===256)return i.screen(a,b);if(c===1024)return i.hard_light(a,
b);if(c===2048)return i.soft_light(a,b);if(c===512)return i.overlay(a,b);if(c===4096)return i.dodge(a,b);if(c===8192)return i.burn(a,b)};return a},createMatrixCommands=function(a,b){var c={},d=[],e=new a.Matrix4;c.getWorldMatrix=function(){return e};c.resetMatrixStack=function(){d=[];e.identity()};window.pushMatrix=c.pushMatrix=function(){d.push(e);e=(new a.Matrix4).copy(e)};window.popMatrix=c.popMatrix=function(){d.length!==0?e=d.pop():e.identity()};window.resetMatrix=c.resetMatrix=function(){e.identity()};
window.move=c.move=function(c,d,g){if(arguments.length===0){c=Math.sin(b.TimeKeeper.getTime()/500);d=Math.cos(b.TimeKeeper.getTime()/500);g=c}else if(arguments.length===1)g=d=c;else arguments.length===2&&(g=0);e.translate(new a.Vector3(c,d,g))};window.rotate=c.rotate=function(a,c,g){if(arguments.length===0)g=c=a=b.TimeKeeper.getTime()/1E3;else if(arguments.length===1)g=c=a;else arguments.length===2&&(g=0);e.rotateX(a).rotateY(c).rotateZ(g)};window.scale=c.scale=function(c,d,g){if(arguments.length===
0)g=d=c=1+Math.sin(b.TimeKeeper.getTime()/500)/4;else if(arguments.length===1)g=d=c;else arguments.length===2&&(g=1);c>-1.0E-9&&c<1.0E-9&&(c=1.0E-9);d>-1.0E-9&&d<1.0E-9&&(d=1.0E-9);g>-1.0E-9&&g<1.0E-9&&(g=1.0E-9);e.scale(new a.Vector3(c,d,g))};return c},createGraphicsCommands=function(a,b){var c={},d={},e=true,f=true,h,g,i,j=[],k,o,p,m,q=[];c.objectPools=q;c.ballDetLevel=8;c.currentStrokeSize=1;c.minimumBallDetail=2;c.maximumBallDetail=30;d.ambientLight=0;d.line=1;d.rect=2;d.box=3;d.peg=4;d.ball=
5;c.primitiveTypes=d;q[d.line]=[];q[d.rect]=[];q[d.box]=[];q[d.peg]=[];for(i=0;i<29;i=i+1)q[d.ball+i]=[];j[d.line]=new a.Geometry;j[d.line].vertices.push(new a.Vector3(0,-0.5,0));j[d.line].vertices.push(new a.Vector3(0,0.5,0));j[d.rect]=new a.PlaneGeometry(1,1);j[d.box]=new a.CubeGeometry(1,1,1);j[d.peg]=new a.CylinderGeometry(0.5,0.5,1,32);for(i=0;i<29;i=i+1)j[d.ball+i]=new a.SphereGeometry(1,2+i,2+i);var n=[];c.objectsUsedInFrameCounts=n;c.doTheSpinThingy=true;c.resetTheSpinThingy=false;c.defaultNormalFill=
true;c.defaultNormalStroke=true;k=function(e,f,h,i,k,o,p,m){var y=false,l,z=i.primitiveType+i.detailLevel,B=q[z];l=B[n[z]];if(l===void 0){l={lineMaterial:void 0,basicMaterial:void 0,lambertMaterial:void 0,normalMaterial:void 0,threejsObject3D:new i.THREEObjectConstructor(j[z]),initialSpinCountdown:30};y=true;B.push(l)}if(i.primitiveType===d.line){if(l.lineMaterial===void 0)l.lineMaterial=new a.LineBasicMaterial;if(g===angleColor||c.defaultNormalStroke){o=l.threejsObject3D.matrix.multiplyVector3(new a.Vector3(0,
1,0)).normalize();l.lineMaterial.color.setHex(color((o.x+1)/2*255,(o.y+1)/2*255,(o.z+1)/2*255))}else l.lineMaterial.color.setHex(g);l.lineMaterial.linewidth=c.currentStrokeSize;l.threejsObject3D.material=l.lineMaterial}else if(y||o===angleColor||m){if(l.normalMaterial===void 0)l.normalMaterial=new a.MeshNormalMaterial;l.threejsObject3D.material=l.normalMaterial}else if(b.LightSystem.lightsAreOn){if(l.lambertMaterial===void 0)l.lambertMaterial=new a.MeshLambertMaterial;l.lambertMaterial.color.setHex(o);
l.threejsObject3D.material=l.lambertMaterial}else{if(l.basicMaterial===void 0)l.basicMaterial=new a.MeshBasicMaterial;l.basicMaterial.color.setHex(o);l.threejsObject3D.material=l.basicMaterial}l.threejsObject3D.material.side=i.sidedness;l.threejsObject3D.material.opacity=p;if(p<1)l.threejsObject3D.material.transparent=true;l.threejsObject3D.material.wireframe=k;l.threejsObject3D.material.wireframeLinewidth=c.currentStrokeSize;l.threejsObject3D.material.reflectivity=1;l.threejsObject3D.material.refractionRatio=
0.98;if(c.resetTheSpinThingy){l.initialSpinCountdown=30;c.resetTheSpinThingy=false;c.doTheSpinThingy=true}if(c.doTheSpinThingy)l.initialSpinCountdown=l.initialSpinCountdown-1;if(l.initialSpinCountdown===-1)c.doTheSpinThingy=false;l.threejsObject3D.primitiveType=i.primitiveType;l.threejsObject3D.detailLevel=i.detailLevel;n[z]=n[z]+1;if(c.doTheSpinThingy&&l.initialSpinCountdown>0){b.MatrixCommands.pushMatrix();b.MatrixCommands.rotate(l.initialSpinCountdown/50)}l.threejsObject3D.matrixAutoUpdate=false;
l.threejsObject3D.matrix.copy(b.MatrixCommands.getWorldMatrix());l.threejsObject3D.matrixWorldNeedsUpdate=true;c.doTheSpinThingy&&l.initialSpinCountdown>0&&b.MatrixCommands.popMatrix();if(y)l.threejsObject3D.matrix.scale(new a.Vector3(1.0E-4,1.0E-4,1.0E-4));else if(e!==1||f!==1||h!==1)k?l.threejsObject3D.matrix.scale(new a.Vector3(e+0.0010,f+0.0010,h+0.0010)):l.threejsObject3D.matrix.scale(new a.Vector3(e,f,h));y&&b.ThreeJsSystem.scene.add(l.threejsObject3D)};o=function(a,b,d,i){if(a===void 0)d=b=
a=1;else if(b===void 0)d=b=a;else d===void 0&&(d=1);if(f||e&&i.canFill)if(i.canFill&&e&&(c.currentStrokeSize===0||!f||c.currentStrokeSize<=1&&!c.defaultNormalFill&&!c.defaultNormalStroke&&g===m&&p===1&&h===1)||c.currentStrokeSize<=1&&c.defaultNormalFill&&c.defaultNormalStroke)k(a,b,d,i,false,m,p,c.defaultNormalFill);else if((!e||!i.canFill)&&f)k(a,b,d,i,true,g,h,c.defaultNormalStroke);else{k(a,b,d,i,true,g,h,c.defaultNormalStroke);k(a,b,d,i,false,m,p,c.defaultNormalFill)}};c.reset=function(){c.fill(4294967295);
c.stroke(4294967295);c.currentStrokeSize=1;c.defaultNormalFill=true;c.defaultNormalStroke=true;c.ballDetLevel=b.ThreeJsSystem.ballDefaultDetLevel;c.objectsUsedInFrameCounts[c.primitiveTypes.ambientLight]=0;c.objectsUsedInFrameCounts[c.primitiveTypes.line]=0;c.objectsUsedInFrameCounts[c.primitiveTypes.rect]=0;c.objectsUsedInFrameCounts[c.primitiveTypes.box]=0;c.objectsUsedInFrameCounts[c.primitiveTypes.peg]=0;var a;for(a=0;a<c.maximumBallDetail-c.minimumBallDetail+1;a=a+1)c.objectsUsedInFrameCounts[c.primitiveTypes.ball+
a]=0};window.line=c.line=function(g,f,h){if(b.LightSystem.lightsAreOn){f=e;h=c.currentStrokeSize;if(c.currentStrokeSize<2)c.currentStrokeSize=2;g==void 0&&(g=1);rect(0,g,0);e=f;c.currentStrokeSize=h}else o(g,f,h,{canFill:false,primitiveType:d.line,sidedness:a.FrontSide,THREEObjectConstructor:a.Line,detailLevel:0})};window.rect=c.rect=function(b,c,g){o(b,c,g,{canFill:true,primitiveType:d.rect,sidedness:a.DoubleSide,THREEObjectConstructor:a.Mesh,detailLevel:0})};window.box=c.box=function(b,c,g){o(b,
c,g,{canFill:true,primitiveType:d.box,sidedness:a.FrontSide,THREEObjectConstructor:a.Mesh,detailLevel:0})};window.peg=c.peg=function(b,c,g){o(b,c,g,{canFill:true,primitiveType:d.peg,sidedness:a.FrontSide,THREEObjectConstructor:a.Mesh,detailLevel:0})};window.ballDetail=c.ballDetail=function(a){if(a!==void 0){a<2&&(a=2);a>30&&(a=30);c.ballDetLevel=Math.round(a)}};window.ball=c.ball=function(b,g,e){o(b,g,e,{canFill:true,primitiveType:d.ball,sidedness:a.FrontSide,THREEObjectConstructor:a.Mesh,detailLevel:c.ballDetLevel-
2})};window.fill=c.fill=function(a,g,d,f){e=true;if(a!==angleColor){c.defaultNormalFill=false;m=color(a,g,d);p=alphaZeroToOne(color(a,g,d,f))}else{c.defaultNormalFill=true;m=angleColor;p=d===void 0&&g!==void 0?g/b.ColourFunctions.colorModeA:1}};window.noFill=c.noFill=function(){e=false;c.defaultNormalFill=false};window.stroke=c.stroke=function(a,d,e,i){f=true;if(a!==angleColor){c.defaultNormalStroke=false;g=color(a,d,e);h=alphaZeroToOne(color(a,d,e,i))}else{c.defaultNormalStroke=true;g=angleColor;
h=e===void 0&&d!==void 0?d/b.ColourFunctions.colorModeA:1}};window.noStroke=c.noStroke=function(){f=false};window.strokeSize=c.strokeSize=function(a){a===void 0?a=1:a<0&&(a=0);c.currentStrokeSize=a};return c},abs=Math.abs,ceil=Math.ceil,constrain=function(a,b,c){return a>c?c:a<b?b:a},dist=function(){var a,b,c;if(arguments.length===4){a=arguments[0]-arguments[2];b=arguments[1]-arguments[3];return Math.sqrt(a*a+b*b)}if(arguments.length===6){a=arguments[0]-arguments[3];b=arguments[1]-arguments[4];c=
arguments[2]-arguments[5];return Math.sqrt(a*a+b*b+c*c)}},exp=Math.exp,floor=Math.floor,lerp=function(a,b,c){return(b-a)*c+a},log=Math.log,mag=function(a,b,c){return c?Math.sqrt(a*a+b*b+c*c):Math.sqrt(a*a+b*b)},map=function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},max=function(){if(arguments.length===2)return arguments[0]<arguments[1]?arguments[1]:arguments[0];var a=arguments.length===1?arguments[0]:arguments;if(!("length"in a&&a.length>0))throw"Non-empty array is expected";for(var b=a[0],c=a.length,
d=1;d<c;++d)b<a[d]&&(b=a[d]);return b},min=function(){if(arguments.length===2)return arguments[0]<arguments[1]?arguments[0]:arguments[1];var a=arguments.length===1?arguments[0]:arguments;if(!("length"in a&&a.length>0))throw"Non-empty array is expected";for(var b=a[0],c=a.length,d=1;d<c;++d)b>a[d]&&(b=a[d]);return b},norm=function(a,b,c){return(a-b)/(c-b)},pow=Math.pow,round=Math.round,sq=function(a){return a*a},sqrt=Math.sqrt,acos=Math.acos,asin=Math.asin,atan=Math.atan,atan2=Math.atan2,cos=Math.cos,
degrees=function(a){return a*180/Math.PI},radians=function(a){return a/180*Math.PI},sin=Math.sin,tan=Math.tan,currentRandom=Math.random,random=function(){if(arguments.length===0)return currentRandom();if(arguments.length===1)return currentRandom()*arguments[0];var a=arguments[0],b=arguments[1];return currentRandom()*(b-a)+a},Marsaglia=function(a,b){var c=a||362436069,d=b||521288629,e=function(){c=36969*(c&65535)+(c>>>16)&4294967295;d=18E3*(d&65535)+(d>>>16)&4294967295;return((c&65535)<<16|d&65535)&
4294967295};this.nextDouble=function(){var a=e()/4294967296;return a<0?1+a:a};this.nextInt=e};Marsaglia.createRandomized=function(){var a=new Date;return new Marsaglia(a/6E4&4294967295,a&4294967295)};
var randomSeed=function(a){currentRandom=(new Marsaglia(a)).nextDouble},Random=function(a){var b=false,c,d;this.nextGaussian=function(){if(b){b=false;return c}var a,f,h;do{a=2*d()-1;f=2*d()-1;h=a*a+f*f}while(h>=1||h===0);h=Math.sqrt(-2*Math.log(h)/h);c=f*h;b=true;return a*h};d=a===void 0?Math.random:(new Marsaglia(a)).nextDouble},PerlinNoise=function(a){function b(a,b,c,g){var a=a&15,d=a<8?b:c,b=a<4?c:a===12||a===14?b:g;return((a&1)===0?d:-d)+((a&2)===0?b:-b)}function c(a,b,c){b=(a&1)===0?b:c;return(a&
2)===0?-b:b}function d(a,b,c){return b+a*(c-b)}var a=a!==void 0?new Marsaglia(a):Marsaglia.createRandomized(),e,f,h=new Uint8Array(512);for(e=0;e<256;++e)h[e]=e;for(e=0;e<256;++e){var g=h[f=a.nextInt()&255];h[f]=h[e];h[e]=g}for(e=0;e<256;++e)h[e+256]=h[e];this.noise3d=function(a,c,g){var e=Math.floor(a)&255,f=Math.floor(c)&255,m=Math.floor(g)&255,a=a-Math.floor(a),c=c-Math.floor(c),g=g-Math.floor(g),q=(3-2*a)*a*a,n=(3-2*c)*c*c,s=h[e]+f,r=h[s]+m,s=h[s+1]+m,f=h[e+1]+f,e=h[f]+m,m=h[f+1]+m;return d((3-
2*g)*g*g,d(n,d(q,b(h[r],a,c,g),b(h[e],a-1,c,g)),d(q,b(h[s],a,c-1,g),b(h[m],a-1,c-1,g))),d(n,d(q,b(h[r+1],a,c,g-1),b(h[e+1],a-1,c,g-1)),d(q,b(h[s+1],a,c-1,g-1),b(h[m+1],a-1,c-1,g-1))))};this.noise2d=function(a,b){var g=Math.floor(a)&255,e=Math.floor(b)&255,a=a-Math.floor(a),b=b-Math.floor(b),f=(3-2*a)*a*a,m=h[g]+e,g=h[g+1]+e;return d((3-2*b)*b*b,d(f,c(h[m],a,b),c(h[g],a-1,b)),d(f,c(h[m+1],a,b-1),c(h[g+1],a-1,b-1)))};this.noise1d=function(a){var b=Math.floor(a)&255,a=a-Math.floor(a);return d((3-2*a)*
a*a,(h[b]&1)===0?-a:a,(h[b+1]&1)===0?-(a-1):a-1)}},noiseProfile={generator:void 0,octaves:4,fallout:0.5,seed:void 0},noise=function(a,b,c){if(noiseProfile.generator===void 0)noiseProfile.generator=new PerlinNoise(noiseProfile.seed);for(var d=noiseProfile.generator,e=1,f=1,h=0,g=0;g<noiseProfile.octaves;++g){e=e*noiseProfile.fallout;switch(arguments.length){case 1:h=h+e*(1+d.noise1d(f*a))/2;break;case 2:h=h+e*(1+d.noise2d(f*a,f*b))/2;break;case 3:h=h+e*(1+d.noise3d(f*a,f*b,f*c))/2}f=f*2}return h},
noiseDetail=function(a,b){noiseProfile.octaves=a;if(b!==void 0)noiseProfile.fallout=b},noiseSeed=function(a){noiseProfile.seed=a;noiseProfile.generator=void 0},createDrawFunctionRunner=function(a,b){var c={},d=[];c.drawFunction="";c.consecutiveFramesWithoutRunTimeError=0;c.lastStableDrawFunction=null;c.currentCodeString="";window.addDoOnce=c.addDoOnce=function(a){d.push(a)};c.setDrawFunction=function(a){c.drawFunction=a};c.resetTrackingOfDoOnceOccurrences=function(){d=[]};c.putTicksNextToDoOnceBlocksThatHaveBeenRun=
function(){d.length!==0&&c.setDrawFunction(b.CodeTransformer.addCheckMarksAndUpdateCodeAndNotifyChange(b.CodeTransformer,d))};c.runDrawFunction=function(){c.drawFunction();c.consecutiveFramesWithoutRunTimeError=c.consecutiveFramesWithoutRunTimeError+1;if(c.consecutiveFramesWithoutRunTimeError===5){c.lastStableDrawFunction=c.drawFunction;a.trigger("livecodelab-running-stably")}};c.reinstateLastWorkingDrawFunction=function(){c.consecutiveFramesWithoutRunTimeError=0;c.drawFunction=c.lastStableDrawFunction};
return c},createCodeTransformer=function(a,b,c){var d={},e,f={},h=createCodeChecker();d.compiler=b;f.removeTickedDoOnce=function(a){a=a.replace(/^(\s)*\u2713[ ]*doOnce[ ]*\-\>[ ]*$/gm,"$1if false");return a=a.replace(/\u2713/g,"//")};f.postfixNotation=function(a){a=a.replace(/(\d+)[ ]+bpm(\s)/g,"bpm $1$2");a=a.replace(/([a-zA-Z]+)[ ]+fill(\s)/g,"fill $1$2");a=a.replace(/([a-zA-Z]+)[ ]+stroke(\s)/g,"stroke $1$2");return a=a.replace(/([a-zA-Z]+)[ ]+background(\s)/g,"background $1$2")};f.fixTimesFunctions=
function(a){return a.replace(/(\d+)\s+times[ ]*\->/g,";( $1 + 0).times ->")};f.addDoOnceTracing=function(a){var b;if(a.indexOf("doOnce")>-1){a=a.split("\n");for(b=0;b<a.length;b=b+1){a[b]=a[b].replace(/^(\s*)doOnce[ ]*\->[ ]*(.+)$/gm,"$1;addDoOnce("+b+"); (1+0).times -> $2");if(a[b].match(/^(\s*)doOnce[ ]*\->[ ]*$/gm)){a[b]=a[b].replace(/^(\s*)doOnce[ ]*\->[ ]*$/gm,"$1(1+0).times ->");a[b+1]=a[b+1].replace(/^(\s*)(.+)$/gm,"$1;addDoOnce("+b+"); $2")}}a=a.join("\n")}return a};d.updateCode=function(b){var i;
d.currentCodeString=b;if(d.currentCodeString===""){c.GraphicsCommands.resetTheSpinThingy=true;a.trigger("clear-error");c.DrawFunctionRunner.consecutiveFramesWithoutRunTimeError=0;b=new Function("");c.DrawFunctionRunner.setDrawFunction(null);c.DrawFunctionRunner.lastStableDrawFunction=null;return b}b=f.removeTickedDoOnce(b);i=h.parse(b);if(i.err===true)a.trigger("compile-time-error-thrown",i.message);else{b=f.postfixNotation(b);b=f.fixTimesFunctions(b);b=f.addDoOnceTracing(b);b=b.replace(/^(\s*)([a-z]+[a-zA-Z0-9]*)[ ]*$/gm,
"$1;$2()");b=b.replace(/;\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");b=b.replace(/\->\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");if(b.match(/[\s\+\;]+draw\s*\(/))a.trigger("compile-time-error-thrown","You can't call draw()");else{b=b.replace(/;(if)\(\)/g,";$1");b=b.replace(/;(else)\(\)/g,";$1");b=b.replace(/;(for)\(\)/g,";$1");b=b.replace(/\/\//g,"#");b=b.replace(/([^a-zA-Z0-9])(scale)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(rotate)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(move)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(rect)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(line)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(bpm)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(play)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(pushMatrix)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(popMatrix)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(resetMatrix)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(fill)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noFill)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(stroke)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noStroke)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(strokeSize)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(animationStyle)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(simpleGradient)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(background)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(color)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(lights)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noLights)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ambientLight)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(pointLight)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ball)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ballDetail)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(peg)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(abs)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ceil)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(constrain)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(dist)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(exp)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(floor)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(lerp)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(log)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(mag)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(map)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(max)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(min)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(norm)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(pow)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(round)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(sq)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(sqrt)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(acos)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(asin)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(atan)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(atan2)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(cos)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(degrees)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(radians)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(sin)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(tan)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(random)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(randomSeed)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noise)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noiseDetail)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noiseSeed)(\s)+/g,"$1;$2$3");b=b.replace(/->(\s+);/g,"->$1");b=b.replace(/(\sif\s*.*\s*);/g,"$1");b=b.replace(/(\s);(else\s*if\s*.*\s*);/g,"$1$2");b=b.replace(/(\s);(else.*\s*);/g,"$1$2");try{e=d.compiler.compile(b,{bare:"on"})}catch(j){a.trigger("compile-time-error-thrown",
j);return}a.trigger("clear-error");c.DrawFunctionRunner.consecutiveFramesWithoutRunTimeError=0;e=e.replace(/var frame/,";");b=new Function(e);c.DrawFunctionRunner.setDrawFunction(b);return b}}};d.addCheckMarksAndUpdateCodeAndNotifyChange=function(b,c){var d,e;d=b.currentCodeString;d=d.split("\n");for(e=0;e<c.length;e=e+1)d[c[e]]=d[c[e]].replace(/^(\s*)doOnce([ ]*\->[ ]*.*)$/gm,"$1\u2713doOnce$2");d=d.join("\n");a.trigger("code-updated-by-livecodelab",d);return b.updateCode(d)};return d},createProgramLoader=
function(a,b,c){var d={},e=false;d.program={};d.program.roseDemo="// 'A rose' by Guy John (@rumblesan)\n// Mozilla Festival 2012\n// adapted from 'A rose' by Lib4tech\n\ndoOnce -> frame = 0\nbackground red\nscale 1.5\nanimationStyle paintOver\nrotate frame/100\nfill 255-((frame/2)%255),0,0\nstroke 255-((frame/2)%255),0,0\nscale 1-((frame/2)%255) / 255\nbox".replace(/\u25B6/g,"\t");d.program.cheeseAndOlivesDemo="// 'Cheese and olives' by\n// Davina Tirvengadum\n// Mozilla festival 2012\n\nbackground white\nscale .3\nmove 0,-1\nfill yellow\nstroke black\nrotate\nstrokeSize 3\nline 4\nbox\n\nrotate 2,3\nmove 0,3\nscale .3\nfill black\nstroke black\nball\n\nrotate 3\nmove 5\nscale 1\nfill green\nstroke green\nball\n\nrotate 1\nmove -3\nscale 1\nfill yellow\nstroke yellow\nball".replace(/\u25B6/g,
"\t");d.program.simpleCubeDemo="// there you go!\n// a simple cube!\n\nbackground yellow\nrotate 0,time/2000,time/2000\nbox".replace(/\u25B6/g,"\t");d.program.webgltwocubesDemo="background 155,255,255\n2 times ->\n\u25b6rotate 0, 1, time/2000\n\u25b6box".replace(/\u25B6/g,"\t");d.program.cubesAndSpikes="simpleGradient fuchsia,color(100,200,200),yellow\nscale 2.1\n5 times ->\n\u25b6rotate 0,1,time/5000\n\u25b6box 0.1,0.1,0.1\n\u25b6move 0,0.1,0.1\n\u25b63 times ->\n\u25b6\u25b6rotate 0,1,1\n\u25b6\u25b6box 0.01,0.01,1".replace(/\u25B6/g,
"\t");d.program.webglturbineDemo="background 155,55,255\n70 times ->\n\u25b6rotate time/100000,1,time/100000\n\u25b6box".replace(/\u25B6/g,"\t");d.program.webglzfightartDemo="// Explore the artifacts\n// of your GPU!\n// Go Z-fighting, go!\nscale 5\nrotate\nfill red\nbox\nrotate 0.000001\nfill yellow\nbox".replace(/\u25B6/g,"\t");d.program.littleSpiralOfCubes="background orange\nscale 0.1\n10 times ->\n\u25b6rotate 0,1,time/1000\n\u25b6move 1,1,1\n\u25b6box".replace(/\u25B6/g,"\t");d.program.tentacleDemo=
"background 155,255,155\nscale 0.15\n3 times ->\n\u25b6rotate 0,1,1\n\u25b610 times ->\n\u25b6\u25b6rotate 0,1,time/1000\n\u25b6\u25b6scale 0.9\n\u25b6\u25b6move 1,1,1\n\u25b6\u25b6box".replace(/\u25B6/g,"\t");d.program.lampDemo="animationStyle motionBlur\nsimpleGradient red,yellow,color(255,0,255)\n//animationStyle paintOver\nscale 2\nrotate time/4000, time/4000,  time/4000\n90 times ->\n\u25b6rotate time/200000, time/200000,  time/200000\n\u25b6line\n\u25b6move 0.5,0,0\n\u25b6line\n\u25b6move -0.5,0,0\n\u25b6line\n\u25b6line".replace(/\u25B6/g,
"\t");d.program.trillionfeathersDemo="animationStyle paintOver\nmove 2,0,0\nscale 2\nrotate\n20 times ->\n\u25b6rotate\n\u25b6move 0.25,0,0\n\u25b6line\n\u25b6move -0.5,0,0\n\u25b6line".replace(/\u25B6/g,"\t");d.program.monsterblobDemo="ballDetail 6\nanimationStyle motionBlur\nrotate time/5000\nsimpleGradient fuchsia,aqua,yellow\n5 times ->\n\u25b6rotate 0,1,time/5000\n\u25b6move 0.2,0,0\n\u25b63 times ->\n\u25b6\u25b6rotate 1\n\u25b6\u25b6ball -1".replace(/\u25B6/g,"\t");d.program.industrialMusicDemo=
"bpm 88\nplay 'alienBeep'  ,'zzxz zzzz zzxz zzzz'\nplay 'beepC'  ,'zxzz zzzz xzzx xxxz'\nplay 'beepA'  ,'zzxz zzzz zzxz zzzz'\nplay 'lowFlash'  ,'zzxz zzzz zzzz zzzz'\nplay 'beepB'  ,'xzzx zzzz zxzz zxzz'\nplay 'voltage'  ,'xzxz zxzz xzxx xzxx'\nplay 'tranceKick'  ,'zxzx zzzx xzzz zzxx'".replace(/\u25B6/g,"\t");d.program.trySoundsDemo="bpm 88\n// leave this one as base\nplay 'tranceKick'  ,'zxzx zzzx xzzz zzxx'\n\n// uncomment the sounds you want to try\n//play 'toc'  ,'zzxz zzzz zzxz zzzz'\n//play 'highHatClosed'  ,'zzxz zzzz zzxz zzzz'\n//play 'highHatOpen'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc2'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc3'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc4'  ,'zzxz zzzz zzxz zzzz'\n//play 'snare'  ,'zzxz zzzz zzxz zzzz'\n//play 'snare2'  ,'zzxz zzzz zzxz zzzz'\n//play 'china'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash2'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash3'  ,'zzxz zzzz zzxz zzzz'\n//play 'ride'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass1'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass2'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass3'  ,'zzxz zzzz zzxz zzzz'\n//play 'thump'  ,'zzxz zzzz zzxz zzzz'\n//play 'lowFlash'  ,'zzxz zzzz zzxz zzzz'\n//play 'lowFlash2'  ,'zzxz zzzz zzxz zzzz'\n//play 'tranceKick2'  ,'zzxz zzzz zzxz zzzz'\n//play 'tranceKick'  ,'zzxz zzzz zzxz zzzz'\n//play 'wosh'  ,'zzxz zzzz zzxz zzzz'\n//play 'voltage'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepA'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepB'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepC'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepD'  ,'zzxz zzzz zzxz zzzz'\n//play 'beep'  ,'zzxz zzzz zzxz zzzz'\n//play 'hello'  ,'zzxz zzzz zzxz zzzz'\n//play 'alienBeep'  ,'zzxz zzzz zzxz zzzz'".replace(/\u25B6/g,
"\t");d.program.springysquaresDemo="animationStyle motionBlur\nsimpleGradient fuchsia,color(100,200,200),yellow\nscale 0.3\n3 times ->\n\u25b6move 0,0,0.5\n\u25b65 times ->\n\u25b6\u25b6rotate time/2000\n\u25b6\u25b6move 0.7,0,0\n\u25b6\u25b6rect".replace(/\u25B6/g,"\t");d.program.diceDemo="animationStyle motionBlur\nsimpleGradient color(255),moccasin,peachpuff\nstroke 255,100,100,255\nfill red,155\nmove -0.5,0,0\nscale 0.3\n3 times ->\n\u25b6move 0,0,0.5\n\u25b61 times ->\n\u25b6\u25b6rotate time/1000\n\u25b6\u25b6move 2,0,0\n\u25b6\u25b6box".replace(/\u25B6/g,
"\t");d.program.webglalmostvoronoiDemo="scale 10\n2 times ->\n\u25b6rotate 0,1,time/10000\n\u25b6ball -1".replace(/\u25B6/g,"\t");d.program.webglshardsDemo="scale 10\nfill 0\nstrokeSize 7\n5 times ->\n\u25b6rotate 0,1,time/20000\n\u25b6ball \n\u25b6rotate 0,1,1\n\u25b6ball -1.01".replace(/\u25B6/g,"\t");d.program.webglredthreadsDemo="scale 10.5\nbackground black\nstroke red\nnoFill\nstrokeSize 7\n5 times ->\n\u25b6rotate time/20000\n\u25b6ball\n\u25b6rotate 0,1,1\n\u25b6ball".replace(/\u25B6/g,"\t");
d.program.webglnuclearOctopusDemo="simpleGradient black,color(0,0,(time/5)%255),black\nscale 0.2\nmove 5,0,0\nanimationStyle motionBlur\n//animationStyle paintOver\nstroke 255,0,0,120\nfill time%255,0,0\npushMatrix\ncount = 0\n3 times ->\n\u25b6count++\n\u25b6pushMatrix\n\u25b6rotate count+3+time/1000,2+count + time/1000,4+count\n\u25b6120 times ->\n\u25b6\u25b6scale 0.9\n\u25b6\u25b6move 1,1,0\n\u25b6\u25b6rotate time/100\n\u25b6\u25b6box\n\u25b6popMatrix".replace(/\u25B6/g,"\t");d.program.introTutorial=
"// Lines beginning with two\n// slashes (like these) are just comments.\n\n// Everything else is run\n// about 30 to 60 times per second\n// in order to create an animation.\n\n// Click the link below to start the tutorial.\n\n// next-tutorial:hello_world".replace(/\u25B6/g,"\t");d.program.helloworldTutorial="// type these three letters\n// in one of these empty lines below:\n// 'b' and 'o' and 'x'\n\n\n\n// (you should then see a box facing you)\n// click below for the next tutorial\n// next-tutorial:some_notes".replace(/\u25B6/g,
"\t");d.program.somenotesTutorial="// If this makes sense to you:\n// the syntax is similar to Coffeescript\n// and the commands are almost\n// like Processing.\n\n// If this doesn't make sense to you\n// don't worry.\n\n// next-tutorial:rotate".replace(/\u25B6/g,"\t");d.program.rotateTutorial="// now that we have a box\n// let's rotate it:\n// type 'rotate 1' in the\n// line before the 'box'\n\n\nbox\n\n// click for the next tutorial:\n// next-tutorial:frame".replace(/\u25B6/g,"\t");d.program.frameTutorial=
"// make the box spin\n// by replacing '1' with 'frame'\n\nrotate 1\nbox\n\n// 'frame' contains a number\n// always incrementing as\n// the screen is re-drawn.\n// (use 'frame/100' to slow it down)\n// next-tutorial:time".replace(/\u25B6/g,"\t");d.program.timeTutorial="// 'frame/100' has one problem:\n// faster computers will make\n// the cube spin too fast.\n// Replace it with 'time/2000'.\n\nrotate frame/100\nbox\n\n// 'time' counts the\n// number of milliseconds since\n// the program started, so it's\n// independent of how fast\n// the computer is at drawing.\n// next-tutorial:move".replace(/\u25B6/g,
"\t");d.program.moveTutorial="// you can move any object\n// by using 'move'\n\nbox\nmove 1,1,0\nbox\n\n// try to use a rotate before\n// the first box to see how the\n// scene changes.\n// next-tutorial:scale".replace(/\u25B6/g,"\t");d.program.scaleTutorial="// you can make an object bigger\n// or smaller by using 'scale'\n\nrotate 3\nbox\nmove 1\nscale 2\nbox\n\n// try to use scale or move before\n// the first box to see how the\n// scene changes.\n// next-tutorial:times".replace(/\u25B6/g,"\t");
d.program.timesTutorial="// 'times' (not to be confused with\n// 'time'!) can be used to\n// repeat operations like so:\n\nrotate 1\n3 times ->\n\u25b6move 0.2,0.2,0.2\n\u25b6box\n\n// note how the tabs indicate\n// exactly the block of code\n// to be repeated.\n// next-tutorial:fill".replace(/\u25B6/g,"\t");d.program.fillTutorial="// 'fill' changes the\n// color of all the faces:\n\nrotate 1\nfill 255,255,0\nbox\n\n// the three numbers indicate \n// red green and blue values.\n// You can also use color names such as 'indigo'\n// Try replacing the numbers with\n// 'angleColor'\n// next-tutorial:stroke".replace(/\u25B6/g,
"\t");d.program.strokeTutorial="// 'stroke' changes all the\n// edges:\n\nrotate 1\nstrokeSize 5\nstroke 255,255,255\nbox\n\n// the three numbers are RGB\n// but you can also use the color names\n// or the special color 'angleColor'\n// Also you can use 'strokeSize'\n// to specify the thickness.\n// next-tutorial:color_names".replace(/\u25B6/g,"\t");d.program.colornamesTutorial="// you can call colors by name\n// try to un-comment one line:\n//fill greenyellow\n//fill indigo\n//fill lemonchiffon // whaaaat?\n\nrotate 1\nbox\n\n// more color names here:\n// http://html-color-codes.info/color-names/\n// (just use them in lower case)\n// next-tutorial:lights".replace(/\u25B6/g,
"\t");d.program.lightsTutorial="// 'ambientLight' creates an\n// ambient light so things have\n// some sort of shading:\n\nambientLight 0,255,255\nrotate time/1000\nbox\n\n// you can turn that light on and \n// off while you build the scene\n// by using 'lights' and 'noLights'\n// next-tutorial:background".replace(/\u25B6/g,"\t");d.program.backgroundTutorial="// 'background' creates a\n// solid background:\n\nbackground 0,0,255\nrotate time/1000\nbox\n\n// next-tutorial:gradient".replace(/\u25B6/g,
"\t");d.program.gradientTutorial="// even nicer, you can paint a\n// background gradient:\n\nsimpleGradient color(190,10,10),color(30,90,100),color(0)\nrotate time/1000\nbox\n\n// next-tutorial:line".replace(/\u25B6/g,"\t");d.program.lineTutorial="// draw lines like this:\n\n20 times ->\n\u25b6rotate time/9000\n\u25b6line\n\n// next-tutorial:ball".replace(/\u25B6/g,"\t");d.program.ballTutorial="// draw balls like this:\n\nballDetail 10\n3 times ->\n\u25b6move 0.2,0.2,0.2\n\u25b6ball\n\n// ('ballDetail' is optional)\n// next-tutorial:pushpopMatrix".replace(/\u25B6/g,
"\t");d.program.pushpopMatrixTutorial="// pushMatrix creates a bookmark of\n// the position, which you can\n// return to later by using popMatrix.\n// You can reset using 'resetMatrix'.\n\nrotate time/1000\npushMatrix // bookmark the position after the rotation\nline\nmove 0.5,0,0\nline\npopMatrix // go back to the bookmarked position\nmove -0.5,0,0\nline\nresetMatrix // resets the position\nline // not affected by initial rotation\n// next-tutorial:animation_style".replace(/\u25B6/g,"\t");d.program.animationstyleTutorial=
"// try uncommenting either line\n// with the animationStyle\n\nbackground 255\n//animationStyle motionBlur\n//animationStyle paintOver\nrotate frame/10\nbox\n\n// next-tutorial:do_once".replace(/\u25B6/g,"\t");d.program.doonceTutorial="// delete either check mark below\n\nrotate time/1000\n\u2713doOnce ->\n\u25b6background 255\n\u25b6fill 255,0,0\n\u2713doOnce -> ball\nbox\n\n// ...the line or block of code\n// are ran one time only, after that the\n// check marks immediately re-appear\n// P.S. keep hitting the delete button\n// on that first check mark for seizures.\n// next-tutorial:conditionals".replace(/\u25B6/g,
"\t");d.program.conditionalsTutorial="// you can draw different things\n// (or in general do different things)\n// based on any\n// test condition you want:\n\nrotate\nif frame%3 == 0\n\u25b6box\nelse if frame%3 == 1\n\u25b6ball\nelse\n\u25b6peg\n\n// next-tutorial:autocode".replace(/\u25B6/g,"\t");d.program.autocodeTutorial="// the Autocode button invents random\n// variations for you.\n\n// You can interrupt the Autocoder at\n// any time by pressing the button again,\n// or you can press CTRL-Z\n// (or CMD-Z on Macs) to undo (or re-do) some of\n// the steps even WHILE the autocoder is running,\n// if you see that things got\n// boring down a particular path of changes.".replace(/\u25B6/g,
"\t");d.loadDemoOrTutorial=function(f){if((!Detector.webgl||c.ThreeJsSystem.forceCanvasRenderer)&&!e&&f.indexOf("webgl")===0){e=true;$("#exampleNeedsWebgl").modal();$("#simplemodal-container").height(200)}a.trigger("set-url-hash","bookmark="+f);a.trigger("big-cursor-hide");a.trigger("editor-undim");c.GraphicsCommands.doTheSpinThingy=false;var h="";if((!Detector.webgl||c.ThreeJsSystem.forceCanvasRenderer)&&f.indexOf("webgl")===0)h="// This drawing makes much more sense\n// in a WebGL-enabled browser.\n\n".replace(/\u25B6/g,
"\t");d.program[f]&&b.setValue(h+d.program[f]);b.setCursor(0,0);c.BlendControls.animationStyle(c.BlendControls.animationStyles.normal);c.BlendControls.animationStyleUpdateIfChanged();c.Renderer.render(c.GraphicsCommands)};a.bind("load-program",d.loadDemoOrTutorial,d);a.bind("url-hash",function(a){(a=a.match(/bookmark=(.*)/))&&d.loadDemoOrTutorial(a[1])},d);return d},createAutocoder=function(a,b,c){var d,e,f={active:false},h=[],g=new McLexer.State,i=function(a){this.string=a;this.toString=function(){return"COMMENT("+
a+")"}},j=function(a){this.string=a;this.toString=function(){return"SPACE("+a+")"}},k=function(a){this.string=a;this.toString=function(){return"<br/>"}},o=function(a){this.string=a;this.toString=function(){return"TRANSLATION("+a+")"}},p=function(a){this.string=a;this.toString=function(){return"VARIABLE("+a+")"}},m=function(a){this.string=a;this.toString=function(){return"NUM("+a+")"};this.mutate=function(){var a=new Number(this.string);0==a&&(a=0.1);Math.random();Math.random();var b=a*Math.random(),
a=(a+b).toFixed(2);this.string=a.toString()}},q=function(a){this.string=a;this.toString=function(){return"OP("+a+")"}},n=function(a){this.string=a;this.toString=function(){return"ARGDLIM("+a+")"}},s=function(a){this.string=a;this.toString=function(){return"TAB("+a+")"}},r=function(a){this.string=a;this.toString=function(){return"DOONCE("+a+")"}},v=function(a){this.string=a;this.toString=function(){return"COLOUROP("+a+")"}},x=function(a){this.string=a;this.toString=function(){return"COLOUR("+a+")"};
this.mutate=function(){for(var a=Math.floor(Math.random()*c.length);this.string==c[a];)a=Math.floor(Math.random()*c.length);this.string=c[a]}},w=function(a){this.string=a;this.toString=function(){return"MESH("+a+")"};this.mutate=function(){switch(this.string){case "box":this.string="ball";break;case "ball":this.string="box";break;case "line":this.string="rect";break;case "rect":this.string="line"}}},A=function(a){this.string=a;this.toString=function(){return"STATEFUN("+a+")"}},t=function(a){this.string=
a;this.toString=function(){return"ITERATION("+a+")"};this.mutate=function(){var a=/\d/.exec(this.string);Math.random()>0.5?a++:a--;this.string=a.toString()+" times ->"}},u=function(a){this.string=a;this.toString=function(){return"UNKNOWN("+a+")"}};g(/\/\/.*\n/)(function(a,b,c){h.push(new i(a[0]));return c.continuation(b)});g(/\t/)(function(a,b,c){h.push(new s(a[0]));return c.continuation(b)});g(/-?[0-9]+\.?[0-9]*/)(function(a,b,c){h.push(new m(a[0]));return c.continuation(b)});g(/-?\.[0-9]*/)(function(a,
b,c){h.push(new m(a[0]));return c.continuation(b)});g(/[*|\/|+|\-|=]/)(function(a,b,c){h.push(new q(a[0]));return c.continuation(b)});g(/,/)(function(a,b,c){h.push(new n(a[0]));return c.continuation(b)});g(/[\n|\r]{1,2}/)(function(a,b,c){h.push(new k(a[0]));return c.continuation(b)});g(/rotate/)(function(a,b,c){h.push(new o(a[0]));return c.continuation(b)});g(/move/)(function(a,b,c){h.push(new o(a[0]));return c.continuation(b)});g(/scale/)(function(a,b,c){h.push(new o(a[0]));return c.continuation(b)});
for(e=0;e<c.length;e++)g(RegExp(c[e]))(function(a,b,c){h.push(new x(a[0]));return c.continuation(b)});g(/background/)(function(a,b,c){h.push(new v(a[0]));return c.continuation(b)});g(/fill/)(function(a,b,c){h.push(new v(a[0]));return c.continuation(b)});g(/stroke/)(function(a,b,c){h.push(new v(a[0]));return c.continuation(b)});g(/simpleGradient/)(function(a,b,c){h.push(new v(a[0]));return c.continuation(b)});g(/box/)(function(a,b,c){h.push(new w(a[0]));return c.continuation(b)});g(/ball/)(function(a,
b,c){h.push(new w(a[0]));return c.continuation(b)});g(/peg/)(function(a,b,c){h.push(new w(a[0]));return c.continuation(b)});g(/rect/)(function(a,b,c){h.push(new w(a[0]));return c.continuation(b)});g(/line/)(function(a,b,c){h.push(new w(a[0]));return c.continuation(b)});g(/ambientLight/)(function(a,b,c){h.push(new A(a[0]));return c.continuation(b)});g(/noStroke/)(function(a,b,c){h.push(new A(a[0]));return c.continuation(b)});g(/ballDetail/)(function(a,b,c){h.push(new A(a[0]));return c.continuation(b)});
g(/animationStyle\s\w+/)(function(a,b,c){h.push(new A(a[0]));return c.continuation(b)});g(/\d+\s+times\s+->/)(function(a,b,c){h.push(new t(a[0]));return c.continuation(b)});g(/time/)(function(a,b,c){h.push(new p(a[0]));return c.continuation(b)});g(/delay/)(function(a,b,c){h.push(new p(a[0]));return c.continuation(b)});g(/\?doOnce\s+->\s*/)(function(a,b,c){h.push(new r(a[0]));return c.continuation(b)});g(/ +/)(function(a,b,c){h.push(new j(a[0]));return c.continuation(b)});g(/'/)(function(a,b,c){h.push(new u(a[0]));
return c.continuation(b)});g(/[\u2713]?doOnce\s+\->?/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/==/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/else/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/next-tutorial:\w+/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/\w+/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/if/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/pushMatrix/)(function(a,
b,c){h.push(new u(a[0]));return c.continuation(b)});g(/popMatrix/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/play/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/bpm/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/color\s*\(.+\)/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/noFill/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/frame/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});
g(/strokeSize/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/\(/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/\)/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});g(/%/)(function(a,b,c){h.push(new u(a[0]));return c.continuation(b)});var y=function(){a.trigger("autocoderbutton-flash");var c=b.getValue();h=[];try{g.lex(c)}catch(d){console.log(d)}var c=h,e=[],f;for(f=0;f<c.length;f++)typeof c[f].mutate=="function"&&e.push(f);if(0!=e.length){f=
Math.floor(Math.random()*e.length);c[e[f]].mutate()}c="";for(e=0;e<h.length;e++)c=c+h[e].string;b.setValue(c)},l=function(c){f.active=c===void 0?!f.active:c;if(f.active){d=setInterval(y,1E3);(b.getValue()===""||window.location.hash.indexOf("bookmark")!==-1&&window.location.hash.indexOf("autocodeTutorial")!==-1)&&a.trigger("load-program","cubesAndSpikes")}else clearInterval(d);a.trigger("autocoder-button-pressed",f.active)};a.bind("reset",function(){l(false)});a.bind("toggle-autocoder",function(){l()});
return f},createEditorDimmer=function(a,b){var c=true,d,e={},f=false;e.undimEditor=function(){b.isShowing||$("#formCode").css("opacity")<0.99&&$("#formCode").animate({opacity:1},"fast")};e.dimEditor=function(){$("#formCode").css("opacity")>0&&$("#formCode").animate({opacity:0},"slow")};e.dimIfNoCursorActivity=function(){c?c=false:e.dimEditor()};e.toggleDimCode=function(b){if(f=b===void 0?!f:b)d=setInterval(e.dimIfNoCursorActivity,5E3);else{clearInterval(d);e.undimEditor()}a.trigger("auto-hide-code-button-pressed",
f)};a.bind("editor-dim",e.dimEditor,e);a.bind("editor-undim",e.undimEditor,e);a.bind("editor-toggle-dim",e.toggleDimCode,e);return e},createTimeKeeper=function(){var a={},b,c;window.time=0;a.updateTime=function(){var a=new Date;b=a.getTime()-c;window.time=a.getTime()-c};a.resetTime=function(){var a=new Date;b=0;window.time=0;c=a.getTime()};a.getTime=function(){return b};return a},createBlendControls=function(a){var b={},c=0,d=0;b.blendAmount=0;b.animationStyles={};window.normal=b.animationStyles.normal=
0;window.paintOver=b.animationStyles.paintOver=1;window.motionBlur=b.animationStyles.motionBlur=2;window.animationStyle=b.animationStyle=function(a){a===false||a===void 0||(d=a)};b.animationStyleUpdateIfChanged=function(){if(d!==c){c=d;if(a.ThreeJsSystem.isWebGLUsed&&d===b.animationStyles.motionBlur)a.ThreeJsSystem.effectBlend.uniforms.mixRatio.value=0.7;else if(!a.ThreeJsSystem.isWebGLUsed&&d===b.animationStyles.motionBlur)b.blendAmount=0.6;if(a.ThreeJsSystem.isWebGLUsed&&d===b.animationStyles.paintOver)a.ThreeJsSystem.effectBlend.uniforms.mixRatio.value=
1;else if(!a.ThreeJsSystem.isWebGLUsed&&d===b.animationStyles.paintOver)b.blendAmount=1;if(a.ThreeJsSystem.isWebGLUsed&&d===b.animationStyles.normal)a.ThreeJsSystem.effectBlend.uniforms.mixRatio.value=0;else if(!a.ThreeJsSystem.isWebGLUsed&&d===b.animationStyles.normal)b.blendAmount=0}};return b},createLightSystem=function(a,b){var c={};a.objectPools[a.primitiveTypes.ambientLight]=[];a.objectsUsedInFrameCounts[a.primitiveTypes.ambientLight]=0;c.lightsAreOn=false;window.lights=c.lights=function(){c.lightsAreOn=
true};window.noLights=c.noLights=function(){c.lightsAreOn=false};window.ambientLight=c.ambientLight=function(d,e,f,h){var g=false,d=d===void 0?b.ColourFunctions.color(255):b.ColourFunctions.color(d,e,f,h);c.lightsAreOn=true;a.defaultNormalFill=false;a.defaultNormalStroke=false;e=a.objectPools[a.primitiveTypes.ambientLight];f=e[a.objectsUsedInFrameCounts[a.primitiveTypes.ambientLight]];if(f===void 0){f=new b.THREE.PointLight(d);f.position.set(10,50,130);g=true;e.push(f);f.detailLevel=0;f.primitiveType=
a.primitiveTypes.ambientLight}else f.color.setHex(d);a.objectsUsedInFrameCounts[a.primitiveTypes.ambientLight]=a.objectsUsedInFrameCounts[a.primitiveTypes.ambientLight]+1;g&&b.ThreeJsSystem.scene.add(f)};return c},wheel=function(a){var b=a||window.event;[].slice.call(arguments,1);var c=0,d=0,a=$.event.fix(b);a.type="mousewheel";b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);d=c;b.axis!==void 0&&b.axis===b.HORIZONTAL_AXIS&&(d=0);b.wheelDeltaY!==void 0&&(d=b.wheelDeltaY/120);if(d>0.2){b=
editor.getCursor(true);b.line!==editor.lineCount()-1&&editor.setCursor(b.line+1,b.ch)}else if(d<-0.2){b=editor.getCursor(true);editor.setCursor(b.line-1,b.ch)}};(function(){if(window.addEventListener){window.addEventListener("DOMMouseScroll",wheel,false);window.onmousewheel=document.onmousewheel=wheel}})();
var createUi=function(a,b){var c={},d;d=function(a){var b,a=$(a);b={x:1,y:1};b.x=(window.innerWidth+40)/a.width();b.y=(window.innerHeight+40)/a.height();b=b.x+", "+b.y;a.css("-ms-transform-origin","left top").css("-webkit-transform-origin","left top").css("-moz-transform-origin","left top").css("-o-transform-origin","left top").css("transform-origin","left top").css("-ms-transform","scale("+b+")").css("-webkit-transform","scale3d("+b+", 1)").css("-moz-transform","scale("+b+")").css("-o-transform",
"scale("+b+")").css("transform","scale("+b+")")};c.adjustCodeMirrorHeight=function(){$(".CodeMirror-scroll").css("height",window.innerHeight-$("#theMenu").height())};c.fullscreenify=function(a){window.addEventListener("resize",function(){c.adjustCodeMirrorHeight();d(a)},false);d(a)};c.checkErrorAndReport=function(a){$("#dangerSignText").css("color","red");a=a.message||a;a.indexOf("Unexpected 'INDENT'")>-1?a="weird indentation":a.indexOf("Unexpected 'TERMINATOR'")>-1?a="line not complete":a.indexOf("Unexpected 'CALL_END'")>
-1?a="line not complete":a.indexOf("Unexpected '}'")>-1?a="something wrong":a.indexOf("Unexpected 'MATH'")>-1?a="weird arithmetic there":a.indexOf("Unexpected 'LOGIC'")>-1?a="odd expression thingy":a.indexOf("Unexpected 'NUMBER'")>-1?a="lost number?":a.indexOf("Unexpected 'NUMBER'")>-1?a="lost number?":a.indexOf("ReferenceError")>-1&&(a=a.replace(/ReferenceError:\s/gm,""));$("#errorMessageText").text(a)};c.clearError=function(){$("#dangerSignText").css("color","#000000");$("#errorMessageText").text("")};
c.soundSystemOk=function(){$("#soundSystemStatus").text("Sound System On").removeClass("off").addClass("on")};c.hideStatsWidget=function(){$("#statsWidget").hide()};c.showStatsWidget=function(){setTimeout('$("#statsWidget").show()',1)};c.setup=function(){$(document).ready(function(){$("#aboutMenu").click(function(){$("#aboutWindow").modal();$("#simplemodal-container").height(250);return false});$("#demos li a").click(function(){a.trigger("load-program",$(this).attr("id"));return false});$("#tutorials li a").click(function(){a.trigger("load-program",
$(this).attr("id"));return false});$("#autocodeIndicatorContainer").click(function(){a.trigger("toggle-autocoder");return false});$("#dimCodeButtonContainer").click(function(){a.trigger("editor-toggle-dim");return false});$("#resetButtonContainer").click(function(){a.trigger("reset");$(this).stop().fadeOut(100).fadeIn(100);return false});b.getDomElement().style.position="absolute";b.getDomElement().style.right="0px";b.getDomElement().style.top="0px";document.body.appendChild(b.getDomElement());$("#startingCourtainScreen").fadeOut();
$("#formCode").css("opacity",0);c.fullscreenify("#backGroundCanvas");c.adjustCodeMirrorHeight()})};a.bind("report-runtime-or-compile-time-error",c.checkErrorAndReport,c);a.bind("clear-error",c.clearError,c);a.bind("autocoder-button-pressed",function(a){a===true?$("#autocodeIndicator").html("Autocode: on").css("background-color","#FF0000"):$("#autocodeIndicator").html("Autocode: off").css("background-color","")});a.bind("autocoderbutton-flash",function(){$("#autocodeIndicator").fadeOut(100).fadeIn(100)});
a.bind("auto-hide-code-button-pressed",function(a){a===true?$("#dimCodeIndicator").html("Hide Code: on"):$("#dimCodeIndicator").html("Hide Code: off")});return c};$(document).ready(function(){startEnvironment(document.getElementById("blendedThreeJsSceneCanvas"),document.getElementById("backGroundCanvas"),false,false)});
var isCanvasSupported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},startEnvironment=function(a,b,c,d){if(isCanvasSupported){var e=createEventRouter(),f=new Stats;c===void 0&&(c=false);c===null&&(c=false);var h=createColours(),g=createLiveCodeLabCore(a,b,c,e,f),a=createUrlRouter(e),b=createBigCursor(e),i=createEditor(e,CodeMirror),j=createUi(e,f),k=createAutocoder(e,i,h);createEditorDimmer(e,b);createProgramLoader(e,i,g);e.bind("reset",g.paintARandomBackground);
e.trigger("editor-toggle-dim",true);e.bind("livecodelab-running-stably",j.showStatsWidget);e.bind("code_changed",function(a){if(a!=="")e.trigger("big-cursor-hide");else{e.trigger("set-url-hash","");e.trigger("big-cursor-show");j.hideStatsWidget()}g.updateCode(a)});e.bind("runtime-error-thrown",function(a){e.trigger("report-runtime-or-compile-time-error",a);k.active?i.undo():g.runLastWorkingDrawFunction();if(d)throw a;});e.bind("compile-time-error-thrown",function(a){e.trigger("report-runtime-or-compile-time-error",
a);k.active&&i.undo()});e.bind("clear-error",j.clearError,j);e.bind("all-sounds-loaded-and tested",j.soundSystemOk);g.loadAndTestAllTheSounds();g.paintARandomBackground();g.startAnimationLoop();if(!Detector.webgl||c){$("#noWebGLMessage").modal({onClose:eval("$.modal.close()","liveCodeLabCore.isAudioSupported")});$("#simplemodal-container").height(200)}i.focus();a.urlPointsToDemoOrTutorial()||setTimeout(g.playStartupSound,650);b.toggleBlink(true);j.setup()}else{$("#noCanvasMessage").modal({onClose:function(){$("#loading").text("sorry :-(");
$.modal.close()}});$("#simplemodal-container").height(200)}},createBowser=function(){var a=navigator.userAgent,b=/msie/i.test(a),c=/chrome/i.test(a),d=/phantom/i.test(a),e=/safari/i.test(a)&&!c&&!d,f=/iphone/i.test(a),h=/ipad/i.test(a),g=/touchpad/i.test(a),i=/android/i.test(a),j=/opera/i.test(a),k=/firefox/i.test(a),o=/gecko\//i.test(a),p=/seamonkey\//i.test(a),m=/version\/(\d+(\.\d+)?)/i,q,n=function(){if(b)return{msie:true,version:a.match(/msie (\d+(\.\d+)?);/i)[1]};if(c)return{webkit:true,chrome:true,
version:a.match(/chrome\/(\d+(\.\d+)?)/i)[1]};if(d)return{webkit:true,phantom:true,version:a.match(/phantomjs\/(\d+(\.\d+)+)/i)[1]};if(g)return{webkit:true,touchpad:true,version:a.match(/touchpad\/(\d+(\.\d+)?)/i)[1]};if(f||h){q={webkit:true,mobile:true,ios:true,iphone:f,ipad:h};if(m.test(a))q.version=a.match(m)[1];return q}if(i)return{webkit:true,android:true,mobile:true,version:a.match(m)[1]};if(e)return{webkit:true,safari:true,version:a.match(m)[1]};if(j)return{opera:true,version:a.match(m)[1]};
if(o){q={gecko:true,mozilla:true,version:a.match(/firefox\/(\d+(\.\d+)?)/i)[1]};if(k)q.firefox=true;return q}if(p)return{seamonkey:true,version:a.match(/seamonkey\/(\d+(\.\d+)?)/i)[1]}}();n.msie&&n.version>=7||n.chrome&&n.version>=10||n.firefox&&n.version>=4||n.safari&&n.version>=5||n.opera&&n.version>=10?n.a=true:n.msie&&n.version<7||n.chrome&&n.version<10||n.firefox&&n.version<4||n.safari&&n.version<5||n.opera&&n.version<10?n.c=true:n.x=true;return n};
