'use strict';var createLiveCodeLabCore;
createLiveCodeLabCore=function(a){var b;b={};b.THREE=THREE;b.TimeKeeper=createTimeKeeper();b.BlendControls=createBlendControls(b);b.ColourFunctions=createColourFunctions();b.Renderer=createRenderer(b);b.SoundSystem=createSoundSystem(a.eventRouter,buzz,createBowser(),createSampleBank(buzz));b.BackgroundPainter=createBackgroundPainter(a.eventRouter,a.canvasForBackground,b);b.DrawFunctionRunner=createDrawFunctionRunner(a.eventRouter,b);b.CodeTransformer=createCodeTransformer(a.eventRouter,CoffeeScript,
b);b.AnimationLoop=createAnimationLoop(a.eventRouter,a.statsWidget,b);b.ThreeJsSystem=createThreeJsSystem(Detector,THREEx,a.blendedThreeJsSceneCanvas,a.forceCanvasRenderer,a.testMode,b.THREE);b.MatrixCommands=createMatrixCommands(b.THREE,b);b.GraphicsCommands=createGraphicsCommands(b.THREE,b);b.LightSystem=createLightSystem(b.GraphicsCommands,b);b.paintARandomBackground=function(){return b.BackgroundPainter.paintARandomBackground()};b.startAnimationLoop=function(){return b.AnimationLoop.animate()};
b.runLastWorkingDrawFunction=function(){return b.DrawFunctionRunner.reinstateLastWorkingDrawFunction()};b.loadAndTestAllTheSounds=function(){return b.SoundSystem.loadAndTestAllTheSounds()};b.playStartupSound=function(){return b.SoundSystem.playStartupSound()};b.isAudioSupported=function(){return b.SoundSystem.isAudioSupported()};b.updateCode=function(c){b.CodeTransformer.updateCode(c);if(""!==c&&b.dozingOff)return b.dozingOff=!1,b.AnimationLoop.animate(),a.eventRouter.trigger("livecodelab-waking-up")};
b.getForeground3DSceneImage=function(a){var e,d,g,f;e=b.ThreeJsSystem.blendedThreeJsSceneCanvas;f=new Image;f.src=e.toDataURL();a&&(d=document.createElement("canvas"),d.width=e.width,d.height=e.height,g=d.getContext("2d"),g.drawImage(f,0,0),g.globalCompositeOperation="destination-over",g.fillStyle=a,g.fillRect(0,0,e.width,e.height),f=new Image,f.src=d.toDataURL());return f};return b};var createEventRouter;
createEventRouter=function(){var a,b;a={};b={};a.bind=function(a,e,d){e={callback:e,context:d};b[a]||(b[a]=[]);return b[a].push(e)};a.trigger=function(a){var e,d,g,f,h;e=Array.prototype.slice.call(arguments);if(b[a]){e=e.slice(1);d=b[a];g=0;for(h=[];g<d.length;)f=d[g],f.callback.apply(f.context,e),h.push(g+=1);return h}};return a};var createCodeChecker,createParsingFunctions;
createParsingFunctions=function(){var a,b,c,e;a={};b=e=c=void 0;a.finished=!0;a.setString=function(d){b=0;c=d;e=c.length;return""!==d?a.finished=!1:a.finished=!0};a.pop=function(){var d;if(!(b>=e))return d=c.charAt(b),b+=1,b>=e&&(a.finished=!0),d};a.peek=function(){if(b<e)return c.charAt(b)};return a};
createCodeChecker=function(){var a,b,c,e,d;a=createParsingFunctions();d={};b=e=c=void 0;e=function(){return{err:!1,bracketStack:[],doubleQ:0,singleQ:0,inSingleString:!1,inDoubleString:!1,inComment:!1,message:""}};c=function(a){var c;0<a.bracketStack.length?(c=a.bracketStack.pop(),d.message=b(c),a.err=!0):a.inSingleString?(d.message=b("'"),a.err=!0):a.inDoubleString&&(d.message=b('"'),a.err=!0);return a};b=function(a){switch(a){case "{":a="Unbalanced {}";break;case "(":a="Unbalanced ()";break;case "[":a=
"Unbalanced []";break;case "'":a="Missing '";break;case '"':a='Missing "';break;default:a="Unexpected "+a}return a};a.charHandlers={"[":function(){if(!d.inSingleString&&!d.inDoubleString&&!d.inComment)return d.bracketStack.push("[")},"]":function(){var a;if(!d.inSingleString&&!d.inDoubleString&&!d.inComment&&(a=d.bracketStack.pop(),"["!==a))return d.err=!0,d.message=b(a)},"(":function(){if(!d.inSingleString&&!d.inDoubleString&&!d.inComment)return d.bracketStack.push("(")},")":function(){var a;if(!d.inSingleString&&
!d.inDoubleString&&!d.inComment&&(a=d.bracketStack.pop(),"("!==a))return d.err=!0,d.message=b(a)},"{":function(){if(!d.inSingleString&&!d.inDoubleString&&!d.inComment)return d.bracketStack.push("{")},"}":function(){var a;if(!d.inSingleString&&!d.inDoubleString&&!d.inComment&&(a=d.bracketStack.pop(),"{"!==a))return d.err=!0,d.message=b(a)},"'":function(){if(!d.inComment){if(d.inSingleString)return d.inSingleString=!1,d.singleQ-=1;if(!d.inDoubleString)return d.inSingleString=!0,d.singleQ+=1}},'"':function(){if(!d.inComment){if(d.inDoubleString)return d.inDoubleString=
!1,d.doubleQ-=1;if(!d.inSingleString)return d.inDoubleString=!0,d.doubleQ+=1}},"/":function(){if(!d.inSingleString&&!d.inDoubleString&&!d.inComment&&"/"===a.peek())return a.pop(),d.inComment=!0},"\\":function(){return a.pop()},"\n":function(){if(d.inSingleString)return d.message=b("'"),d.err=!0;if(d.inDoubleString)return d.message=b('"'),d.err=!0;if(d.inComment)return d.inComment=!1}};a.parseChar=function(b){if(a.charHandlers[b])return a.charHandlers[b]()};a.parse=function(b){d=e();for(a.setString(b);!a.finished&&
!d.err;)b=a.pop(),a.parseChar(b);return c(d)};return a};"undefined"!==typeof exports&&(exports.simple_checker={createChecker:createCodeChecker,createParsingFunctions:createParsingFunctions});var createUrlRouter;
createUrlRouter=function(a){var b;b={getHash:function(){var a;return(a=window.location.href.match(/#(.*)$/))?a[1]:""},setHash:function(a){return window.location.hash=a},urlPointsToDemoOrTutorial:function(){var c,e;c=false;if(e=b.getHash()){a.trigger("url-hash-changed",e);c=true}return c}};a.bind("set-url-hash",b.setHash,b);return b};var createBigCursor;
createBigCursor=function(a){var b,c,e,d,g;b={};g=e=c=d=void 0;b.isShowing=true;d=function(){return $("#fakeStartingBlinkingCursor").animate({opacity:0.2},"fast","swing").animate({opacity:1},"fast","swing")};b.toggleBlink=function(a){if(a){if(!c)return c=setInterval(d,800)}else{clearTimeout(c);return c=null}};e=function(){var a;if(b.isShowing){a=$("#caption").html();a=a.substring(0,a.length-1);$("#caption").html(a+"|");$("#fakeStartingBlinkingCursor").html("");$("#toMove").animate({opacity:0,margin:-100,
fontSize:300,left:0},"fast");setTimeout('$("#formCode").animate({opacity: 1}, "fast");',120);setTimeout('$("#justForFakeCursor").hide();',200);setTimeout('$("#toMove").hide();',200);b.isShowing=false;return b.toggleBlink(false)}};g=function(){if(!b.isShowing){$("#formCode").animate({opacity:0},"fast");$("#justForFakeCursor").show();$("#toMove").show();$("#caption").html("|");$("#toMove").animate({opacity:1,margin:0,fontSize:350,left:0},"fast",function(){$("#caption").html("");return $("#fakeStartingBlinkingCursor").html("|")});
b.isShowing=true;return b.toggleBlink(true)}};a.bind("big-cursor-show",function(){return g()});a.bind("big-cursor-hide",function(){return e()});return b};var McCONTINUE,McLexer,McRule,McRunMethod,McState;McState=function(){var a,b;a=[];b=function(b){return function(e){a.push(new McRule(b,e));return null}};b.rules=a;b.lex=function(a){for(a=b.run(a);typeof a==="function";)a=a();return a};b.run=McRunMethod;b.continuation=function(a){return function(){return b.run(a)}};return b};
McRule=function(a,b){this.regex=RegExp("^("+a.source+")");this.regex.compile&&this.regex.compile(this.regex);this.action=b;return null};McRunMethod=function(a){var b,c,e,d,g,f;c=d=null;e=-1;for(b=this.rules.length-1;b>=0;){f=this.rules[b];if((g=f.matches(a))&&g[0].length>=e){d=f;c=g;e=g[0].length}--b}if(d)return d.action(c,a.substring(e),this);throw"Lexing error; no match found for: '"+a+"'";};McCONTINUE=function(a){return function(b,c){return a.run(c)}};
McRule.prototype.matches=function(a){(a=a.match(this.regex))&&a.shift();return a};McLexer={State:McState};
var createSampleBank=function(a){if(a.isMP3Supported())a="mp3";else if(a.isOGGSupported())a="ogg";else return;a={sounds:[],soundsByName:{},fileType:a,load:function(a,c){var e=this.sounds.length;this.sounds.push({name:a,path:c+"."+this.fileType});return this.soundsByName[a]=e},getByName:function(a){return this.sounds[this.soundsByName[a]]},getByNumber:function(a){return this.sounds[a]}};a.load("bing","./sound/audioFiles/start_bing");a.load("highHatClosed","./sound/audioFiles/AMB_HHCL");a.load("highHatOpen",
"./sound/audioFiles/AMB_HHOP");a.load("toc3","./sound/audioFiles/AMB_LTM2");a.load("toc4","./sound/audioFiles/AMB_RIM1");a.load("snare","./sound/audioFiles/AMB_SN13");a.load("snare2","./sound/audioFiles/AMB_SN_5");a.load("crash","./sound/audioFiles/CRASH_1");a.load("crash2","./sound/audioFiles/CRASH_5");a.load("crash3","./sound/audioFiles/CRASH_6");a.load("ride","./sound/audioFiles/RIDE_1");a.load("glass","./sound/audioFiles/glass2");a.load("thump","./sound/audioFiles/8938__patchen__piano-hits-hand-03v2");
a.load("lowFlash","./sound/audioFiles/9569__thanvannispen__industrial-low-flash04");a.load("lowFlash2","./sound/audioFiles/9570__thanvannispen__industrial-low-flash07");a.load("tranceKick2","./sound/audioFiles/24004__laya__dance-kick3");a.load("tranceKick","./sound/audioFiles/33325__laya__trance-kick01");a.load("voltage","./sound/audioFiles/49255__keinzweiter__bonobob-funk");a.load("beepA","./sound/audioFiles/100708__steveygos93__bleep_a");a.load("beepB","./sound/audioFiles/100708__steveygos93__bleep_b");
a.load("beepC","./sound/audioFiles/100708__steveygos93__bleep_c");a.load("beepD","./sound/audioFiles/100708__steveygos93__bleep_d");a.load("alienBeep","./sound/audioFiles/132389__blackie666__alienbleep");a.load("penta1","./sound/audioFiles/toneMatrix-1");a.load("penta2","./sound/audioFiles/toneMatrix-2");a.load("penta3","./sound/audioFiles/toneMatrix-3");a.load("penta4","./sound/audioFiles/toneMatrix-4");a.load("penta5","./sound/audioFiles/toneMatrix-5");a.load("penta6","./sound/audioFiles/toneMatrix-6");
a.load("penta7","./sound/audioFiles/toneMatrix-7");a.load("penta8","./sound/audioFiles/toneMatrix-8");a.load("penta9","./sound/audioFiles/toneMatrix-9");a.load("penta10","./sound/audioFiles/toneMatrix-10");a.load("penta11","./sound/audioFiles/toneMatrix-11");a.load("penta12","./sound/audioFiles/toneMatrix-12");a.load("penta13","./sound/audioFiles/toneMatrix-13");a.load("penta14","./sound/audioFiles/toneMatrix-14");a.load("penta15","./sound/audioFiles/toneMatrix-15");a.load("penta16","./sound/audioFiles/toneMatrix-16");
a.load("ciack","./sound/audioFiles/ciack");a.load("snap","./sound/audioFiles/snap");a.load("thump2","./sound/audioFiles/thump2");a.load("dish","./sound/audioFiles/dish");return a},createSoundSystem=function(a,b,c,e){var d={},g=0,f,h=0,i=0,j=false,n=0,x=[],l={},p=[],u,k,w,q;p.soundIDs=[];p.beatStrings=[];d.resetLoops=0;d.resetLoops=function(){p.soundIDs=[];p.beatStrings=[]};d.playStartupSound=function(){(new b.sound(e.getByName("bing").path)).play()};d.SetUpdatesPerMinute=function(a){w=a};d.anyCodeReactingTobpm=
false;window.bpm=d.bpm=function(a){if(a!==void 0){a>125&&(a=125);a<0&&(a=0);w=a*4}};window.play=d.play=function(a,b){d.anyCodeReactingTobpm=true;b=b.replace(/\s*/g,"");p.soundIDs.push(a);p.beatStrings.push(b)};if(c.firefox)q=function(a,b){var c,f,d;d=a[b];c=document.createElement("audio");c.setAttribute("preload","auto");c.autobuffer=true;f=document.createElement("source");f.type="audio/ogg";f.src=d;c.appendChild(f);c.addEventListener("load",function(){c.play();$(".filename span").html(c.src)},true);
c.play()};else if(c.safari||c.ie||c.chrome)q=function(a,c,f){var d,e=f[c],x,g;for(x=0;x<e.length;x=x+1){g=e[x];if(g.isEnded()){d=g;break}}if(d===void 0){if(i>31){j=true;$("#soundSystemIsMangledMessage").modal();$("#simplemodal-container").height(250);return}d=new b.sound(a[c]);f[c].push(d);i=i+1}d.play()};u=function(){var a,b,c;if(!j){h=h+1;h=h%16;for(a=0;a<p.soundIDs.length;a=a+1){b=p.soundIDs[a];if(l[b]){c=p.beatStrings[a];c=c.charAt(h%c.length);c==="x"&&q(l,b,x)}}}};d.changeUpdatesPerMinuteIfNeeded=
function(){if(g!==w){clearTimeout(f);w!==0&&(f=setInterval(u,6E4/w));g=w}};d.isAudioSupported=function(){setTimeout(function(){if(!b.isSupported()){$("#noAudioMessage").modal();$("#simplemodal-container").height(200)}},500)};k=function(c,f){var d=new b.sound(f.path);d.mute();d.load();d.bind("ended",function(){d.unbind("ended");d.unmute();n=n+1;n===c.sounds.length*6&&a.trigger("all-sounds-loaded-and tested")});d.play();x[f.name].push(d)};d.loadAndTestAllTheSounds=function(){var b,f,d;for(f=0;f<e.sounds.length;f=
f+1){b=e.getByNumber(f);x[b.name]=[];l[b.name]=b.path;if(c.safari)for(d=0;d<6;d=d+1)setTimeout(k,200*f,e,b)}c.safari||a.trigger("all-sounds-loaded-and tested")};return d},buzz={defaults:{autoplay:!1,duration:5E3,formats:[],loop:!1,placerunner:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(a,b){function c(a){for(var b=[],c=a.length-1,f=0;f<=c;f++)b.push({start:a.start(c),
end:a.end(c)});return b}function e(a,b){var c=document.createElement("source");c.src=b;if(buzz.types[b.split(".").pop()])c.type=buzz.types[b.split(".").pop()];a.appendChild(c)}var b=b||{},d=0,g=[],f={},h=buzz.isSupported();this.load=function(){if(!h)return this;this.sound.load();return this};this.play=function(){if(!h)return this;this.sound.play();return this};this.togglePlay=function(){if(!h)return this;this.sound.paused?this.sound.play():this.sound.pause();return this};this.pause=function(){if(!h)return this;
this.sound.pause();return this};this.isPaused=function(){return!h?null:this.sound.paused};this.stop=function(){if(!h)return this;this.setTime(0);this.sound.pause();return this};this.isEnded=function(){return!h?null:this.sound.ended};this.loop=function(){if(!h)return this;this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!h)return this;this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=
function(){if(!h)return this;this.sound.muted=true;return this};this.unmute=function(){if(!h)return this;this.sound.muted=false;return this};this.toggleMute=function(){if(!h)return this;this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){return!h?null:this.sound.muted};this.setVolume=function(a){if(!h)return this;a<0&&(a=0);a>100&&(a=100);this.volume=a;this.sound.volume=a/100;return this};this.getVolume=function(){return!h?this:this.volume};this.increaseVolume=function(a){return this.setVolume(this.volume+
(a||1))};this.decreaseVolume=function(a){return this.setVolume(this.volume-(a||1))};this.setTime=function(a){if(!h)return this;this.whenReady(function(){this.sound.currentTime=a});return this};this.getTime=function(){if(!h)return null;var a=Math.round(this.sound.currentTime*100)/100;return isNaN(a)?buzz.defaults.placerunner:a};this.setPercent=function(a){return!h?this:this.setTime(buzz.fromPercent(a,this.sound.duration))};this.getPercent=function(){if(!h)return null;var a=Math.round(buzz.toPercent(this.sound.currentTime,
this.sound.duration));return isNaN(a)?buzz.defaults.placerunner:a};this.setSpeed=function(a){if(!h)return this;this.sound.playbackRate=a};this.getSpeed=function(){return!h?null:this.sound.playbackRate};this.getDuration=function(){if(!h)return null;var a=Math.round(this.sound.duration*100)/100;return isNaN(a)?buzz.defaults.placerunner:a};this.getPlayed=function(){return!h?null:c(this.sound.played)};this.getBuffered=function(){return!h?null:c(this.sound.buffered)};this.getSeekable=function(){return!h?
null:c(this.sound.seekable)};this.getErrorCode=function(){return h&&this.sound.error?this.sound.error.code:0};this.getErrorMessage=function(){if(!h)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){return!h?null:this.sound.readyState};this.getStateMessage=function(){if(!h)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";
case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){return!h?null:this.sound.networkState};this.getNetworkStateMessage=function(){if(!h)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(a,b){if(!h)return this;this.sound[a]=
b;return this};this.get=function(a){return!h?null:a?this.sound[a]:this.sound};this.bind=function(a,b){if(!h)return this;for(var a=a.split(" "),c=this,f=function(a){b.call(c,a)},d=0;d<a.length;d++){var e=a[d],n=e,e=n.split(".")[0];g.push({idx:n,func:f});this.sound.addEventListener(e,f,true)}return this};this.unbind=function(a){if(!h)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],f=c.split(".")[0],d=0;d<g.length;d++){var e=g[d].idx.split(".");if(g[d].idx==c||e[1]&&e[1]==c.replace(".",
"")){this.sound.removeEventListener(f,g[d].func,true);g.splice(d,1)}}return this};this.bindOnce=function(a,b){if(!h)return this;var c=this;f[d++]=false;this.bind(a+"."+d,function(){if(!f[d]){f[d]=true;b.call(c)}c.unbind(a+"."+d)})};this.trigger=function(a){if(!h)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],f=0;f<g.length;f++){var d=g[f].idx.split(".");if(g[f].idx==c||d[0]&&d[0]==c.replace(".","")){var e=document.createEvent("HTMLEvents");e.initEvent(d[0],false,true);this.sound.dispatchEvent(e)}}return this};
this.fadeTo=function(a,b,c){function f(){setTimeout(function(){if(d<a&&g.volume<a){g.setVolume(g.volume=g.volume+1);f()}else if(d>a&&g.volume>a){g.setVolume(g.volume=g.volume-1);f()}else c instanceof Function&&c.apply(g)},e)}if(!h)return this;if(b instanceof Function){c=b;b=buzz.defaults.duration}else b=b||buzz.defaults.duration;var d=this.volume,e=b/Math.abs(d-a),g=this;this.play();this.whenReady(function(){f()});return this};this.fadeIn=function(a,b){return!h?this:this.setVolume(0).fadeTo(100,a,
b)};this.fadeOut=function(a,b){return!h?this:this.fadeTo(0,a,b)};this.fadeWith=function(a,b){if(!h)return this;this.fadeOut(b,function(){this.stop()});a.play().fadeIn(b);return this};this.whenReady=function(a){if(!h)return null;var b=this;this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){a.call(b)}):a.call(b)};if(h&&a){for(var i in buzz.defaults)buzz.defaults.hasOwnProperty(i)&&(b[i]=b[i]||buzz.defaults[i]);this.sound=document.createElement("audio");if(a instanceof Array)for(var j in a)a.hasOwnProperty(j)&&
e(this.sound,a[j]);else if(b.formats.length)for(var n in b.formats)b.formats.hasOwnProperty(n)&&e(this.sound,a+"."+b.formats[n]);else e(this.sound,a);b.loop&&this.loop();if(b.autoplay)this.sound.autoplay="autoplay";this.sound.preload=b.preload===true?"auto":b.preload===false?"none":b.preload;this.setVolume(b.volume);buzz.sounds.push(this)}},group:function(a){function b(){for(var b=c(null,arguments),d=b.shift(),g=0;g<a.length;g++)a[g][d].apply(a[g],b)}function c(a,b){return a instanceof Array?a:Array.prototype.slice.call(b)}
a=c(a,arguments);this.getSounds=function(){return a};this.add=function(b){for(var b=c(b,arguments),d=0;d<b.length;d++)a.push(b[d])};this.remove=function(b){for(var b=c(b,arguments),d=0;d<b.length;d++)for(var g=0;g<a.length;g++)if(a[g]==b[d]){a.splice(g,1);break}};this.load=function(){b("load");return this};this.play=function(){b("play");return this};this.togglePlay=function(){b("togglePlay");return this};this.pause=function(a){b("pause",a);return this};this.stop=function(){b("stop");return this};
this.mute=function(){b("mute");return this};this.unmute=function(){b("unmute");return this};this.toggleMute=function(){b("toggleMute");return this};this.setVolume=function(a){b("setVolume",a);return this};this.increaseVolume=function(a){b("increaseVolume",a);return this};this.decreaseVolume=function(a){b("decreaseVolume",a);return this};this.loop=function(){b("loop");return this};this.unloop=function(){b("unloop");return this};this.setTime=function(a){b("setTime",a);return this};this.set=function(a,
c){b("set",a,c);return this};this.bind=function(a,c){b("bind",a,c);return this};this.unbind=function(a){b("unbind",a);return this};this.bindOnce=function(a,c){b("bindOnce",a,c);return this};this.trigger=function(a){b("trigger",a);return this};this.fade=function(a,c,g,f){b("fade",a,c,g,f);return this};this.fadeIn=function(a,c){b("fadeIn",a,c);return this};this.fadeOut=function(a,c){b("fadeOut",a,c);return this}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return!!buzz.el.canPlayType},
isOGGSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(a,b){var c,e,d;c=Math.floor(a/3600);c=isNaN(c)?"--":c>=10?
c:"0"+c;e=b?Math.floor(a/60%60):Math.floor(a/60);e=isNaN(e)?"--":e>=10?e:"0"+e;d=Math.floor(a%60);d=isNaN(d)?"--":d>=10?d:"0"+d;return b?c+":"+e+":"+d:e+":"+d},fromTimer:function(a){var b=a.toString().split(":");b&&b.length==3&&(a=parseInt(b[0],10)*3600+parseInt(b[1],10)*60+parseInt(b[2],10));b&&b.length==2&&(a=parseInt(b[0],10)*60+parseInt(b[1],10));return a},toPercent:function(a,b,c){c=Math.pow(10,c||0);return Math.round(a*100/b*c)/c},fromPercent:function(a,b,c){c=Math.pow(10,c||0);return Math.round(b/
100*a*c)/c}},createAnimationLoop,frame;frame=0;
createAnimationLoop=function(a,b,c){var e,d,g;e={};d=void 0;e.wantedFramesPerSecond=-1;e.useRequestAnimationFrame=true;g=function(){if(e.useRequestAnimationFrame){if(e.wantedFramesPerSecond===-1)return window.requestAnimationFrame(function(){return e.animate()});if(d===void 0)return d=setInterval(function(){return window.requestAnimationFrame(function(){return e.animate()})},1E3/e.wantedFramesPerSecond)}else return e.wantedFramesPerSecond===-1?setTimeout(function(){return e.animate()},1E3/60):setTimeout(function(){return e.animate()},
1E3/e.wantedFramesPerSecond)};e.animate=function(){var f;c.MatrixCommands.resetMatrixStack();c.SoundSystem.resetLoops();frame===0?c.TimeKeeper.resetTime():c.TimeKeeper.updateTime();c.DrawFunctionRunner.resetTrackingOfDoOnceOccurrences();c.SoundSystem.anyCodeReactingTobpm=false;c.SoundSystem.SetUpdatesPerMinute(240);c.LightSystem.noLights();c.GraphicsCommands.reset();c.BlendControls.animationStyle(c.BlendControls.animationStyles.normal);c.BackgroundPainter.resetGradientStack();if(c.DrawFunctionRunner.drawFunction){g();
try{c.DrawFunctionRunner.runDrawFunction()}catch(d){a.trigger("runtime-error-thrown",d);return}f=c.DrawFunctionRunner;f.putTicksNextToDoOnceBlocksThatHaveBeenRun(c.CodeTransformer)}else c.dozingOff=true;frame===0&&c.TimeKeeper.resetTime();c.BlendControls.animationStyleUpdateIfChanged();c.BackgroundPainter.simpleGradientUpdateIfChanged();c.SoundSystem.changeUpdatesPerMinuteIfNeeded();frame++;c.Renderer.render(c.GraphicsCommands);if(b!==null)return b.update()};return e};var createThreeJsSystem;
createThreeJsSystem=function(a,b,c,e,d,g){var f;f={isWebGLUsed:false,composer:{}};f.forceCanvasRenderer=e;if(!c){c=document.createElement("canvas");c.width=window.innerWidth;c.height=window.innerHeight}f.blendedThreeJsSceneCanvas=c;if(!f.forceCanvasRenderer&&a.webgl){f.ballDefaultDetLevel=16;f.blendedThreeJsSceneCanvasContext=c.getContext("experimental-webgl");f.renderer=new g.WebGLRenderer({canvas:f.blendedThreeJsSceneCanvas,preserveDrawingBuffer:d,antialias:false,premultipliedAlpha:false});f.isWebGLUsed=
true}else{f.ballDefaultDetLevel=6;f.currentFrameThreeJsSceneCanvas=document.createElement("canvas");a=f.currentFrameThreeJsSceneCanvas;a.width=f.blendedThreeJsSceneCanvas.width;a.height=f.blendedThreeJsSceneCanvas.height;f.currentFrameThreeJsSceneCanvasContext=a.getContext("2d");f.previousFrameThreeJSSceneRenderForBlendingCanvas=document.createElement("canvas");c=f.previousFrameThreeJSSceneRenderForBlendingCanvas;c.width=f.blendedThreeJsSceneCanvas.width;c.height=f.blendedThreeJsSceneCanvas.height;
f.previousFrameThreeJSSceneRenderForBlendingCanvasContext=f.previousFrameThreeJSSceneRenderForBlendingCanvas.getContext("2d");f.blendedThreeJsSceneCanvasContext=f.blendedThreeJsSceneCanvas.getContext("2d");f.renderer=new g.CanvasRenderer({canvas:a,antialias:true,preserveDrawingBuffer:d})}f.renderer.setSize(f.blendedThreeJsSceneCanvas.width,f.blendedThreeJsSceneCanvas.height);f.scene=new g.Scene;f.scene.matrixAutoUpdate=false;f.camera=new g.PerspectiveCamera(35,f.blendedThreeJsSceneCanvas.width/f.blendedThreeJsSceneCanvas.height,
1,1E4);f.camera.position.set(0,0,5);f.scene.add(f.camera);b.WindowResize.bind(f.renderer,f.camera);f.buildPostprocessingChain=function(){var a,b,c,d;a={format:g.RGBAFormat,stencilBuffer:true};c=new g.WebGLRenderTarget(f.blendedThreeJsSceneCanvas.width,f.blendedThreeJsSceneCanvas.height,a);a=new g.SavePass(new g.WebGLRenderTarget(f.blendedThreeJsSceneCanvas.width,f.blendedThreeJsSceneCanvas.height,a));a.clear=false;f.effectBlend=new g.ShaderPass(g.ShaderExtras.blend,"tDiffuse1");d=new g.ShaderPass(g.ShaderExtras.screen);
f.effectBlend.uniforms.tDiffuse2.value=a.renderTarget;f.effectBlend.uniforms.mixRatio.value=0;b=new g.RenderPass(f.scene,f.camera);f.composer=new g.EffectComposer(f.renderer,c);f.composer.addPass(b);f.composer.addPass(f.effectBlend);f.composer.addPass(a);f.composer.addPass(d);return d.renderToScreen=true};f.isWebGLUsed&&f.buildPostprocessingChain();return f};var createRenderer;
createRenderer=function(a){var b;b=function(b){var e,d,g,f;e=a.ThreeJsSystem;d=b.objectsUsedInFrameCounts;b=0;for(f=[];b<e.scene.children.length;){g=e.scene.children[b];if(d[g.primitiveType+g.detailLevel]>0){g.visible=true;d[g.primitiveType+g.detailLevel]=d[g.primitiveType+g.detailLevel]-1}else g.visible=false;f.push(b=b+1)}return f};return{render:function(c){var e,d,g,f;e=a.ThreeJsSystem;f=e.renderer;d=e.blendedThreeJsSceneCanvasContext;g=e.previousFrameThreeJSSceneRenderForBlendingCanvasContext;
b(c);if(e.isWebGLUsed)return e.composer.render();f.render(e.scene,e.camera);d.globalAlpha=1;d.clearRect(0,0,window.innerWidth,window.innerHeight);d.globalAlpha=a.BlendControls.blendAmount;d.drawImage(e.previousFrameThreeJSSceneRenderForBlendingCanvas,0,0);d.globalAlpha=1;d.drawImage(e.currentFrameThreeJsSceneCanvas,0,0);g.globalCompositeOperation="copy";g.drawImage(e.blendedThreeJsSceneCanvas,0,0);return e.currentFrameThreeJsSceneCanvasContext.clearRect(0,0,window.innerWidth,window.innerHeight)}}};
var createColours;
createColours=function(){var a,b,c;c=["aliceblue","0xfff0f8ff","antiquewhite","0xfffaebd7","aqua","0xff00ffff","aquamarine","0xff7fffd4","azure","0xfff0ffff","beige","0xfff5f5dc","bisque","0xffffe4c4","black","0xff000000","blanchedalmond","0xffffebcd","blue","0xff0000ff","blueviolet","0xff8a2be2","brown","0xffa52a2a","burlywood","0xffdeb887","cadetblue","0xff5f9ea0","chartreuse","0xff7fff00","chocolate","0xffd2691e","coral","0xffff7f50","cornflowerblue","0xff6495ed","cornsilk","0xfffff8dc","crimson",
"0xffdc143c","cyan","0xff00ffff","darkblue","0xff00008b","darkcyan","0xff008b8b","darkgoldenrod","0xffb8860b","darkgray","0xffa9a9a9","darkgrey","0xffa9a9a9","darkgreen","0xff006400","darkkhaki","0xffbdb76b","darkmagenta","0xff8b008b","darkolivegreen","0xff556b2f","darkorange","0xffff8c00","darkorchid","0xff9932cc","darkred","0xff8b0000","darksalmon","0xffe9967a","darkseagreen","0xff8fbc8f","darkslateblue","0xff483d8b","darkslategray","0xff2f4f4f","darkslategrey","0xff2f4f4f","darkturquoise","0xff00ced1",
"darkviolet","0xff9400d3","deeppink","0xffff1493","deepskyblue","0xff00bfff","dimgray","0xff696969","dimgrey","0xff696969","dodgerblue","0xff1e90ff","firebrick","0xffb22222","floralwhite","0xfffffaf0","forestgreen","0xff228b22","fuchsia","0xffff00ff","gainsboro","0xffdcdcdc","ghostwhite","0xfff8f8ff","gold","0xffffd700","goldenrod","0xffdaa520","gray","0xff808080","grey","0xff808080","green","0xff008000","greenyellow","0xffadff2f","honeydew","0xfff0fff0","hotpink","0xffff69b4","indianred","0xffcd5c5c",
"indigo","0xff4b0082","ivory","0xfffffff0","khaki","0xfff0e68c","lavender","0xffe6e6fa","lavenderblush","0xfffff0f5","lawngreen","0xff7cfc00","lemonchiffon","0xfffffacd","lightblue","0xffadd8e6","lightcoral","0xfff08080","lightcyan","0xffe0ffff","lightgoldenrodyellow","0xfffafad2","lightgrey","0xffd3d3d3","lightgray","0xffd3d3d3","lightgreen","0xff90ee90","lightpink","0xffffb6c1","lightsalmon","0xffffa07a","lightseagreen","0xff20b2aa","lightskyblue","0xff87cefa","lightslategray","0xff778899","lightslategrey",
"0xff778899","lightsteelblue","0xffb0c4de","lightyellow","0xffffffe0","lime","0xff00ff00","limegreen","0xff32cd32","linen","0xfffaf0e6","magenta","0xffff00ff","maroon","0xff800000","mediumaquamarine","0xff66cdaa","mediumblue","0xff0000cd","mediumorchid","0xffba55d3","mediumpurple","0xff9370d8","mediumseagreen","0xff3cb371","mediumslateblue","0xff7b68ee","mediumspringgreen","0xff00fa9a","mediumturquoise","0xff48d1cc","mediumvioletred","0xffc71585","midnightblue","0xff191970","mintcream","0xfff5fffa",
"mistyrose","0xffffe4e1","moccasin","0xffffe4b5","navajowhite","0xffffdead","navy","0xff000080","oldlace","0xfffdf5e6","olive","0xff808000","olivedrab","0xff6b8e23","orange","0xffffa500","orangered","0xffff4500","orchid","0xffda70d6","palegoldenrod","0xffeee8aa","palegreen","0xff98fb98","paleturquoise","0xffafeeee","palevioletred","0xffd87093","papayawhip","0xffffefd5","peachpuff","0xffffdab9","peru","0xffcd853f","pink","0xffffc0cb","plum","0xffdda0dd","powderblue","0xffb0e0e6","purple","0xff800080",
"red","0xffff0000","rosybrown","0xffbc8f8f","royalblue","0xff4169e1","saddlebrown","0xff8b4513","salmon","0xfffa8072","sandybrown","0xfff4a460","seagreen","0xff2e8b57","seashell","0xfffff5ee","sienna","0xffa0522d","silver","0xffc0c0c0","skyblue","0xff87ceeb","slateblue","0xff6a5acd","slategray","0xff708090","slategrey","0xff708090","snow","0xfffffafa","springgreen","0xff00ff7f","steelblue","0xff4682b4","tan","0xffd2b48c","teal","0xff008080","thistle","0xffd8bfd8","tomato","0xffff6347","turquoise",
"0xff40e0d0","violet","0xffee82ee","wheat","0xfff5deb3","white","0xffffffff","whitesmoke","0xfff5f5f5","yellow","0xffffff00","yellowgreen","0xff9acd32","angleColor","-16777217"];b=[];for(a=0;a<c.length;){window[c[a]]=parseInt(c[a+1],16);b.push(c[a]);a=a+2}return b};
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";
a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";if(!this.webgl)a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.';
return a},addGetWebGLMessage:function(a){var b,c,a=a||{};b=a.parent!==void 0?a.parent:document.body;a=a.id!==void 0?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}},badgeHeight=16,Stats=function(){var a,b,c=1,e=0,d=Date.now(),g=d,f=d,h=0,i=1E3,j=0,n,x,l,p=[[0,0,0],[255,255,255]],u=0,k=1E3,w=0,q,m,y,z=[[0,0,0],[255,255,255]];a=document.createElement("div");a.setAttribute("id","statsWidget");a.style.display="none";a.style.cursor="pointer";a.style.cursor="pointer";a.style.width=
"74px";a.style.zIndex="6";a.addEventListener("mousedown",function(a){a.preventDefault();c=(c+1)%2;if(c==0){n.style.display="block";q.style.display="none"}else{n.style.display="none";q.style.display="block"}},false);n=document.createElement("div");n.style.textAlign="right";n.style.lineHeight="1.2em";n.style.backgroundColor="rgb(0,0,0)";n.style.padding="0 0 0px 0px";n.style.display="none";a.appendChild(n);x=document.createElement("div");x.style.fontFamily="Helvetica, Arial, sans-serif";x.style.fontSize=
"9px";x.style.color="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";x.style.fontWeight="bold";x.innerHTML="FPS";n.appendChild(x);l=document.createElement("div");l.style.position="relative";l.style.width="74px";l.style.height=badgeHeight+"px";l.style.backgroundColor="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";for(n.appendChild(l);l.children.length<74;){b=document.createElement("span");b.style.width="1px";b.style.height=badgeHeight+"px";b.style.cssFloat="left";b.style.backgroundColor="rgb("+p[0][0]+","+p[0][1]+
","+p[0][2]+")";l.appendChild(b)}q=document.createElement("div");q.style.textAlign="right";q.style.lineHeight="1.2em";q.style.backgroundColor="rgb(0,0,0)";q.style.padding="0 0 0px 0px";q.style.display="block";a.appendChild(q);m=document.createElement("div");m.style.fontFamily="Helvetica, Arial, sans-serif";m.style.fontSize="9px";m.style.color="rgb("+z[1][0]+","+z[1][1]+","+z[1][2]+")";m.style.fontWeight="bold";m.innerHTML="MS";q.appendChild(m);y=document.createElement("div");y.style.position="relative";
y.style.width="74px";y.style.height=badgeHeight+"px";y.style.backgroundColor="rgb("+z[1][0]+","+z[1][1]+","+z[1][2]+")";for(q.appendChild(y);y.children.length<74;){b=document.createElement("span");b.style.width="1px";b.style.height=Math.random()*badgeHeight+"px";b.style.cssFloat="left";b.style.backgroundColor="rgb("+z[0][0]+","+z[0][1]+","+z[0][2]+")";y.appendChild(b)}return{getDomElement:function(){return a},getFps:function(){return h},getFpsMin:function(){return i},getFpsMax:function(){return j},
getMs:function(){return u},getMsMin:function(){return k},getMsMax:function(){return w},update:function(){d=Date.now();u=d-g;k=Math.min(k,u);w=Math.max(w,u);m.textContent=u+" MS ";var a=Math.min(badgeHeight,badgeHeight-u/200*badgeHeight);y.appendChild(y.firstChild).style.height=a+"px";g=d;e++;if(d>f+1E3){h=Math.round(e*1E3/(d-f));i=Math.min(i,h);j=Math.max(j,h);x.textContent=h+" FPS ("+i+"-"+j+")";a=Math.min(badgeHeight,badgeHeight-h/100*badgeHeight);l.appendChild(l.firstChild).style.height=a+"px";
f=d;e=0}}}},THREEx=THREEx||{};THREEx.WindowResize=function(a,b){var c=function(){a.setSize(window.innerWidth,window.innerHeight);b.aspect=window.innerWidth/window.innerHeight;b.updateProjectionMatrix()};window.addEventListener("resize",c,false);return{stop:function(){window.removeEventListener("resize",c)}}};THREEx.WindowResize.bind=function(a,b){return THREEx.WindowResize(a,b)};
THREE.ShaderExtras={screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},convolution:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},
uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"uniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvUv = uv - ( ( KERNEL_SIZE - 1.0 ) / 2.0 ) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cKernel[ KERNEL_SIZE ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i = 0; i < KERNEL_SIZE; i ++ ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
bokeh:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:0.025},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"},
dofmipmap:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float focus;\nuniform float maxblur;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\nvoid main() {\nvec4 depth = texture2D( tDepth, vUv );\nfloat factor = depth.x - focus;\nvec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );\ngl_FragColor = col;\ngl_FragColor.a = 1.0;\n}"},
sepia:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},amount:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"},
dotscreen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(0.5,0.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"},
vignette:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"},
bleachbypass:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"},
focus:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:0.94},waveFactor:{type:"f",value:0.00125}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float sampleDistance;\nuniform float waveFactor;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( tDiffuse, uv );\nvin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );\nsample_dist = dot( vin, vin ) * 2.0;\nf = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\ncolor = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );\ncolor = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );\ngl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );\n}"},
triangleBlur:{uniforms:{texture:{type:"t",value:0,texture:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define ITERATIONS 10.0\nuniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 vUv;\nfloat random( vec3 scale, float seed ) {\nreturn fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );\n}\nvoid main() {\nvec4 color = vec4( 0.0 );\nfloat total = 0.0;\nfloat offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );\nfor ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {\nfloat percent = ( t + offset - 0.5 ) / ITERATIONS;\nfloat weight = 1.0 - abs( percent );\ncolor += texture2D( texture, vUv + delta * percent ) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}"},
basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"},horizontalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \tvUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t  ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\ngl_FragColor = sum;\n}"},
horizontalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \t vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat vv = v * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t   ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;\ngl_FragColor = sum;\n}"},
blend:{uniforms:{tDiffuse1:{type:"t",value:0,texture:null},tDiffuse2:{type:"t",value:1,texture:null},mixRatio:{type:"f",value:0.5},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform float mixRatio;\nuniform sampler2D tDiffuse1;\nuniform sampler2D tDiffuse2;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel1 = texture2D( tDiffuse1, vUv );\nvec4 texel2 = texture2D( tDiffuse2, vUv );\nvec3 ca = vec3(texel1.x,texel1.y,texel1.z);\nvec3 cb = vec3(texel2.x,texel2.y,texel2.z);\nfloat alphaa = texel1.w ;\nfloat alphab = texel2.w*mixRatio;\nfloat alphao = (alphaa + alphab * (1.0-alphaa));\nvec3 co = (1.0/alphao) * (ca * alphaa + cb*alphab*(1.0-alphaa));\nvec4 mixxx = vec4(co, alphao );\ngl_FragColor =  mixxx;\n}"},
fxaa:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nfloat opacity  = rgbaM.w;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec3 rgbA = 0.5 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );\nfloat lumaB = dot( rgbB, luma );\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\ngl_FragColor = vec4( rgbA, opacity );\n} else {\ngl_FragColor = vec4( rgbB, opacity );\n}\n}"},
luminosity:{uniforms:{tDiffuse:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"},colorCorrection:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},powRGB:{type:"v3",value:new THREE.Vector3(2,2,2)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 powRGB;\nuniform vec3 mulRGB;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );\n}"},
normalmap:{uniforms:{heightMap:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(512,512)},scale:{type:"v2",value:new THREE.Vector2(1,1)},height:{type:"f",value:0.05}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"},
ssao:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},aoClamp:{type:"f",value:0.3}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform vec2 size;\nuniform float aoClamp;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 8;\nconst float radius = 5.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0002;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst bool onlyAO = false;\nconst float lumInfluence = 0.3;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"},
colorify:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"},
unpackDepthRGBA:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvoid main() {\nfloat depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );\ngl_FragColor = opacity * vec4( vec3( depth ), 1.0 );\n}"},
buildKernel:function(a){var b,c,e,d,g=2*Math.ceil(a*3)+1;g>25&&(g=25);d=(g-1)*0.5;c=Array(g);for(b=e=0;b<g;++b){c[b]=Math.exp(-((b-d)*(b-d))/(2*a*a));e=e+c[b]}for(b=0;b<g;++b)c[b]=c[b]/e;return c}};
THREE.EffectComposer=function(a,b){this.renderer=a;this.renderTarget1=b;if(this.renderTarget1===void 0){var c=window.innerWidth||1,e=window.innerHeight||1;this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};this.renderTarget1=new THREE.WebGLRenderTarget(c,e,this.renderTargetParameters)}this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=
new THREE.ShaderPass(THREE.ShaderExtras.screen)};
THREE.EffectComposer.prototype={swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=a},addPass:function(a){this.passes.push(a)},render:function(a){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var b=false,c,e,d=this.passes.length;for(e=0;e<d;e++){c=this.passes[e];if(c.enabled){c.render(this.renderer,this.writeBuffer,this.readBuffer,a,b);if(c.needsSwap){if(b){var g=this.renderer.context;g.stencilFunc(g.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,
this.writeBuffer,this.readBuffer,a);g.stencilFunc(g.EQUAL,1,4294967295)}this.swapBuffers()}c instanceof THREE.MaskPass?b=true:c instanceof THREE.ClearMaskPass&&(b=false)}}},reset:function(a){this.renderTarget1=a;if(this.renderTarget1===void 0)this.renderTarget1=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters);this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2}};
THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null);THREE.EffectComposer.scene=new THREE.Scene;THREE.EffectComposer.scene.add(THREE.EffectComposer.quad);THREE.RenderPass=function(a,b,c,e,d){this.scene=a;this.camera=b;this.overrideMaterial=c;this.clearColor=e;this.clearAlpha=d!==void 0?d:1;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.clear=this.enabled=true;this.needsSwap=false};
THREE.RenderPass.prototype={render:function(a,b,c){this.scene.overrideMaterial=this.overrideMaterial;if(this.clearColor){this.oldClearColor.copy(a.getClearColor());this.oldClearAlpha=a.getClearAlpha();a.setClearColor(this.clearColor,this.clearAlpha)}a.render(this.scene,this.camera,c,this.clear);this.clearColor&&a.setClearColor(this.oldClearColor,this.oldClearAlpha);this.scene.overrideMaterial=null}};
THREE.ShaderPass=function(a,b){this.textureID=b!==void 0?b:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader});this.renderToScreen=false;this.needsSwap=this.enabled=true;this.clear=false};
THREE.ShaderPass.prototype={render:function(a,b,c){if(this.uniforms[this.textureID])this.uniforms[this.textureID].value=c;THREE.EffectComposer.quad.material=this.material;this.renderToScreen?a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,b,this.clear)}};THREE.MaskPass=function(a,b){this.scene=a;this.camera=b;this.clear=this.enabled=true;this.inverse=this.needsSwap=false};
THREE.MaskPass.prototype={render:function(a,b,c){var e=a.context;e.colorMask(false,false,false,false);e.depthMask(false);var d,g;if(this.inverse){d=0;g=1}else{d=1;g=0}e.enable(e.STENCIL_TEST);e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE);e.stencilFunc(e.ALWAYS,d,4294967295);e.clearStencil(g);a.render(this.scene,this.camera,c,this.clear);a.render(this.scene,this.camera,b,this.clear);e.colorMask(true,true,true,true);e.depthMask(true);e.stencilFunc(e.EQUAL,1,4294967295);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};
THREE.ClearMaskPass=function(){this.enabled=true};THREE.ClearMaskPass.prototype={render:function(a){a=a.context;a.disable(a.STENCIL_TEST)}};
THREE.SavePass=function(a){var b=THREE.ShaderExtras.screen;this.textureID="tDiffuse";this.uniforms=THREE.UniformsUtils.clone(b.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader});this.renderTarget=a;if(this.renderTarget===void 0){this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};this.renderTarget=new THREE.WebGLRenderTarget(window.innerWidth,
window.innerHeight,this.renderTargetParameters)}this.enabled=true;this.clear=this.needsSwap=false};THREE.SavePass.prototype={render:function(a,b,c){if(this.uniforms[this.textureID])this.uniforms[this.textureID].value=c;THREE.EffectComposer.quad.material=this.material;a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTarget,this.clear)}};Number.prototype.times=function(a,b){var c,e,d;e=this.valueOf();c=0;for(d=[];c<e;){a.call(b||window,c);d.push(c++)}return d};
window.back=function(){};window.forward=function(){};window.close=function(){};var createBackgroundPainter;
createBackgroundPainter=function(a,b,c){var e,d,g,f,h,i,j,n;i=[];g=orange;f=red;h=black;n=void 0;d="";j=0;e={};b||(b=document.createElement("canvas"));e.canvasForBackground=b;a=1/15;b.width=Math.floor(window.innerWidth*a);b.height=Math.floor(window.innerHeight*a);e.backgroundSceneContext=b.getContext("2d");e.simpleGradient=function(a,b,f,e){d=d+" "+a+""+b+""+f+""+e+"null ";return i.push({gradStacka:c.ColourFunctions.color(a),gradStackb:c.ColourFunctions.color(b),gradStackc:c.ColourFunctions.color(f),
gradStackd:c.ColourFunctions.color(e),solid:null})};e.background=function(a,b,f,e){a=c.ColourFunctions.color(a,b,f,e);d=d+" null null null null "+a+" ";return i.push({gradStacka:void 0,gradStackb:void 0,gradStackc:void 0,gradStackd:void 0,solid:a})};e.paintARandomBackground=function(){n=n===void 0?Math.floor(Math.random()*5):(n+1)%5;switch(n){case 0:g=orange;f=red;h=black;$("#fakeStartingBlinkingCursor").css("color","white");break;case 1:g=white;f=khaki;h=peachpuff;$("#fakeStartingBlinkingCursor").css("color",
"LightPink");break;case 2:g=lightsteelblue;f=lightcyan;h=paleturquoise;$("#fakeStartingBlinkingCursor").css("color","CadetBlue");break;case 3:g=silver;f=lightgrey;h=gainsboro;$("#fakeStartingBlinkingCursor").css("color","white");break;case 4:g=c.ColourFunctions.color(155,255,155);f=c.ColourFunctions.color(155,255,155);h=c.ColourFunctions.color(155,255,155);$("#fakeStartingBlinkingCursor").css("color","DarkOliveGreen")}e.resetGradientStack();return e.simpleGradientUpdateIfChanged()};e.resetGradientStack=
function(){d="";i=[];return e.simpleGradient(g,f,h)};e.simpleGradientUpdateIfChanged=function(){var a,f,g,n;b=e.canvasForBackground;a=c.ColourFunctions.color;if(d!==j){j=d;Math.sqrt(Math.pow(b.width/2,2)+Math.pow(b.height/2,2));g=0;for(n=[];g<i.length;){if(i[g].gradStacka!==void 0){f=e.backgroundSceneContext.createLinearGradient(b.width/2,0,b.width/2,b.height);f.addColorStop(0,a.toString(i[g].gradStacka));f.addColorStop(0.5,a.toString(i[g].gradStackb));f.addColorStop(1,a.toString(i[g].gradStackc));
e.backgroundSceneContext.globalAlpha=1;e.backgroundSceneContext.fillStyle=f}else{e.backgroundSceneContext.globalAlpha=1;e.backgroundSceneContext.fillStyle=a.toString(i[g].solid)}e.backgroundSceneContext.fillRect(0,0,b.width,b.height);n.push(g++)}return n}};window.simpleGradient=e.simpleGradient;window.background=e.background;return e};
var createEditor=function(a,b){var c;c=b.fromTextArea(document.getElementById("code"),{mode:"livecodelab",theme:"night",lineNumbers:false,indentWithTabs:true,tabSize:1,indentUnit:1,lineWrapping:true,onBlur:function(){setTimeout(c.focus,30)},onChange:function(b){a.trigger("code_changed",b.getValue())},onCursorActivity:function(b){var c,g;c=b.getCursor(true);if(c.ch>2){c=b.getLine(c.line);if(c.indexOf("// next-tutorial:")===0){c=c.substring(17);c=c.replace("_","");g=c+"Tutorial";setTimeout(function(){a.trigger("load-program",
g)},200)}}b.getValue()!==""&&a.trigger("editor-undim")}});a.bind("reset",function(){c.setValue("")});a.bind("code-updated-by-livecodelab",function(a){var b=c.getCursor();b.ch=b.ch+1;c.setValue(a);c.setCursor(b)});return c},createColourFunctions;
createColourFunctions=function(){var a,b,c,e,d,g,f,h,i,j;a={};b=void 0;h=f=g=255;j=c=e=d=i=void 0;a.colorModeA=255;b={RGB:1,ARGB:2,HSB:3,ALPHA:4,CMYK:5,REPLACE:0,BLEND:1,ADD:2,SUBTRACT:4,LIGHTEST:8,DARKEST:16,DIFFERENCE:32,EXCLUSION:64,MULTIPLY:128,SCREEN:256,OVERLAY:512,HARD_LIGHT:1024,SOFT_LIGHT:2048,DODGE:4096,BURN:8192,ALPHA_MASK:4278190080,RED_MASK:16711680,GREEN_MASK:65280,BLUE_MASK:255};i=b.RGB;d=function(c,d,e,p){if(i===b.HSB){e=a.color.toRGB(c,d,e);c=e[0];d=e[1];e=e[2]}else{c=Math.round(255*
(c/g));d=Math.round(255*(d/f));e=Math.round(255*(e/h))}p=Math.round(255*(p/a.colorModeA));c=c<0?0:c;d=d<0?0:d;e=e<0?0:e;p=p<0?0:p;return(p>255?255:p)<<24&b.ALPHA_MASK|(c>255?255:c)<<16&b.RED_MASK|(d>255?255:d)<<8&b.GREEN_MASK|(e>255?255:e)&b.BLUE_MASK};e=function(c,f){var e;if(c===-16777217)return-16777217;if(c&b.ALPHA_MASK){e=Math.round(255*(f/a.colorModeA));e=e>255?255:e;return c-(c&b.ALPHA_MASK)+((e<0?0:e)<<24&b.ALPHA_MASK)}if(i===b.RGB)return d(c,c,c,f);if(i===b.HSB)return d(0,0,c/g*h,f)};c=function(c){if(c<=
g&&c>=0){if(i===b.RGB)return d(c,c,c,a.colorModeA);if(i===b.HSB)return d(0,0,c/g*h,a.colorModeA)}if(c){c>2147483647&&(c=c-4294967296);return c}};a.color=function(b,i,l,p){return b!==void 0&&i!==void 0&&l!==void 0&&p!==void 0?d(b,i,l,p):b!==void 0&&i!==void 0&&l!==void 0?d(b,i,l,a.colorModeA):b!==void 0&&i!==void 0?e(b,i):typeof b==="number"?c(b):d(g,f,h,a.colorModeA)};a.color.toString=function(a){return"rgba("+((a&b.RED_MASK)>>>16)+","+((a&b.GREEN_MASK)>>>8)+","+(a&b.BLUE_MASK)+","+((a&b.ALPHA_MASK)>>>
24)/255+")"};a.color.toInt=function(a,c,f,d){return d<<24&b.ALPHA_MASK|a<<16&b.RED_MASK|c<<8&b.GREEN_MASK|f&b.BLUE_MASK};a.color.toArray=function(a){return[(a&b.RED_MASK)>>>16,(a&b.GREEN_MASK)>>>8,a&b.BLUE_MASK,(a&b.ALPHA_MASK)>>>24]};a.color.toGLArray=function(a){return[((a&b.RED_MASK)>>>16)/255,((a&b.GREEN_MASK)>>>8)/255,(a&b.BLUE_MASK)/255,((a&b.ALPHA_MASK)>>>24)/255]};a.color.toRGB=function(a,b,c){var d,e,i,j,a=a>g?g:a,b=b>f?f:b,c=c>h?h:c,a=a/g*360,b=b/f*100,c=c/h*100;d=Math.round(c/100*255);
if(b===0)return[d,d,d];a=a%360;e=a%60;i=Math.round(c*(100-b)/1E4*255);j=Math.round(c*(6E3-b*e)/6E5*255);b=Math.round(c*(6E3-b*(60-e))/6E5*255);switch(Math.floor(a/60)){case 0:return[d,b,i];case 1:return[j,d,i];case 2:return[i,d,b];case 3:return[i,j,d];case 4:return[b,i,d];case 5:return[d,i,j]}};window.color=a.color;window.colorToHSB=a.colorToHSB=function(a){var c,d,e,i;i=((a&b.RED_MASK)>>>16)/255;d=((a&b.GREEN_MASK)>>>8)/255;c=(a&b.BLUE_MASK)/255;a=max(max(i,d),c);e=min(min(i,d),c);if(e===a)return[0,
0,a*h];d=(i===a?(d-c)/(a-e):d===a?2+(c-i)/(a-e):4+(i-d)/(a-e))/6;d<0?d=d+1:d>1&&(d=d-1);return[d*g,(a-e)/a*f,a*h]};window.brightness=a.brightness=function(b){return a.colorToHSB(b)[2]};window.saturation=a.saturation=function(b){return a.colorToHSB(b)[1]};window.hue=a.hue=function(b){return a.colorToHSB(b)[0]};window.redF=a.redF=function(a){return((a&b.RED_MASK)>>>16)/255*g};window.greenF=a.greenF=function(a){return((a&b.GREEN_MASK)>>>8)/255*f};window.blueF=a.blueF=function(a){return(a&b.BLUE_MASK)/
255*h};window.alpha=a.alpha=function(c){return((c&b.ALPHA_MASK)>>>24)/255*a.colorModeA};window.alphaZeroToOne=a.alphaZeroToOne=function(a){return((a&b.ALPHA_MASK)>>>24)/255};window.lerp=a.lerp=function(a,b,c){return(b-a)*c+a};window.lerpColor=a.lerpColor=function(c,f,d){var e,g,h,j,q,m,c=a.color(c),f=a.color(f);if(i===b.HSB){e=a.colorToHSB(c);c=((c&b.ALPHA_MASK)>>>24)/a.colorModeA;h=a.colorToHSB(f);f=((f&b.ALPHA_MASK)>>>24)/a.colorModeA;g=a.lerp(e[0],h[0],d);j=a.lerp(e[1],h[1],d);e=a.lerp(e[2],h[2],
d);e=a.color.toRGB(g,j,e);d=a.lerp(c,f,d)*a.colorModeA;return d<<24&b.ALPHA_MASK|e[0]<<16&b.RED_MASK|e[1]<<8&b.GREEN_MASK|e[2]&b.BLUE_MASK}q=(c&b.RED_MASK)>>>16;h=(c&b.GREEN_MASK)>>>8;e=c&b.BLUE_MASK;c=((c&b.ALPHA_MASK)>>>24)/a.colorModeA;m=(f&b.RED_MASK)>>>16;j=(f&b.GREEN_MASK)>>>8;g=f&b.BLUE_MASK;f=((f&b.ALPHA_MASK)>>>24)/a.colorModeA;q=a.lerp(q,m,d)|0;h=a.lerp(h,j,d)|0;e=a.lerp(e,g,d)|0;d=a.lerp(c,f,d)*a.colorModeA;return d<<24&b.ALPHA_MASK|q<<16&b.RED_MASK|h<<8&b.GREEN_MASK|e&b.BLUE_MASK};window.colorMode=
a.colorMode=function(b,c,d,e,j){i=b;if(arguments_.length>1){g=c;f=d||c;h=e||c;return a.colorModeA=j||c}};window.blendColor=a.blendColor=function(a,c,f){if(f===b.REPLACE)return j.replace(a,c);if(f===b.BLEND)return j.blend(a,c);if(f===b.ADD)return j.add(a,c);if(f===b.SUBTRACT)return j.subtract(a,c);if(f===b.LIGHTEST)return j.lightest(a,c);if(f===b.DARKEST)return j.darkest(a,c);if(f===b.DIFFERENCE)return j.difference(a,c);if(f===b.EXCLUSION)return j.exclusion(a,c);if(f===b.MULTIPLY)return j.multiply(a,
c);if(f===b.SCREEN)return j.screen(a,c);if(f===b.HARD_LIGHT)return j.hard_light(a,c);if(f===b.SOFT_LIGHT)return j.soft_light(a,c);if(f===b.OVERLAY)return j.overlay(a,c);if(f===b.DODGE)return j.dodge(a,c);if(f===b.BURN)return j.burn(a,c)};j=function(){var a,c,f,d,e,g,i;a=b.ALPHA_MASK;d=b.RED_MASK;f=b.GREEN_MASK;c=b.BLUE_MASK;i=Math.min;g=Math.max;e=void 0;e=function(a,c,b,f,d,e,g,h,j,n,l){a=i(((a&4278190080)>>>24)+c,255)<<24;b=b+((j-b)*c>>8);f=f+((n-f)*c>>8);c=d+((l-d)*c>>8);return a|(b<0?0:b>255?
255:b)<<16|(f<0?0:f>255?255:f)<<8|(c<0?0:c>255?255:c)};return{replace:function(a,c){return c},blend:function(b,e){var g,h,j,v,r,t,s;s=(e&a)>>>24;j=b&d;h=b&f;g=b&c;t=e&d;r=e&f;v=e&c;return i(((b&a)>>>24)+s,255)<<24|j+((t-j)*s>>8)&d|h+((r-h)*s>>8)&f|g+((v-g)*s>>8)&c},add:function(b,e){var g;g=(e&a)>>>24;return i(((b&a)>>>24)+g,255)<<24|i((b&d)+((e&d)>>8)*g,d)&d|i((b&f)+((e&f)>>8)*g,f)&f|i((b&c)+((e&c)*g>>8),c)},subtract:function(b,e){var h;h=(e&a)>>>24;return i(((b&a)>>>24)+h,255)<<24|g((b&d)-((e&d)>>
8)*h,f)&d|g((b&f)-((e&f)>>8)*h,c)&f|g((b&c)-((e&c)*h>>8),0)},lightest:function(b,e){var h;h=(e&a)>>>24;return i(((b&a)>>>24)+h,255)<<24|g(b&d,((e&d)>>8)*h)&d|g(b&f,((e&f)>>8)*h)&f|g(b&c,(e&c)*h>>8)},darkest:function(b,e){var g,h,j,v,r,t,s;s=(e&a)>>>24;j=b&d;h=b&f;g=b&c;t=i(b&d,((e&d)>>8)*s);r=i(b&f,((e&f)>>8)*s);v=i(b&c,(e&c)*s>>8);return i(((b&a)>>>24)+s,255)<<24|j+((t-j)*s>>8)&d|h+((r-h)*s>>8)&f|g+((v-g)*s>>8)&c},difference:function(b,g){var i,h,j,v,r,t,s;s=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&
c;t=(g&d)>>16;r=(g&f)>>8;v=g&c;return e(b,s,j,h,i,t,r,v,j>t?j-t:t-j,h>r?h-r:r-h,i>v?i-v:v-i)},exclusion:function(b,g){var i,h,j,v,r,t,s;s=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>8;v=g&c;return e(b,s,j,h,i,t,r,v,j+t-(j*t>>7),h+r-(h*r>>7),i+v-(i*v>>7))},multiply:function(b,g){var i,h,j,v,r,t,s;s=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>8;v=g&c;return e(b,s,j,h,i,t,r,v,j*t>>8,h*r>>8,i*v>>8)},screen:function(b,g){var i,h,j,v,r,t,s;s=(g&a)>>>24;j=(b&d)>>16;h=(b&
f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>8;v=g&c;return e(b,s,j,h,i,t,r,v,255-((255-j)*(255-t)>>8),255-((255-h)*(255-r)>>8),255-((255-i)*(255-v)>>8))},hard_light:function(b,g){var i,h,j,v,r,t,s;s=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>8;v=g&c;return e(b,s,j,h,i,t,r,v,t<128?j*t>>7:255-((255-j)*(255-t)>>7),r<128?h*r>>7:255-((255-h)*(255-r)>>7),v<128?i*v>>7:255-((255-i)*(255-v)>>7))},soft_light:function(b,g){var i,h,j,v,r,t,s;s=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>
8;v=g&c;return e(b,s,j,h,i,t,r,v,(j*t>>7)+(j*j>>8)-(j*j*t>>15),(h*r>>7)+(h*h>>8)-(h*h*r>>15),(i*v>>7)+(i*i>>8)-(i*i*v>>15))},overlay:function(b,g){var i,h,j,v,r,t,s;s=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>8;v=g&c;return e(b,s,j,h,i,t,r,v,j<128?j*t>>7:255-((255-j)*(255-t)>>7),h<128?h*r>>7:255-((255-h)*(255-r)>>7),i<128?i*v>>7:255-((255-i)*(255-v)>>7))},dodge:function(b,g){var i,h,j,v,r,t,s,k,w,o;o=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>8;v=g&c;w=255;if(t!==
255){w=(j<<8)/(255-t);w=w<0?0:w>255?255:w}k=255;if(r!==255){k=(h<<8)/(255-r);k=k<0?0:k>255?255:k}s=255;if(v!==255){s=(i<<8)/(255-v);s=s<0?0:s>255?255:s}return e(b,o,j,h,i,t,r,v,w,k,s)},burn:function(b,g){var i,h,j,k,r,t,s,w,A,o;o=(g&a)>>>24;j=(b&d)>>16;h=(b&f)>>8;i=b&c;t=(g&d)>>16;r=(g&f)>>8;k=g&c;A=0;if(t!==0){A=(255-j<<8)/t;A=255-(A<0?0:A>255?255:A)}w=0;if(r!==0){w=(255-h<<8)/r;w=255-(w<0?0:w>255?255:w)}s=0;if(k!==0){s=(255-i<<8)/k;s=255-(s<0?0:s>255?255:s)}return e(b,o,j,h,i,t,r,k,A,w,s)}}}();
return a};var createMatrixCommands;
createMatrixCommands=function(a,b){var c,e,d;c={};e=[];d=new a.Matrix4;c.getWorldMatrix=function(){return d};c.resetMatrixStack=function(){e=[];return d.identity()};window.pushMatrix=c.pushMatrix=function(){e.push(d);return d=(new a.Matrix4).copy(d)};window.popMatrix=c.popMatrix=function(){return e.length!==0?d=e.pop():d.identity()};window.resetMatrix=c.resetMatrix=function(){return d.identity()};window.move=c.move=function(c,f,e){e==null&&(e=0);if(typeof c!=="number"){c=Math.sin(b.TimeKeeper.getTime()/
500);f=Math.cos(b.TimeKeeper.getTime()/500);e=c}else if(typeof f!=="number")e=f=c;return d.translate(new a.Vector3(c,f,e))};window.rotate=c.rotate=function(a,c,e){e==null&&(e=0);if(typeof a!=="number")e=c=a=b.TimeKeeper.getTime()/1E3;else if(typeof c!=="number")e=c=a;return d.rotateX(a).rotateY(c).rotateZ(e)};window.scale=c.scale=function(c,f,e){e==null&&(e=1);if(typeof c!=="number")e=f=c=1+Math.sin(b.TimeKeeper.getTime()/500)/4;else if(typeof f!=="number")e=f=c;c>-1.0E-9&&c<1.0E-9&&(c=1.0E-9);f>
-1.0E-9&&f<1.0E-9&&(f=1.0E-9);e>-1.0E-9&&e<1.0E-9&&(e=1.0E-9);return d.scale(new a.Vector3(c,f,e))};return c};var createGraphicsCommands;
createGraphicsCommands=function(a,b){var c,e,d,g,f,h,i,j,n,x,l,p,u,k,w,q;c={};q={};p=u=void 0;n=j=true;l=i=h=void 0;x=[];f=g=e=d=void 0;k=[];c.objectPools=k;c.ballDetLevel=8;c.currentStrokeSize=1;c.minimumBallDetail=u=2;c.maximumBallDetail=p=30;q.ambientLight=0;q.line=1;q.rect=2;q.box=3;q.peg=4;q.ball=5;c.primitiveTypes=q;k[q.line]=[];k[q.rect]=[];k[q.box]=[];k[q.peg]=[];for(l=0;l<p-u+1;){k[q.ball+l]=[];l=l+1}x[q.line]=new a.Geometry;x[q.line].vertices.push(new a.Vector3(0,-0.5,0));x[q.line].vertices.push(new a.Vector3(0,
0.5,0));x[q.rect]=new a.PlaneGeometry(1,1);x[q.box]=new a.CubeGeometry(1,1,1);x[q.peg]=new a.CylinderGeometry(0.5,0.5,1,32);for(l=0;l<p-u+1;){x[q.ball+l]=new a.SphereGeometry(1,u+l,u+l);l=l+1}w=[];c.objectsUsedInFrameCounts=w;c.doTheSpinThingy=true;c.resetTheSpinThingy=false;c.defaultNormalFill=true;c.defaultNormalStroke=true;d=function(f,d,e,g,h,j,n,l){var p,u,o,B;p=false;B=g.primitiveType+g.detailLevel;u=k[B];o=u[w[B]];if(o===void 0){o={lineMaterial:void 0,basicMaterial:void 0,lambertMaterial:void 0,
normalMaterial:void 0,threejsObject3D:new g.THREEObjectConstructor(x[B]),initialSpinCountdown:30};p=true;u.push(o)}if(g.primitiveType===q.line){if(o.lineMaterial===void 0)o.lineMaterial=new a.LineBasicMaterial;if(i===angleColor||c.defaultNormalStroke){j=o.threejsObject3D.matrix.multiplyVector3(new a.Vector3(0,1,0)).normalize();o.lineMaterial.color.setHex(color((j.x+1)/2*255,(j.y+1)/2*255,(j.z+1)/2*255))}else o.lineMaterial.color.setHex(i);o.lineMaterial.linewidth=c.currentStrokeSize;o.threejsObject3D.material=
o.lineMaterial}else if(p||j===angleColor||l){if(o.normalMaterial===void 0)o.normalMaterial=new a.MeshNormalMaterial;o.threejsObject3D.material=o.normalMaterial}else if(b.LightSystem.lightsAreOn){if(o.lambertMaterial===void 0)o.lambertMaterial=new a.MeshLambertMaterial;o.lambertMaterial.color.setHex(j);o.threejsObject3D.material=o.lambertMaterial}else{if(o.basicMaterial===void 0)o.basicMaterial=new a.MeshBasicMaterial;o.basicMaterial.color.setHex(j);o.threejsObject3D.material=o.basicMaterial}o.threejsObject3D.material.side=
g.sidedness;o.threejsObject3D.material.opacity=n;if(n<1)o.threejsObject3D.material.transparent=true;o.threejsObject3D.material.wireframe=h;o.threejsObject3D.material.wireframeLinewidth=c.currentStrokeSize;o.threejsObject3D.material.reflectivity=1;o.threejsObject3D.material.refractionRatio=0.98;if(c.resetTheSpinThingy){o.initialSpinCountdown=30;c.resetTheSpinThingy=false;c.doTheSpinThingy=true}if(c.doTheSpinThingy)o.initialSpinCountdown=o.initialSpinCountdown-1;if(o.initialSpinCountdown===-1)c.doTheSpinThingy=
false;o.threejsObject3D.primitiveType=g.primitiveType;o.threejsObject3D.detailLevel=g.detailLevel;w[B]=w[B]+1;if(c.doTheSpinThingy&&o.initialSpinCountdown>0){b.MatrixCommands.pushMatrix();b.MatrixCommands.rotate(o.initialSpinCountdown/50)}o.threejsObject3D.matrixAutoUpdate=false;o.threejsObject3D.matrix.copy(b.MatrixCommands.getWorldMatrix());o.threejsObject3D.matrixWorldNeedsUpdate=true;c.doTheSpinThingy&&o.initialSpinCountdown>0&&b.MatrixCommands.popMatrix();if(p)o.threejsObject3D.matrix.scale(new a.Vector3(1.0E-4,
1.0E-4,1.0E-4));else if(f!==1||d!==1||e!==1)h?o.threejsObject3D.matrix.scale(new a.Vector3(f+0.0010,d+0.0010,e+0.0010)):o.threejsObject3D.matrix.scale(new a.Vector3(f,d,e));if(p)return b.ThreeJsSystem.scene.add(o.threejsObject3D)};e=function(a,b,e,l){if(a===void 0)e=b=a=1;else if(b===void 0)e=b=a;else e===void 0&&(e=1);if(n||j&&l.canFill){if(l.canFill&&j&&(c.currentStrokeSize===0||!n||c.currentStrokeSize<=1&&!c.defaultNormalFill&&!c.defaultNormalStroke&&i===f&&g===1&&h===1)||c.currentStrokeSize<=
1&&c.defaultNormalFill&&c.defaultNormalStroke)return d(a,b,e,l,false,f,g,c.defaultNormalFill);if((!j||!l.canFill)&&n)return d(a,b,e,l,true,i,h,c.defaultNormalStroke);d(a,b,e,l,true,i,h,c.defaultNormalStroke);return d(a,b,e,l,false,f,g,c.defaultNormalFill)}};c.reset=function(){var a;c.fill(4294967295);c.stroke(4294967295);c.currentStrokeSize=1;c.defaultNormalFill=true;c.defaultNormalStroke=true;c.ballDetLevel=b.ThreeJsSystem.ballDefaultDetLevel;c.objectsUsedInFrameCounts[c.primitiveTypes.ambientLight]=
0;c.objectsUsedInFrameCounts[c.primitiveTypes.line]=0;c.objectsUsedInFrameCounts[c.primitiveTypes.rect]=0;c.objectsUsedInFrameCounts[c.primitiveTypes.box]=0;c.objectsUsedInFrameCounts[c.primitiveTypes.peg]=0;l=void 0;l=0;for(a=[];l<c.maximumBallDetail-c.minimumBallDetail+1;){c.objectsUsedInFrameCounts[c.primitiveTypes.ball+l]=0;a.push(l=l+1)}return a};window.line=c.line=function(f,d,g){if(b.LightSystem.lightsAreOn){d=j;g=c.currentStrokeSize;if(c.currentStrokeSize<2)c.currentStrokeSize=2;f===void 0&&
(f=1);rect(0,f,0);j=d;c.currentStrokeSize=g}else return e(f,d,g,{canFill:false,primitiveType:q.line,sidedness:a.FrontSide,THREEObjectConstructor:a.Line,detailLevel:0})};window.rect=c.rect=function(b,c,f){return e(b,c,f,{canFill:true,primitiveType:q.rect,sidedness:a.DoubleSide,THREEObjectConstructor:a.Mesh,detailLevel:0})};window.box=c.box=function(b,c,f){return e(b,c,f,{canFill:true,primitiveType:q.box,sidedness:a.FrontSide,THREEObjectConstructor:a.Mesh,detailLevel:0})};window.peg=c.peg=function(b,
c,f){return e(b,c,f,{canFill:true,primitiveType:q.peg,sidedness:a.FrontSide,THREEObjectConstructor:a.Mesh,detailLevel:0})};window.ballDetail=c.ballDetail=function(a){if(a!==void 0){a<2&&(a=2);a>30&&(a=30);return c.ballDetLevel=Math.round(a)}};window.ball=c.ball=function(b,f,d){return e(b,f,d,{canFill:true,primitiveType:q.ball,sidedness:a.FrontSide,THREEObjectConstructor:a.Mesh,detailLevel:c.ballDetLevel-u})};window.fill=c.fill=function(a,d,e,i){j=true;if(a!==angleColor){c.defaultNormalFill=false;
f=color(a,d,e);return g=alphaZeroToOne(color(a,d,e,i))}c.defaultNormalFill=true;f=angleColor;return e===void 0&&d!==void 0?g=d/b.ColourFunctions.colorModeA:g=1};window.noFill=c.noFill=function(){j=false;return c.defaultNormalFill=false};window.stroke=c.stroke=function(a,f,d,e){n=true;if(a!==angleColor){c.defaultNormalStroke=false;i=color(a,f,d);return h=alphaZeroToOne(color(a,f,d,e))}c.defaultNormalStroke=true;i=angleColor;return d===void 0&&f!==void 0?h=f/b.ColourFunctions.colorModeA:h=1};window.noStroke=
c.noStroke=function(){return n=false};window.strokeSize=c.strokeSize=function(a){a===void 0?a=1:a<0&&(a=0);return c.currentStrokeSize=a};return c};var Marsaglia,PerlinNoise,Random,abs,acos,asin,atan,atan2,ceil,constrain,cos,currentRandom,degrees,dist,exp,floor,lerp,log,mag,map,max,min,noise,noiseDetail,noiseProfile,noiseSeed,norm,pow,radians,random,randomSeed,round,sin,sq,sqrt,tan;abs=Math.abs;ceil=Math.ceil;constrain=function(a,b,c){return a>c?c:a<b?b:a};
dist=function(){var a,b,c;if(arguments.length===4){a=arguments[0]-arguments[2];b=arguments[1]-arguments[3];return Math.sqrt(a*a+b*b)}if(arguments.length===6){a=arguments[0]-arguments[3];b=arguments[1]-arguments[4];c=arguments[2]-arguments[5];return Math.sqrt(a*a+b*b+c*c)}};exp=Math.exp;floor=Math.floor;lerp=function(a,b,c){return(b-a)*c+a};log=Math.log;mag=function(a,b,c){return c?Math.sqrt(a*a+b*b+c*c):Math.sqrt(a*a+b*b)};map=function(a,b,c,e,d){return e+(d-e)*((a-b)/(c-b))};
max=function(){var a,b,c;if(arguments.length===2)return arguments[0]<arguments[1]?arguments[1]:arguments[0];c=arguments.length===1?arguments[0]:arguments;if(!("length"in c&&c.length>0))throw"Non-empty array is expected";max=c[0];a=c.length;for(b=1;b<a;){max<c[b]&&(max=c[b]);++b}return max};
min=function(){var a,b,c;if(arguments.length===2)return arguments[0]<arguments[1]?arguments[0]:arguments[1];c=arguments.length===1?arguments[0]:arguments;if(!("length"in c&&c.length>0))throw"Non-empty array is expected";min=c[0];a=c.length;for(b=1;b<a;){min>c[b]&&(min=c[b]);++b}return min};norm=function(a,b,c){return(a-b)/(c-b)};pow=Math.pow;round=Math.round;sq=function(a){return a*a};sqrt=Math.sqrt;acos=Math.acos;asin=Math.asin;atan=Math.atan;atan2=Math.atan2;cos=Math.cos;
degrees=function(a){return a*180/Math.PI};radians=function(a){return a/180*Math.PI};sin=Math.sin;tan=Math.tan;currentRandom=Math.random;random=function(){var a,b;if(arguments.length===0)return currentRandom();if(arguments.length===1)return currentRandom()*arguments[0];b=arguments[0];a=arguments[1];return currentRandom()*(a-b)+b};
Marsaglia=function(a,b){var c,e,d;d=a||362436069;e=b||521288629;c=function(){d=36969*(d&65535)+(d>>>16)&4294967295;e=18E3*(e&65535)+(e>>>16)&4294967295;return((d&65535)<<16|e&65535)&4294967295};this.nextDouble=function(){var a;a=c()/4294967296;return a<0?1+a:a};return this.nextInt=c};Marsaglia.createRandomized=function(){var a;a=new Date;return new Marsaglia(a/6E4&4294967295,a&4294967295)};randomSeed=function(a){return currentRandom=(new Marsaglia(a)).nextDouble};
Random=function(a){var b,c;b=false;random=c=void 0;this.nextGaussian=function(){var a,d,g;if(b){b=false;return c}for(a=g=d=void 0;;){d=2*random()-1;g=2*random()-1;a=d*d+g*g;if(!(a>=1||a===0))break}a=Math.sqrt(-2*Math.log(a)/a);c=g*a;b=true;return d*a};return random=a===void 0?Math.random:(new Marsaglia(a)).nextDouble};
PerlinNoise=function(a){var b,c,e,d,g,f,h;e=function(a,b,c,f){var d,a=a&15;d=a<8?b:c;b=a<4?c:a===12||a===14?b:f;return((a&1)===0?d:-d)+((a&2)===0?b:-b)};c=function(a,b,c){b=(a&1)===0?b:c;return(a&2)===0?-b:b};b=function(a,b){return(a&1)===0?-b:b};lerp=function(a,b,c){return b+a*(c-b)};f=a!==void 0?new Marsaglia(a):Marsaglia.createRandomized();d=a=void 0;g=new Uint8Array(512);for(a=0;a<256;){g[a]=a;++a}for(a=0;a<256;){h=g[d=f.nextInt()&255];g[d]=g[a];g[a]=h;++a}for(a=0;a<256;){g[a+256]=g[a];++a}this.noise3d=
function(a,b,c){var f,d,h,u,k,w,q;f=Math.floor(a)&255;d=Math.floor(b)&255;h=Math.floor(c)&255;a=a-Math.floor(a);b=b-Math.floor(b);c=c-Math.floor(c);u=(3-2*a)*a*a;k=(3-2*b)*b*b;w=g[f]+d;q=g[w]+h;w=g[w+1]+h;d=g[f+1]+d;f=g[d]+h;h=g[d+1]+h;return lerp((3-2*c)*c*c,lerp(k,lerp(u,e(g[q],a,b,c),e(g[f],a-1,b,c)),lerp(u,e(g[w],a,b-1,c),e(g[h],a-1,b-1,c))),lerp(k,lerp(u,e(g[q+1],a,b,c-1),e(g[f+1],a-1,b,c-1)),lerp(u,e(g[w+1],a,b-1,c-1),e(g[h+1],a-1,b-1,c-1))))};this.noise2d=function(a,b){var f,d,e,h;f=Math.floor(a)&
255;d=Math.floor(b)&255;a=a-Math.floor(a);b=b-Math.floor(b);e=(3-2*a)*a*a;h=g[f]+d;f=g[f+1]+d;return lerp((3-2*b)*b*b,lerp(e,c(g[h],a,b),c(g[f],a-1,b)),lerp(e,c(g[h+1],a,b-1),c(g[f+1],a-1,b-1)))};return this.noise1d=function(a){var c;c=Math.floor(a)&255;a=a-Math.floor(a);return lerp((3-2*a)*a*a,b(g[c],a),b(g[c+1],a-1))}};noiseProfile={generator:void 0,octaves:4,fallout:0.5,seed:void 0};
noise=function(a,b,c){var e,d,g,f,h;if(noiseProfile.generator===void 0)noiseProfile.generator=new PerlinNoise(noiseProfile.seed);d=noiseProfile.generator;f=e=1;for(g=h=0;g<noiseProfile.octaves;){e=e*noiseProfile.fallout;switch(arguments.length){case 1:h=h+e*(1+d.noise1d(f*a))/2;break;case 2:h=h+e*(1+d.noise2d(f*a,f*b))/2;break;case 3:h=h+e*(1+d.noise3d(f*a,f*b,f*c))/2}f=f*2;++g}return h};noiseDetail=function(a,b){noiseProfile.octaves=a;if(b!==void 0)return noiseProfile.fallout=b};
noiseSeed=function(a){noiseProfile.seed=a;return noiseProfile.generator=void 0};var createDrawFunctionRunner;
createDrawFunctionRunner=function(a,b){var c,e;c={};e=[];c.drawFunction="";c.consecutiveFramesWithoutRunTimeError=0;c.lastStableDrawFunction=null;c.currentCodeString="";window.addDoOnce=c.addDoOnce=function(a){return e.push(a)};c.setDrawFunction=function(a){return c.drawFunction=a};c.resetTrackingOfDoOnceOccurrences=function(){return e=[]};c.putTicksNextToDoOnceBlocksThatHaveBeenRun=function(){var a;a=b.CodeTransformer;if(e.length!==0)return c.setDrawFunction(a.addCheckMarksAndUpdateCodeAndNotifyChange(a,
e))};c.runDrawFunction=function(){c.drawFunction();c.consecutiveFramesWithoutRunTimeError=c.consecutiveFramesWithoutRunTimeError+1;if(c.consecutiveFramesWithoutRunTimeError===5){c.lastStableDrawFunction=c.drawFunction;return a.trigger("livecodelab-running-stably")}};c.reinstateLastWorkingDrawFunction=function(){c.consecutiveFramesWithoutRunTimeError=0;return c.drawFunction=c.lastStableDrawFunction};return c};
var createCodeTransformer=function(a,b,c){var e={},d,g={};createCodeChecker();e.compiler=b;g.removeTickedDoOnce=function(a){a=a.replace(/^(\s)*\u2713[ ]*doOnce[ ]*\-\>[ ]*$/gm,"$1if false");return a=a.replace(/\u2713/g,"//")};g.postfixNotation=function(a){a=a.replace(/(\d+)[ ]+bpm(\s)/g,"bpm $1$2");a=a.replace(/([a-zA-Z]+)[ ]+fill(\s)/g,"fill $1$2");a=a.replace(/([a-zA-Z]+)[ ]+stroke(\s)/g,"stroke $1$2");return a=a.replace(/([a-zA-Z]+)[ ]+background(\s)/g,"background $1$2")};g.fixTimesFunctions=function(a){return a.replace(/(\d+)\s+times[ ]*\->/g,
";( $1 + 0).times ->")};g.addDoOnceTracing=function(a){var b;if(a.indexOf("doOnce")>-1){a=a.split("\n");for(b=0;b<a.length;b=b+1){a[b]=a[b].replace(/^(\s*)doOnce[ ]*\->[ ]*(.+)$/gm,"$1;addDoOnce("+b+"); (1+0).times -> $2");if(a[b].match(/^(\s*)doOnce[ ]*\->[ ]*$/gm)){a[b]=a[b].replace(/^(\s*)doOnce[ ]*\->[ ]*$/gm,"$1(1+0).times ->");a[b+1]=a[b+1].replace(/^(\s*)(.+)$/gm,"$1;addDoOnce("+b+"); $2")}}a=a.join("\n")}return a};e.updateCode=function(b){var h,i,j,n,x,l,p;e.currentCodeString=b;if(e.currentCodeString===
""){c.GraphicsCommands.resetTheSpinThingy=true;a.trigger("clear-error");c.DrawFunctionRunner.consecutiveFramesWithoutRunTimeError=0;b=new Function("");c.DrawFunctionRunner.setDrawFunction(null);c.DrawFunctionRunner.lastStableDrawFunction=null;return b}for(var u=b=g.removeTickedDoOnce(b);u.length;){h=u.charAt(0);i=u.charAt(1);if(h==="'"||h==='"'||h==="/"&&(i==="*"||i==="/")){j=true;break}u=u.slice(1)}if(j){b=b.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g,
function(a,b,c,d,e){if(b)return b;if(c)return c;if(d)return"\n";a=e.split("\n").length-1;b="";for(c=0;c<a;c=c+1)b=b+"\n";return b});u=b.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')/g,"")}else u=b;for(l=x=n=j=i=0;u.length;){h=u.charAt(0);if(h==="'")i=i+1;else if(h==='"')j=j+1;else if(h==="("||h===")")n=n+1;else if(h==="{"||h==="}")x=x+1;else if(h==="["||h==="]")l=l+1;u=u.slice(1)}if(i&1||j&1||n&1||x&1||l&1){i&1&&(p="Missing '");j&1&&(p='Missing "');n&1&&(p="Unbalanced ()");x&1&&(p="Unbalanced {}");
l&1&&(p="Unbalanced []");a.trigger("compile-time-error-thrown",p)}else{b=b.replace(/(\d+)[ ]+bpm(\s)/g,"bpm $1$2");b=b.replace(/([a-zA-Z]+)[ ]+fill(\s)/g,"fill $1$2");b=b.replace(/([a-zA-Z]+)[ ]+stroke(\s)/g,"stroke $1$2");b=b.replace(/([a-zA-Z]+)[ ]+background(\s)/g,"background $1$2");b=b.replace(/(\d+)\s+times[ ]*\->/g,";( $1 + 0).times ->");if(b.indexOf("doOnce")>-1){b=b.split("\n");for(h=0;h<b.length;h=h+1){b[h]=b[h].replace(/^(\s*)doOnce[ ]*\->[ ]*(.+)$/gm,"$1;addDoOnce("+h+"); (1+0).times -> $2");
if(b[h].match(/^(\s*)doOnce[ ]*\->[ ]*$/gm)){b[h]=b[h].replace(/^(\s*)doOnce[ ]*\->[ ]*$/gm,"$1(1+0).times ->");b[h+1]=b[h+1].replace(/^(\s*)(.+)$/gm,"$1;addDoOnce("+h+"); $2")}}b=b.join("\n")}b=b.replace(/^(\s*)([a-z]+[a-zA-Z0-9]*)[ ]*$/gm,"$1;$2()");b=b.replace(/;\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");b=b.replace(/\->\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");if(b.match(/[\s\+\;]+draw\s*\(/))a.trigger("compile-time-error-thrown","You can't call draw()");else{b=b.replace(/;(if)\(\)/g,
";$1");b=b.replace(/;(else)\(\)/g,";$1");b=b.replace(/;(for)\(\)/g,";$1");b=b.replace(/\/\//g,"#");b=b.replace(/([^a-zA-Z0-9])(scale)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(rotate)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(move)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(rect)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(line)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(bpm)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(play)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(pushMatrix)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(popMatrix)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(resetMatrix)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(fill)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noFill)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(stroke)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noStroke)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(strokeSize)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(animationStyle)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(simpleGradient)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(background)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(color)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(lights)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noLights)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ambientLight)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(pointLight)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ball)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ballDetail)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(peg)(\s)+/g,"$1;$2$3");
b=b.replace(/([^a-zA-Z0-9])(abs)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(ceil)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(constrain)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(dist)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(exp)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(floor)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(lerp)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(log)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(mag)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(map)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(max)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(min)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(norm)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(pow)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(round)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(sq)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(sqrt)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(acos)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(asin)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(atan)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(atan2)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(cos)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(degrees)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(radians)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(sin)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(tan)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(random)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(randomSeed)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noise)(\s)+/g,"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noiseDetail)(\s)+/g,
"$1;$2$3");b=b.replace(/([^a-zA-Z0-9])(noiseSeed)(\s)+/g,"$1;$2$3");b=b.replace(/->(\s+);/g,"->$1");b=b.replace(/(\sif\s*.*\s*);/g,"$1");b=b.replace(/(\s);(else\s*if\s*.*\s*);/g,"$1$2");b=b.replace(/(\s);(else.*\s*);/g,"$1$2");try{d=e.compiler.compile(b,{bare:"on"})}catch(k){a.trigger("compile-time-error-thrown",k);return}a.trigger("clear-error");c.DrawFunctionRunner.consecutiveFramesWithoutRunTimeError=0;d=d.replace(/var frame/,";");b=new Function(d);c.DrawFunctionRunner.setDrawFunction(b);return b}}};
e.addCheckMarksAndUpdateCodeAndNotifyChange=function(b,c){var d,e;d=b.currentCodeString;d=d.split("\n");for(e=0;e<c.length;e=e+1)d[c[e]]=d[c[e]].replace(/^(\s*)doOnce([ ]*\->[ ]*.*)$/gm,"$1\u2713doOnce$2");d=d.join("\n");a.trigger("code-updated-by-livecodelab",d);return b.updateCode(d)};return e},createAutocoder;
createAutocoder=function(a,b,c){var e,d,g,f,h,i,j,n,x,l,p,u,k,w,q,m,y,z,C,v,r,t,s,D,A,o,B;o=r=void 0;C={active:false};m=[];i=new McLexer.State;f=function(a){this.string=a;this.toString=function(){return"COMMENT("+a+")"};return null};u=function(a){this.string=a;this.toString=function(){return"SPACE("+a+")"};return null};x=function(a){this.string=a;this.toString=function(){return"<br/>"};return null};q=function(a){this.string=a;this.toString=function(){return"TRANSLATION("+a+")"};return null};z=function(a){this.string=
a;this.toString=function(){return"VARIABLE("+a+")"};return null};l=function(a){this.string=a;this.toString=function(){return"NUM("+a+")"};this.mutate=function(){var a,b;a=new Number(this.string);0===a&&(a=0.1);Math.random();Math.random();b=a*Math.random();a=(a+b).toFixed(2);return this.string=a.toString()};return null};p=function(a){this.string=a;this.toString=function(){return"OP("+a+")"};return null};e=function(a){this.string=a;this.toString=function(){return"ARGDLIM("+a+")"};return null};w=function(a){this.string=
a;this.toString=function(){return"TAB("+a+")"};return null};h=function(a){this.string=a;this.toString=function(){return"DOONCE("+a+")"};return null};g=function(a){this.string=a;this.toString=function(){return"COLOUROP("+a+")"};return null};d=function(a){this.string=a;this.toString=function(){return"COLOUR("+a+")"};this.mutate=function(){var a;for(a=Math.floor(Math.random()*c.length);this.string===c[a];)a=Math.floor(Math.random()*c.length);return this.string=c[a]};return null};n=function(a){this.string=
a;this.toString=function(){return"MESH("+a+")"};this.mutate=function(){switch(this.string){case "box":this.string="ball";break;case "ball":this.string="box";break;case "line":this.string="rect";break;case "rect":this.string="line"}};return null};k=function(a){this.string=a;this.toString=function(){return"STATEFUN("+a+")"};return null};j=function(a){this.string=a;this.toString=function(){return"ITERATION("+a+")"};this.mutate=function(){var a;a=/\d/.exec(this.string);Math.random()>0.5?a++:a--;return this.string=
a.toString()+" times ->"};return null};y=function(a){this.string=a;this.toString=function(){return"UNKNOWN("+a+")"};return null};i(/\/\/.*\n/)(function(a,b,c){m.push(new f(a[0]));return c.continuation(b)});i(/\t/)(function(a,b,c){m.push(new w(a[0]));return c.continuation(b)});i(/-?[0-9]+\.?[0-9]*/)(function(a,b,c){m.push(new l(a[0]));return c.continuation(b)});i(/-?\.[0-9]*/)(function(a,b,c){m.push(new l(a[0]));return c.continuation(b)});i(/[*|\/|+|\-|=]/)(function(a,b,c){m.push(new p(a[0]));return c.continuation(b)});
i(/,/)(function(a,b,c){m.push(new e(a[0]));return c.continuation(b)});i(/[\n|\r]{1,2}/)(function(a,b,c){m.push(new x(a[0]));return c.continuation(b)});i(/rotate/)(function(a,b,c){m.push(new q(a[0]));return c.continuation(b)});i(/move/)(function(a,b,c){m.push(new q(a[0]));return c.continuation(b)});i(/scale/)(function(a,b,c){m.push(new q(a[0]));return c.continuation(b)});for(o=0;o<c.length;){i(RegExp(c[o]))(function(a,b,c){m.push(new d(a[0]));return c.continuation(b)});o++}i(/background/)(function(a,
b,c){m.push(new g(a[0]));return c.continuation(b)});i(/fill/)(function(a,b,c){m.push(new g(a[0]));return c.continuation(b)});i(/stroke/)(function(a,b,c){m.push(new g(a[0]));return c.continuation(b)});i(/simpleGradient/)(function(a,b,c){m.push(new g(a[0]));return c.continuation(b)});i(/box/)(function(a,b,c){m.push(new n(a[0]));return c.continuation(b)});i(/ball/)(function(a,b,c){m.push(new n(a[0]));return c.continuation(b)});i(/peg/)(function(a,b,c){m.push(new n(a[0]));return c.continuation(b)});i(/rect/)(function(a,
b,c){m.push(new n(a[0]));return c.continuation(b)});i(/line/)(function(a,b,c){m.push(new n(a[0]));return c.continuation(b)});i(/ambientLight/)(function(a,b,c){m.push(new k(a[0]));return c.continuation(b)});i(/noStroke/)(function(a,b,c){m.push(new k(a[0]));return c.continuation(b)});i(/ballDetail/)(function(a,b,c){m.push(new k(a[0]));return c.continuation(b)});i(/animationStyle\s\w+/)(function(a,b,c){m.push(new k(a[0]));return c.continuation(b)});i(/\d+\s+times\s+->/)(function(a,b,c){m.push(new j(a[0]));
return c.continuation(b)});i(/time/)(function(a,b,c){m.push(new z(a[0]));return c.continuation(b)});i(/delay/)(function(a,b,c){m.push(new z(a[0]));return c.continuation(b)});i(/\?doOnce\s+->\s*/)(function(a,b,c){m.push(new h(a[0]));return c.continuation(b)});i(/ +/)(function(a,b,c){m.push(new u(a[0]));return c.continuation(b)});i(/'/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/[\u2713]?doOnce\s+\->?/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/==/)(function(a,
b,c){m.push(new y(a[0]));return c.continuation(b)});i(/else/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/next-tutorial:\w+/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/\w+/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/if/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/pushMatrix/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/popMatrix/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});
i(/play/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/bpm/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/color\s*\(.+\)/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/noFill/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/frame/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/strokeSize/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/\(/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});
i(/\)/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});i(/%/)(function(a,b,c){m.push(new y(a[0]));return c.continuation(b)});s=function(a){var b,c;b="";for(c=0;c<a.length;){b=b+a[c].string;c++}return b};t=function(a){return typeof a.mutate==="function"?true:false};A=function(a){var b,c;c=[];for(b=0;b<a.length;){t(a[b])&&c.push(b);b++}if(0!==c.length){b=Math.floor(Math.random()*c.length);return a[c[b]].mutate()}};D=function(){var a;a=b.getValue();m=[];try{i.lex(a)}catch(c){}A(m);a=
s(m);return b.setValue(a)};v=function(){a.trigger("autocoderbutton-flash");return D()};B=function(c){C.active=c===void 0?!C.active:c;if(C.active){r=setInterval(v,1E3);(b.getValue()===""||window.location.hash.indexOf("bookmark")!==-1&&window.location.hash.indexOf("autocodeTutorial")!==-1)&&a.trigger("load-program","cubesAndSpikes")}else clearInterval(r);return a.trigger("autocoder-button-pressed",C.active)};a.bind("reset",function(){return B(false)});a.bind("toggle-autocoder",function(){return B()});
return C};var createEditorDimmer;
createEditorDimmer=function(a,b){var c,e,d,g;e=true;g=void 0;c={};d=false;c.undimEditor=function(){if(!b.isShowing&&$("#formCode").css("opacity")<0.99)return $("#formCode").animate({opacity:1},"fast")};c.dimEditor=function(){if($("#formCode").css("opacity")>0)return $("#formCode").animate({opacity:0},"slow")};c.dimIfNoCursorActivity=function(){return e?e=false:c.dimEditor()};c.toggleDimCode=function(b){if(d=b===void 0?!d:b)g=setInterval(c.dimIfNoCursorActivity,5E3);else{clearInterval(g);c.undimEditor()}return a.trigger("auto-hide-code-button-pressed",
d)};a.bind("editor-dim",c.dimEditor,c);a.bind("editor-undim",c.undimEditor,c);a.bind("editor-toggle-dim",c.toggleDimCode,c);return c};var createTimeKeeper;createTimeKeeper=function(){var a,b,c;a={};c=b=void 0;window.time=0;a.updateTime=function(){var a;a=new Date;b=a.getTime()-c;return window.time=a.getTime()-c};a.resetTime=function(){var a;a=new Date;b=0;window.time=0;return c=a.getTime()};a.getTime=function(){return b};return a};var createBlendControls;
createBlendControls=function(a){var b,c,e;b={};c=e=0;b.blendAmount=0;b.animationStyles={};window.normal=b.animationStyles.normal=0;window.paintOver=b.animationStyles.paintOver=1;window.motionBlur=b.animationStyles.motionBlur=2;window.animationStyle=b.animationStyle=function(a){return a===false||a===void 0?void 0:c=a};b.animationStyleUpdateIfChanged=function(){var d,g;if(c!==e){e=c;g=a.ThreeJsSystem.isWebGLUsed;d=b.animationStyles;if(g&&c===d.motionBlur)a.ThreeJsSystem.effectBlend.uniforms.mixRatio.value=
0.7;else if(!g&&c===d.motionBlur)b.blendAmount=0.6;if(g&&c===d.paintOver)a.ThreeJsSystem.effectBlend.uniforms.mixRatio.value=1;else if(!g&&c===d.paintOver)b.blendAmount=1;if(g&&c===d.normal)return a.ThreeJsSystem.effectBlend.uniforms.mixRatio.value=0;if(!g&&c===d.normal)return b.blendAmount=0}};return b};var createLightSystem;
createLightSystem=function(a,b){var c,e,d,g;c={};e=a.objectPools;g=a.primitiveTypes;d=a.objectsUsedInFrameCounts;e[g.ambientLight]=[];d[g.ambientLight]=0;c.lightsAreOn=false;window.lights=c.lights=function(){return c.lightsAreOn=true};window.noLights=c.noLights=function(){return c.lightsAreOn=false};window.ambientLight=c.ambientLight=function(f,h,i,j){var n;n=false;h=f===void 0?b.ColourFunctions.color(255):b.ColourFunctions.color(f,h,i,j);c.lightsAreOn=true;a.defaultNormalFill=false;a.defaultNormalStroke=
false;f=e[g.ambientLight];i=f[d[g.ambientLight]];if(i===void 0){i=new b.THREE.PointLight(h);i.position.set(10,50,130);n=true;f.push(i);i.detailLevel=0;i.primitiveType=g.ambientLight}else i.color.setHex(h);d[g.ambientLight]=d[g.ambientLight]+1;if(n)return b.ThreeJsSystem.scene.add(i)};return c};var createUi;
createUi=function(a,b){var c,e;c={};e=void 0;e=function(a){var b,a=$(a);b={x:1,y:1};b.x=(window.innerWidth+40)/a.width();b.y=(window.innerHeight+40)/a.height();b=b.x+", "+b.y;return a.css("-ms-transform-origin","left top").css("-webkit-transform-origin","left top").css("-moz-transform-origin","left top").css("-o-transform-origin","left top").css("transform-origin","left top").css("-ms-transform","scale("+b+")").css("-webkit-transform","scale3d("+b+", 1)").css("-moz-transform","scale("+b+")").css("-o-transform",
"scale("+b+")").css("transform","scale("+b+")")};c.adjustCodeMirrorHeight=function(){return $(".CodeMirror-scroll").css("height",window.innerHeight-$("#theMenu").height())};c.fullscreenify=function(a){window.addEventListener("resize",function(){c.adjustCodeMirrorHeight();return e(a)},false);return e(a)};c.checkErrorAndReport=function(a){$("#dangerSignText").css("color","red");a=a.message||a;a.indexOf("Unexpected 'INDENT'")>-1?a="weird indentation":a.indexOf("Unexpected 'TERMINATOR'")>-1?a="line not complete":
a.indexOf("Unexpected 'CALL_END'")>-1?a="line not complete":a.indexOf("Unexpected '}'")>-1?a="something wrong":a.indexOf("Unexpected 'MATH'")>-1?a="weird arithmetic there":a.indexOf("Unexpected 'LOGIC'")>-1?a="odd expression thingy":a.indexOf("Unexpected 'NUMBER'")>-1?a="lost number?":a.indexOf("Unexpected 'NUMBER'")>-1?a="lost number?":a.indexOf("ReferenceError")>-1&&(a=a.replace(/ReferenceError:\s/g,""));return $("#errorMessageText").text(a)};c.clearError=function(){$("#dangerSignText").css("color",
"#000000");return $("#errorMessageText").text("")};c.soundSystemOk=function(){return $("#soundSystemStatus").text("Sound System On").removeClass("off").addClass("on")};c.hideStatsWidget=function(){return $("#statsWidget").hide()};c.showStatsWidget=function(){return setTimeout('$("#statsWidget").show()',1)};c.setup=function(){return $(document).ready(function(){$("#aboutMenu").click(function(){$("#aboutWindow").modal();$("#simplemodal-container").height(250);return false});$("#demos li a").click(function(){a.trigger("load-program",
$(this).attr("id"));return false});$("#tutorials li a").click(function(){a.trigger("load-program",$(this).attr("id"));return false});$("#autocodeIndicatorContainer").click(function(){a.trigger("toggle-autocoder");return false});$("#dimCodeButtonContainer").click(function(){a.trigger("editor-toggle-dim");return false});$("#resetButtonContainer").click(function(){a.trigger("reset");$(this).stop().fadeOut(100).fadeIn(100);return false});b.getDomElement().style.position="absolute";b.getDomElement().style.right=
"0px";b.getDomElement().style.top="0px";document.body.appendChild(b.getDomElement());$("#startingCourtainScreen").fadeOut();$("#formCode").css("opacity",0);c.fullscreenify("#backGroundCanvas");return c.adjustCodeMirrorHeight()})};a.bind("report-runtime-or-compile-time-error",c.checkErrorAndReport,c);a.bind("clear-error",c.clearError,c);a.bind("autocoder-button-pressed",function(a){return a===true?$("#autocodeIndicator").html("Autocode: on").css("background-color","#FF0000"):$("#autocodeIndicator").html("Autocode: off").css("background-color",
"")});a.bind("autocoderbutton-flash",function(){return $("#autocodeIndicator").fadeOut(100).fadeIn(100)});a.bind("auto-hide-code-button-pressed",function(a){return a===true?$("#dimCodeIndicator").html("Hide Code: on"):$("#dimCodeIndicator").html("Hide Code: off")});return c};
var createBowser=function(){var a=navigator.userAgent,b=/msie/i.test(a),c=/chrome/i.test(a),e=/phantom/i.test(a),d=/safari/i.test(a)&&!c&&!e,g=/iphone/i.test(a),f=/ipad/i.test(a),h=/touchpad/i.test(a),i=/android/i.test(a),j=/opera/i.test(a),n=/firefox/i.test(a),x=/gecko\//i.test(a),l=/seamonkey\//i.test(a),p=/version\/(\d+(\.\d+)?)/i,u,k=function(){if(b)return{msie:true,version:a.match(/msie (\d+(\.\d+)?);/i)[1]};if(c)return{webkit:true,chrome:true,version:a.match(/chrome\/(\d+(\.\d+)?)/i)[1]};if(e)return{webkit:true,
phantom:true,version:a.match(/phantomjs\/(\d+(\.\d+)+)/i)[1]};if(h)return{webkit:true,touchpad:true,version:a.match(/touchpad\/(\d+(\.\d+)?)/i)[1]};if(g||f){u={webkit:true,mobile:true,ios:true,iphone:g,ipad:f};if(p.test(a))u.version=a.match(p)[1];return u}if(i)return{webkit:true,android:true,mobile:true,version:a.match(p)[1]};if(d)return{webkit:true,safari:true,version:a.match(p)[1]};if(j)return{opera:true,version:a.match(p)[1]};if(x){u={gecko:true,mozilla:true,version:a.match(/firefox\/(\d+(\.\d+)?)/i)[1]};
if(n)u.firefox=true;return u}if(l)return{seamonkey:true,version:a.match(/seamonkey\/(\d+(\.\d+)?)/i)[1]}}();k.msie&&k.version>=7||k.chrome&&k.version>=10||k.firefox&&k.version>=4||k.safari&&k.version>=5||k.opera&&k.version>=10?k.a=true:k.msie&&k.version<7||k.chrome&&k.version<10||k.firefox&&k.version<4||k.safari&&k.version<5||k.opera&&k.version<10?k.c=true:k.x=true;return k};
