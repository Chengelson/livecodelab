<!DOCTYPE html>  <html> <head>   <title>ui.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="animation-loop.html">                 animation-loop.coffee               </a>                                           <a class="source" href="background-painting.html">                 background-painting.coffee               </a>                                           <a class="source" href="big-cursor-animation.html">                 big-cursor-animation.coffee               </a>                                           <a class="source" href="blend-style.html">                 blend-style.coffee               </a>                                           <a class="source" href="code-transformations.html">                 code-transformations.coffee               </a>                                           <a class="source" href="colour-definitions.html">                 colour-definitions.coffee               </a>                                           <a class="source" href="colour-functions.html">                 colour-functions.coffee               </a>                                           <a class="source" href="demos-and-tutorials.html">                 demos-and-tutorials.coffee               </a>                                           <a class="source" href="draw-function-runner.html">                 draw-function-runner.coffee               </a>                                           <a class="source" href="events.html">                 events.coffee               </a>                                           <a class="source" href="globals.html">                 globals.coffee               </a>                                           <a class="source" href="graphic-primitives.html">                 graphic-primitives.coffee               </a>                                           <a class="source" href="init-threejs.html">                 init-threejs.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="lights-functions.html">                 lights-functions.coffee               </a>                                           <a class="source" href="livecodelab-core.html">                 livecodelab-core.coffee               </a>                                           <a class="source" href="math.html">                 math.coffee               </a>                                           <a class="source" href="matrix-commands.html">                 matrix-commands.coffee               </a>                                           <a class="source" href="renderer.html">                 renderer.coffee               </a>                                           <a class="source" href="simple-error-checker.html">                 simple-error-checker.coffee               </a>                                           <a class="source" href="text-dimming.html">                 text-dimming.coffee               </a>                                           <a class="source" href="time-keeper.html">                 time-keeper.coffee               </a>                                           <a class="source" href="ui.html">                 ui.coffee               </a>                                           <a class="source" href="url-router.html">                 url-router.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               ui.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>jslint browser: true 
global $ </p>             </td>             <td class="code">               <div class="highlight"><pre>
<span class="string">"use strict"</span>
<span class="class"><span class="keyword">class</span> <span class="title">Ui</span></span>
  constructor: (<span class="property">@eventRouter</span>, <span class="property">@stats</span>) -&gt;
</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Setup Event Listeners</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="property">@eventRouter</span>.bind <span class="string">"report-runtime-or-compile-time-error"</span>, (=&gt;<span class="property">@checkErrorAndReport</span>()), @
    <span class="property">@eventRouter</span>.bind <span class="string">"clear-error"</span>, (=&gt;<span class="property">@clearError</span>()), @
    <span class="property">@eventRouter</span>.bind <span class="string">"autocoder-button-pressed"</span>, (state) =&gt;
      <span class="keyword">if</span> state <span class="keyword">is</span> <span class="literal">true</span>
        $(<span class="string">"#autocodeIndicator"</span>).html(<span class="string">"Autocode: on"</span>).css <span class="string">"background-color"</span>, <span class="string">"#FF0000"</span>
      <span class="keyword">else</span>
        $(<span class="string">"#autocodeIndicator"</span>).html(<span class="string">"Autocode: off"</span>).css <span class="string">"background-color"</span>, <span class="string">""</span>

    <span class="property">@eventRouter</span>.bind <span class="string">"autocoderbutton-flash"</span>, =&gt;
      $(<span class="string">"#autocodeIndicator"</span>).fadeOut(<span class="number">100</span>).fadeIn <span class="number">100</span>

    <span class="property">@eventRouter</span>.bind <span class="string">"auto-hide-code-button-pressed"</span>, (state) =&gt;
      <span class="keyword">if</span> state <span class="keyword">is</span> <span class="literal">true</span>
        $(<span class="string">"#dimCodeIndicator"</span>).html <span class="string">"Hide Code: on"</span>
      <span class="keyword">else</span>
        $(<span class="string">"#dimCodeIndicator"</span>).html <span class="string">"Hide Code: off"</span>

  resizeCanvas: (canvasId) -&gt;
    canvas = $(canvasId)
    scale =
      x: <span class="number">1</span>
      y: <span class="number">1</span>

    scale.x = (window.innerWidth + <span class="number">40</span>) / canvas.width()
    scale.y = (window.innerHeight + <span class="number">40</span>) / canvas.height()
    scale = scale.x + <span class="string">", "</span> + scale.y
    
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>this code below is if one wants to keep the aspect ratio
but I mean one doesn't necessarily resize the window
keeping the same aspect ratio.</p>             </td>             <td class="code">               <div class="highlight"><pre>    
</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>if (scale.x &lt; 1 || scale.y &lt; 1) {
    scale = '1, 1';
} else if (scale.x &lt; scale.y) {
    scale = scale.x + ', ' + scale.x;
} else {
    scale = scale.y + ', ' + scale.y;
}</p>             </td>             <td class="code">               <div class="highlight"><pre>    canvas.css(<span class="string">"-ms-transform-origin"</span>, <span class="string">"left top"</span>).css(<span class="string">"-webkit-transform-origin"</span>, <span class="string">"left top"</span>).css(<span class="string">"-moz-transform-origin"</span>, <span class="string">"left top"</span>).css(<span class="string">"-o-transform-origin"</span>, <span class="string">"left top"</span>).css(<span class="string">"transform-origin"</span>, <span class="string">"left top"</span>).css(<span class="string">"-ms-transform"</span>, <span class="string">"scale("</span> + scale + <span class="string">")"</span>).css(<span class="string">"-webkit-transform"</span>, <span class="string">"scale3d("</span> + scale + <span class="string">", 1)"</span>).css(<span class="string">"-moz-transform"</span>, <span class="string">"scale("</span> + scale + <span class="string">")"</span>).css(<span class="string">"-o-transform"</span>, <span class="string">"scale("</span> + scale + <span class="string">")"</span>).css <span class="string">"transform"</span>, <span class="string">"scale("</span> + scale + <span class="string">")"</span>

  
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>TODO In theory we want to re-draw the background because the
aspect ration might have changed.
But for the time being we only have vertical
gradients so that's not going to be a problem.</p>             </td>             <td class="code">               <div class="highlight"><pre>  adjustCodeMirrorHeight: -&gt;
    $(<span class="string">".CodeMirror-scroll"</span>).css <span class="string">"height"</span>, window.innerHeight - $(<span class="string">"#theMenu"</span>).height()

  
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>resizing the text area is necessary otherwise
as the user types to the end of it, instead of just scrolling
the content leaving all the other parts of the page where
they are, it expands and it pushes down
the view of the page, meaning that the canvas goes up and
the menu disappears
so we have to resize it at launch and also every time the window
is resized.</p>             </td>             <td class="code">               <div class="highlight"><pre>  fullscreenify: (canvasId) -&gt;
    window.addEventListener <span class="string">"resize"</span>, (=&gt;
      <span class="property">@adjustCodeMirrorHeight</span>()
      <span class="property">@resizeCanvas</span> canvasId
    ), <span class="literal">false</span>
    <span class="property">@resizeCanvas</span> canvasId

  checkErrorAndReport: (e) -&gt;
    $(<span class="string">"#dangerSignText"</span>).css <span class="string">"color"</span>, <span class="string">"red"</span>
    
</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>if the object is an exception then get the message
otherwise e should just be a string</p>             </td>             <td class="code">               <div class="highlight"><pre>    errorMessage = e.message <span class="keyword">or</span> e
    <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected 'INDENT'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"weird indentation"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected 'TERMINATOR'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"line not complete"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected 'CALL_END'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"line not complete"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected '}'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"something wrong"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected 'MATH'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"weird arithmetic there"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected 'LOGIC'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"odd expression thingy"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected 'NUMBER'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"lost number?"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"Unexpected 'NUMBER'"</span>) &gt; -<span class="number">1</span>
      errorMessage = <span class="string">"lost number?"</span>
    <span class="keyword">else</span> errorMessage = errorMessage.replace(<span class="regexp">/ReferenceError:\s/g</span>, <span class="string">""</span>)  <span class="keyword">if</span> errorMessage.indexOf(<span class="string">"ReferenceError"</span>) &gt; -<span class="number">1</span>
    $(<span class="string">"#errorMessageText"</span>).text errorMessage

  clearError: -&gt;
    $(<span class="string">"#dangerSignText"</span>).css <span class="string">"color"</span>, <span class="string">"#000000"</span>
    $(<span class="string">"#errorMessageText"</span>).text <span class="string">""</span>

  soundSystemOk: -&gt;
    $(<span class="string">"#soundSystemStatus"</span>).text(<span class="string">"Sound System On"</span>).removeClass(<span class="string">"off"</span>).addClass <span class="string">"on"</span>

  hideStatsWidget: -&gt;
    $(<span class="string">"#statsWidget"</span>).hide()

  
</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>console.log('hiding stats widget');</p>             </td>             <td class="code">               <div class="highlight"><pre>  showStatsWidget: -&gt;
    
</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>I wish I could tell you why showing the widget straight away doesn't work.
Postponing a little bit makes this work. It doesn't make any sense.</p>             </td>             <td class="code">               <div class="highlight"><pre>    setTimeout <span class="string">"$(\"#statsWidget\").show()"</span>, <span class="number">1</span>

  
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>console.log('showing stats widget');</p>             </td>             <td class="code">               <div class="highlight"><pre>  setup: -&gt;
    $(document).ready =&gt;
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>we need a way to reference the eventRouter without
resorting to "@", because the "@"s below need to stick
to the UI elements that generated the events</p>             </td>             <td class="code">               <div class="highlight"><pre>      eventRouter = <span class="property">@eventRouter</span>
      
      $(<span class="string">"#aboutMenu"</span>).click -&gt;
        $(<span class="string">"#aboutWindow"</span>).modal()
        $(<span class="string">"#simplemodal-container"</span>).height <span class="number">250</span>
        <span class="literal">false</span>

      $(<span class="string">"#demos li a"</span>).click -&gt;
        eventRouter.trigger <span class="string">"load-program"</span>, $(@).attr(<span class="string">"id"</span>)
        <span class="literal">false</span>

      $(<span class="string">"#tutorials li a"</span>).click -&gt;
        eventRouter.trigger <span class="string">"load-program"</span>, $(@).attr(<span class="string">"id"</span>)
        <span class="literal">false</span>

      $(<span class="string">"#autocodeIndicatorContainer"</span>).click -&gt;
        eventRouter.trigger <span class="string">"toggle-autocoder"</span>
        <span class="literal">false</span>

      $(<span class="string">"#dimCodeButtonContainer"</span>).click -&gt;
        eventRouter.trigger <span class="string">"editor-toggle-dim"</span>
        <span class="literal">false</span>

      $(<span class="string">"#resetButtonContainer"</span>).click -&gt;
        eventRouter.trigger <span class="string">"reset"</span>
        $(@).stop().fadeOut(<span class="number">100</span>).fadeIn <span class="number">100</span>
        <span class="literal">false</span>

      
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Align bottom-left</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="property">@stats</span>.getDomElement().style.position = <span class="string">"absolute"</span>
      <span class="property">@stats</span>.getDomElement().style.right = <span class="string">"0px"</span>
      <span class="property">@stats</span>.getDomElement().style.top = <span class="string">"0px"</span>
      document.body.appendChild <span class="property">@stats</span>.getDomElement()
      $(<span class="string">"#startingCourtainScreen"</span>).fadeOut()
      $(<span class="string">"#formCode"</span>).css <span class="string">"opacity"</span>, <span class="number">0</span>
      <span class="property">@fullscreenify</span> <span class="string">"#backGroundCanvas"</span>
      <span class="property">@adjustCodeMirrorHeight</span>()

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 